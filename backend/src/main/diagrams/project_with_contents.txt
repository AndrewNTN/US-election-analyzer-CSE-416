backend/src/main/java/edu/sbu/cse416/app/repository/EavsDataRepository.java
-----
package edu.sbu.cse416.app.repository;

import edu.sbu.cse416.app.model.EavsData;
import java.util.List;
import org.springframework.data.mongodb.repository.MongoRepository;
import org.springframework.data.mongodb.repository.Query;
import org.springframework.stereotype.Repository;

@Repository
public interface EavsDataRepository extends MongoRepository<EavsData, String> {

    // Used by EavsAggregationService
    List<EavsData> findByStateAbbrAndElectionYear(String stateAbbr, Integer electionYear);

    // Used by EavsController (provisional endpoints)
    @Query("{ 'fipsCode': { $regex: ?0 }, 'electionYear': ?1 }")
    List<EavsData> findByFipsCodeRegexAndElectionYear(String regex, Integer electionYear);

}

backend/src/main/java/edu/sbu/cse416/app/Application.java
-----
package edu.sbu.cse416.app;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;

@SpringBootApplication
public class Application {
    public static void main(String[] args) {
        SpringApplication.run(Application.class, args);
    }
}
backend/src/main/java/edu/sbu/cse416/app/config/DataSeeder.java
-----
package edu.sbu.cse416.app.config;

import org.springframework.boot.CommandLineRunner;
import org.springframework.stereotype.Component;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.core.io.ClassPathResource;
import java.util.Random;

import edu.sbu.cse416.app.model.EavsData;
import edu.sbu.cse416.app.repository.EavsDataRepository;

import java.io.BufferedReader;
import java.io.InputStreamReader;
@Component
public class DataSeeder implements CommandLineRunner {

    @Autowired
    private EavsDataRepository eavsRepo;

    // ‚úÖ helper function must be defined at class level, not inside run()
    private double parseVal(String s) {
        try {
            double v = Double.parseDouble(s.trim());
            return (v < 0) ? 0 : v; // EAVS uses -99/-88 as missing
        } catch (Exception e) {
            return 0;
        }
    }

    @Override
    public void run(String... args) throws Exception {
        if (eavsRepo.count() > 0) {
            System.out.println("‚úÖ EAVS data already seeded, skipping.");
            return; // don‚Äôt reseed if data already exists
        }

        int counter = 0;

        try (BufferedReader br = new BufferedReader(new InputStreamReader(
                new ClassPathResource("2024_EAVS_for_Public_Release_nolabel_V1.csv").getInputStream()
        ))) {
            String line;
            boolean isHeader = true;

            while ((line = br.readLine()) != null) {
                if (isHeader) { // skip header
                    isHeader = false;
                    continue;
                }

                String[] values = line.split(",");
                if (values.length < 500) continue;

                String fipsCode = values[0].replace("\"", "");
                String jurisdictionName = values[1].replace("\"", "");
                String stateFull = values[2].replace("\"", "");
                String stateAbbr = values[3].replace("\"", "");

                int E2a = 379;
                int E2b = 380;
                int E2c = 381;
                int E2d = 382;
                int E2e = 383;
                int E2f = 384;
                int E2g = 385;
                int E2h = 386;
                int E2i = 387;

                edu.sbu.cse416.app.model.ProvisionalBallots prov =
                    new edu.sbu.cse416.app.model.ProvisionalBallots(
                        (int) parseVal(values[E2a]), // totalProvisionalBallotsCast
                        (int) parseVal(values[E2b]), // provisionalBallotsFullyCounted
                        (int) parseVal(values[E2c]), // provisionalBallotsPartiallyCounted
                        (int) parseVal(values[E2d]), // provisionalBallotsRejected
                        (int) parseVal(values[E2e]), // reasonNoRegistration
                        (int) parseVal(values[E2f]), // reasonNameNotFound
                        values.length > E2i ? values[E2i].replace("\"", "") : "" // provisionalComments
                    );


                EavsData data = new EavsData(
                    null,
                    fipsCode,
                    jurisdictionName,
                    stateFull,
                    stateAbbr,
                    2024,
                    new edu.sbu.cse416.app.model.VoterRegistration(
                        0, 0, 0, "not loaded yet"
                    ),
                    new edu.sbu.cse416.app.model.MailBallots(
                        0, 0, 0, "not loaded yet"
                    ),
                    prov,
                    null
                );

                eavsRepo.save(data);
                counter++;
            }

            System.out.println("‚úÖ Seeded " + counter + " rows from EAVS CSV into Mongo.");
        } catch (Exception e) {
            System.err.println("‚ùå Failed to read/seed CSV: " + e.getMessage());
            e.printStackTrace();
        }
    }
}
backend/src/main/java/edu/sbu/cse416/app/config/CorsConfig.java
-----
package edu.sbu.cse416.app.config;

import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.web.servlet.config.annotation.CorsRegistry;
import org.springframework.web.servlet.config.annotation.WebMvcConfigurer;

@Configuration
public class CorsConfig {
    @Bean
    public WebMvcConfigurer corsConfigurer() {
        return new WebMvcConfigurer() {
            @Override
            public void addCorsMappings(CorsRegistry registry) {
                registry.addMapping("/api/**")
                        .allowedOrigins("http://localhost:5173")
                        .allowedMethods("GET", "POST", "PUT", "DELETE", "OPTIONS")
                        .allowCredentials(true);
            }
        };
    }
}
backend/src/main/java/edu/sbu/cse416/app/controller/EavsController.java
-----
package edu.sbu.cse416.app.controller;

import org.springframework.data.domain.Page;
import org.springframework.data.domain.PageRequest;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.*;

import edu.sbu.cse416.app.model.EavsData;
import edu.sbu.cse416.app.repository.EavsDataRepository;
import edu.sbu.cse416.app.service.EavsAggregationService;
import org.springframework.http.HttpStatus;

import java.util.LinkedHashMap;
import java.util.List;
import java.util.Map;

@RestController
@RequestMapping("/api/eavs")
public class EavsController {

    private final EavsAggregationService aggregationService;
    private final EavsDataRepository eavsRepository;

    public EavsController(EavsAggregationService aggregationService, EavsDataRepository eavsRepository) {
        this.aggregationService = aggregationService;
        this.eavsRepository = eavsRepository;
    }

    @GetMapping("/api/eavs/states")
public ResponseEntity<List<Object>> getAllStatesPlaceholder() {
    return ResponseEntity.ok(List.of());
}



    @GetMapping("/provisional/state/{fipsPrefix}")
    public ResponseEntity<List<EavsData>> getProvisionalByStateFipsPrefix(
            @PathVariable String fipsPrefix,
            @RequestParam(defaultValue = "2024") Integer electionYear) {

        fipsPrefix = fipsPrefix.trim();
        String regex = "0*" + fipsPrefix; // matches with leading zeros
        System.out.println("üîç Querying for FIPS regex: " + regex);

        List<EavsData> data = eavsRepository.findByFipsCodeRegexAndElectionYear(regex, electionYear);

        if (data.isEmpty()) {
            return ResponseEntity.status(HttpStatus.NOT_FOUND).build();
        }

        return ResponseEntity.ok(data);
    }

    @GetMapping("/provisional/aggregate/{fipsPrefix}")
public ResponseEntity<Map<String, Object>> getProvisionalAggregateByStateFipsPrefix(
        @PathVariable String fipsPrefix,
        @RequestParam(defaultValue = "2024") Integer electionYear) {

    System.out.println("üîç FIPS prefix request: " + fipsPrefix);

    // Find all EAVS data records where FIPS starts with prefix (e.g. "30" for Montana)
    String regex = "0*" + fipsPrefix; // matches with leading zeros
    List<EavsData> data = eavsRepository.findByFipsCodeRegexAndElectionYear(regex, electionYear);

    if (data == null || data.isEmpty()) {
        System.out.println("‚ö†Ô∏è No records found for FIPS prefix: " + fipsPrefix);
        return ResponseEntity.status(HttpStatus.NOT_FOUND).build();
    }

    int E2a = 0, E2b = 0, E2c = 0, E2d = 0, E2e = 0, E2f = 0, E2g = 0, E2h = 0;

    for (EavsData record : data) {
        var p = record.provisionalBallots(); // ‚úÖ record-style accessor
        if (p != null) {
            E2a += p.totalProvisionalBallotsCast() != null ? p.totalProvisionalBallotsCast() : 0;
            E2b += p.provisionalBallotsFullyCounted() != null ? p.provisionalBallotsFullyCounted() : 0;
            E2c += p.provisionalBallotsRejected() != null ? p.provisionalBallotsRejected() : 0;
            E2d += p.provisionalBallotsPartiallyCounted() != null ? p.provisionalBallotsPartiallyCounted() : 0;
            E2e += p.reasonNoRegistration() != null ? p.reasonNoRegistration() : 0;
            E2f += p.reasonNameNotFound() != null ? p.reasonNameNotFound() : 0;
            // Currently we don't have fields for E2g, E2h, so leave as 0
        }
    }

    Map<String, Object> totals = new LinkedHashMap<>();
    totals.put("E2a", E2a);
    totals.put("E2b", E2b);
    totals.put("E2c", E2c);
    totals.put("E2d", E2d);
    totals.put("E2e", E2e);
    totals.put("E2f", E2f);
    totals.put("E2g", E2g);
    totals.put("E2h", E2h);

    System.out.println("‚úÖ Aggregated " + data.size() + " records for state prefix " + fipsPrefix);
    return ResponseEntity.ok(totals);
}


}
backend/src/main/java/edu/sbu/cse416/app/model/VotingEquipment.java
-----
package edu.sbu.cse416.app.model;

import java.util.List;

public record VotingEquipment(
        List<EquipmentDetail> dreNoVvpat,
        List<EquipmentDetail> dreWithVvpat,
        List<EquipmentDetail> ballotMarkingDevices,
        List<EquipmentDetail> opticalScanners) {}
backend/src/main/java/edu/sbu/cse416/app/model/EavsData.java
-----
package edu.sbu.cse416.app.model;

import org.springframework.data.annotation.Id;
import org.springframework.data.mongodb.core.mapping.Document;

@Document("eavs_data")
public record EavsData(
        @Id String id,
        String fipsCode,
        String jurisdictionName,
        String stateFull,
        String stateAbbr,
        Integer electionYear,
        VoterRegistration voterRegistration,
        MailBallots mailBallots,
        ProvisionalBallots provisionalBallots,
        VotingEquipment votingEquipment) {}

backend/src/main/java/edu/sbu/cse416/app/model/MailBallots.java
-----
package edu.sbu.cse416.app.model;

public record MailBallots(
        Integer totalMailBallotsTransmitted,
        Integer rejectedNoSignature,
        Integer rejectedSignatureMismatch,
        String rejectionComments) {}
backend/src/main/java/edu/sbu/cse416/app/model/EquipmentDetail.java
-----
package edu.sbu.cse416.app.model;

public record EquipmentDetail(
        String make,
        String model,
        Integer quantity,
        Integer age,
        String underlyingOs,
        Boolean vvsgCertified,
        String certificationLevel,
        Integer scanRate,
        Double errorRate,
        String equipmentType) {}
backend/src/main/java/edu/sbu/cse416/app/model/ProvisionalBallots.java
-----
package edu.sbu.cse416.app.model;

public record ProvisionalBallots(
        Integer totalProvisionalBallotsCast,
        Integer provisionalBallotsFullyCounted,
        Integer provisionalBallotsPartiallyCounted,
        Integer provisionalBallotsRejected,
        Integer reasonNoRegistration,
        Integer reasonNameNotFound,
        String provisionalComments) {}
backend/src/main/java/edu/sbu/cse416/app/model/VoterRegistration.java
-----
package edu.sbu.cse416.app.model;

public record VoterRegistration(Integer totalRegistered, Integer totalActive, Integer totalInactive, String comments) {}
backend/src/main/java/edu/sbu/cse416/app/service/EavsAggregationService.java
-----
package edu.sbu.cse416.app.service;

import edu.sbu.cse416.app.model.EavsData;
import edu.sbu.cse416.app.repository.EavsDataRepository;
import java.util.List;
import java.util.stream.Collectors;
import org.springframework.data.mongodb.core.MongoTemplate;
import org.springframework.data.mongodb.core.aggregation.Aggregation;
import org.springframework.data.mongodb.core.aggregation.AggregationResults;
import org.springframework.data.mongodb.core.query.Criteria;
import org.springframework.stereotype.Service;

@Service
public class EavsAggregationService {
    // ts is cooked
}
frontend/eslint.config.js
-----
import js from "@eslint/js";
import globals from "globals";
import reactHooks from "eslint-plugin-react-hooks";
import reactRefresh from "eslint-plugin-react-refresh";
import tseslint from "typescript-eslint";
import { globalIgnores } from "eslint/config";
import eslintConfigPrettier from "eslint-config-prettier";

export default tseslint.config([
  globalIgnores(["dist", "src/routeTree.gen.ts"]),
  {
    files: ["**/*.{ts,tsx}"],
    extends: [
      js.configs.recommended,
      tseslint.configs.recommended,
      reactHooks.configs["recommended-latest"],
      reactRefresh.configs.vite,
      eslintConfigPrettier,
    ],
    languageOptions: {
      ecmaVersion: 2020,
      globals: globals.browser,
    },
  },
]);
frontend/vite.config.ts
-----
import { defineConfig } from "vite";
import react from "@vitejs/plugin-react";
import tailwindcss from "@tailwindcss/vite";
import path from "path";
import { tanstackRouter } from "@tanstack/router-plugin/vite";

// https://vite.dev/config/
export default defineConfig({
  plugins: [
    tanstackRouter({
      target: "react",
      autoCodeSplitting: true,
    }),
    react(),
    tailwindcss(),
  ],
  resolve: {
    alias: {
      "@": path.resolve(__dirname, "./src"),
    },
  },
});
frontend/src/main.tsx
-----
import { StrictMode } from "react";
import ReactDOM from "react-dom/client";
import { RouterProvider, createRouter } from "@tanstack/react-router";
import "./index.css";

// Import the generated route tree
import { routeTree } from "./routeTree.gen.ts";

// Create a new router instance
const router = createRouter({ routeTree });

// Register the router instance for type safety
declare module "@tanstack/react-router" {
  interface Register {
    router: typeof router;
  }
}

// Render the app
const rootElement = document.getElementById("root")!;
if (!rootElement.innerHTML) {
  const root = ReactDOM.createRoot(rootElement);
  root.render(
    <StrictMode>
      <RouterProvider router={router} />
    </StrictMode>,
  );
}
frontend/src/types/map.ts
-----
// Common base for all map feature properties
export interface BaseMapProps {
  NAME: string;
}

export interface StateProps extends BaseMapProps {
  DENSITY: number;
  // Mock political data - would be replaced with real data
  REPUBLICAN_PCT?: number;
  DEMOCRATIC_PCT?: number;
}

export interface CountyProps extends BaseMapProps {
  STATEFP: string;
  DENSITY?: number;
  // Mock political data - would be replaced with real data
  REPUBLICAN_PCT?: number;
  DEMOCRATIC_PCT?: number;
}

// Overarching type representing any map feature properties we handle
export type MapFeatureProps = StateProps | CountyProps;
frontend/src/constants/stateFips.ts
-----
// Mapping of state names to their FIPS codes for county filtering
export const stateFipsMapping: Record<string, string> = {
  Alabama: "01",
  Arizona: "04",
  Arkansas: "05",
  California: "06",
  Colorado: "08",
  Connecticut: "09",
  Delaware: "10",
  Florida: "12",
  Georgia: "13",
  Hawaii: "15",
  Idaho: "16",
  Illinois: "17",
  Indiana: "18",
  Iowa: "19",
  Kansas: "20",
  Kentucky: "21",
  Louisiana: "22",
  Maine: "23",
  Maryland: "24",
  Massachusetts: "25",
  Michigan: "26",
  Minnesota: "27",
  Mississippi: "28",
  Missouri: "29",
  Montana: "30",
  Nebraska: "31",
  Nevada: "32",
  "New Hampshire": "33",
  "New Jersey": "34",
  "New Mexico": "35",
  "New York": "36",
  "North Carolina": "37",
  "North Dakota": "38",
  Ohio: "39",
  Oklahoma: "40",
  Oregon: "41",
  Pennsylvania: "42",
  "Rhode Island": "44",
  "South Carolina": "45",
  "South Dakota": "46",
  Tennessee: "47",
  Texas: "48",
  Utah: "49",
  Vermont: "50",
  Virginia: "51",
  Washington: "53",
  "West Virginia": "54",
  Wisconsin: "55",
  Wyoming: "56",
};

// Mapping of full state names to abbreviations (for backend API calls)
export const stateNameToAbbr: Record<string, string> = {
  "Alabama": "AL",
  "Alaska": "AK",
  "Arizona": "AZ",
  "Arkansas": "AR",
  "California": "CA",
  "Colorado": "CO",
  "Connecticut": "CT",
  "Delaware": "DE",
  "Florida": "FL",
  "Georgia": "GA",
  "Hawaii": "HI",
  "Idaho": "ID",
  "Illinois": "IL",
  "Indiana": "IN",
  "Iowa": "IA",
  "Kansas": "KS",
  "Kentucky": "KY",
  "Louisiana": "LA",
  "Maine": "ME",
  "Maryland": "MD",
  "Massachusetts": "MA",
  "Michigan": "MI",
  "Minnesota": "MN",
  "Mississippi": "MS",
  "Missouri": "MO",
  "Montana": "MT",
  "Nebraska": "NE",
  "Nevada": "NV",
  "New Hampshire": "NH",
  "New Jersey": "NJ",
  "New Mexico": "NM",
  "New York": "NY",
  "North Carolina": "NC",
  "North Dakota": "ND",
  "Ohio": "OH",
  "Oklahoma": "OK",
  "Oregon": "OR",
  "Pennsylvania": "PA",
  "Rhode Island": "RI",
  "South Carolina": "SC",
  "South Dakota": "SD",
  "Tennessee": "TN",
  "Texas": "TX",
  "Utah": "UT",
  "Vermont": "VT",
  "Virginia": "VA",
  "Washington": "WA",
  "West Virginia": "WV",
  "Wisconsin": "WI",
  "Wyoming": "WY",
};


export function getStateFipsCode(stateName: string): string | undefined {
  return stateFipsMapping[stateName];
}
frontend/src/constants/states.ts
-----
export interface StateDetails {
  name: string;
  politicalDominance: "republican" | "democratic";
  registrationType: "opt-in" | "opt-out";
  sameDayRegistration: boolean;
  hasDetailedVoterData: boolean;
  hasDropBoxVoting: boolean;
}

export const DETAILED_STATES = {
  florida: {
    name: "florida",
    politicalDominance: "republican",
    registrationType: "opt-in",
    sameDayRegistration: false,
    hasDetailedVoterData: true,
    hasDropBoxVoting: true,
  },
  california: {
    name: "california",
    politicalDominance: "democratic",
    registrationType: "opt-out",
    sameDayRegistration: true,
    hasDetailedVoterData: false,
    hasDropBoxVoting: true,
  },
  colorado: {
    name: "colorado",
    politicalDominance: "democratic",
    registrationType: "opt-out",
    sameDayRegistration: false,
    hasDetailedVoterData: false,
    hasDropBoxVoting: false,
  },
} as const satisfies Record<string, StateDetails>;

export type DetailedStateName = keyof typeof DETAILED_STATES;

export function getStateDetails(stateName: string): StateDetails | undefined {
  return DETAILED_STATES[stateName as DetailedStateName];
}

export function hasDetailedVoterData(stateName: string): boolean {
  const state = getStateDetails(stateName);
  return state?.hasDetailedVoterData ?? false;
}

export function hasDropBoxVoting(stateName: string): boolean {
  const state = getStateDetails(stateName);
  return state?.hasDropBoxVoting ?? false;
}
frontend/src/constants/choropleth.ts
-----
// Choropleth visualization options for splash page
export const SPLASH_CHOROPLETH_OPTIONS = {
  OFF: "off",
  EQUIPMENT_AGE: "equipment_age",
} as const;

// Choropleth visualization options for state analysis (detailed states)
export const STATE_CHOROPLETH_OPTIONS = {
  PROVISIONAL_BALLOTS: "provisional_ballots",
  ACTIVE_VOTERS: "active_voters",
  POLLBOOK_DELETIONS: "pollbook_deletions",
  MAIL_BALLOTS_REJECTED: "mail_ballots_rejected",
  VOTER_REGISTRATION: "voter_registration",
  VOTING_EQUIPMENT_TYPE: "voting_equipment_type",
  OFF: "off",
} as const;

export type SplashChoroplethOption =
  (typeof SPLASH_CHOROPLETH_OPTIONS)[keyof typeof SPLASH_CHOROPLETH_OPTIONS];

export type StateChoroplethOption =
  (typeof STATE_CHOROPLETH_OPTIONS)[keyof typeof STATE_CHOROPLETH_OPTIONS];

export type ChoroplethOption = SplashChoroplethOption | StateChoroplethOption;

export const SPLASH_CHOROPLETH_LABELS: Record<SplashChoroplethOption, string> =
  {
    [SPLASH_CHOROPLETH_OPTIONS.OFF]: "Off",
    [SPLASH_CHOROPLETH_OPTIONS.EQUIPMENT_AGE]: "Voting Equipment Age",
  };

export const STATE_CHOROPLETH_LABELS: Record<StateChoroplethOption, string> = {
  [STATE_CHOROPLETH_OPTIONS.PROVISIONAL_BALLOTS]: "Provisional Ballots",
  [STATE_CHOROPLETH_OPTIONS.ACTIVE_VOTERS]: "2024 EAVS Active Voters",
  [STATE_CHOROPLETH_OPTIONS.POLLBOOK_DELETIONS]: "2024 EAVS Pollbook Deletions",
  [STATE_CHOROPLETH_OPTIONS.MAIL_BALLOTS_REJECTED]: "Mail Ballots Rejected",
  [STATE_CHOROPLETH_OPTIONS.VOTER_REGISTRATION]: "Voter Registration",
  [STATE_CHOROPLETH_OPTIONS.VOTING_EQUIPMENT_TYPE]: "Voting Equipment Type",
  [STATE_CHOROPLETH_OPTIONS.OFF]: "Off",
};
frontend/src/components/voting-equipment-legend.tsx
-----
import { Card } from "@/components/ui/card";
import { VOTING_EQUIPMENT_COLORS } from "@/lib/colors";

interface VotingEquipmentLegendProps {
  data: Array<{
    eavsRegion: string;
    equipmentTypes: string[];
    primaryEquipment: string;
  }>;
}

export function VotingEquipmentLegend({ data }: VotingEquipmentLegendProps) {
  // Get unique equipment types from the data
  const equipmentCounts = data.reduce(
    (acc, item) => {
      const equipmentType =
        item.equipmentTypes.length > 1 ? "mixed" : item.primaryEquipment;
      acc[equipmentType] = (acc[equipmentType] || 0) + 1;
      return acc;
    },
    {} as Record<string, number>,
  );

  const equipmentLabels: Record<string, string> = {
    dre_no_vvpat: "DRE without VVPAT",
    dre_with_vvpat: "DRE with VVPAT",
    ballot_marking_device: "Ballot Marking Device",
    scanner: "Scanner",
    mixed: "Mixed Equipment Types",
  };

  return (
    <Card className="p-4">
      <h3 className="text-sm font-semibold mb-3">Voting Equipment Types</h3>
      <div className="space-y-2">
        {Object.entries(equipmentCounts).map(([type, count]) => (
          <div key={type} className="flex items-center gap-2">
            <div
              className="w-6 h-6 rounded border border-gray-300"
              style={{
                backgroundColor:
                  VOTING_EQUIPMENT_COLORS[
                    type as keyof typeof VOTING_EQUIPMENT_COLORS
                  ],
              }}
            />
            <div className="flex-1">
              <div className="text-xs font-medium">{equipmentLabels[type]}</div>
              <div className="text-xs text-muted-foreground">
                {count} {count === 1 ? "region" : "regions"}
              </div>
            </div>
          </div>
        ))}
      </div>
      <div className="mt-4 pt-4 border-t text-xs text-muted-foreground">
        <p className="mb-2">
          <strong>Legend:</strong> Colors indicate the primary voting equipment
          type used in each EAVS region.
        </p>
        <p>
          Regions using multiple equipment types are shown in purple (mixed).
        </p>
      </div>
    </Card>
  );
}
frontend/src/components/ui/tabs.tsx
-----
import * as React from "react";
import * as TabsPrimitive from "@radix-ui/react-tabs";

import { cn } from "@/lib/utils";

function Tabs({
  className,
  ...props
}: React.ComponentProps<typeof TabsPrimitive.Root>) {
  return (
    <TabsPrimitive.Root
      data-slot="tabs"
      className={cn("flex flex-col gap-2", className)}
      {...props}
    />
  );
}

function TabsList({
  className,
  ...props
}: React.ComponentProps<typeof TabsPrimitive.List>) {
  return (
    <TabsPrimitive.List
      data-slot="tabs-list"
      className={cn(
        "bg-muted text-muted-foreground inline-flex h-9 w-fit items-center justify-center rounded-lg p-[3px]",
        className,
      )}
      {...props}
    />
  );
}

function TabsTrigger({
  className,
  ...props
}: React.ComponentProps<typeof TabsPrimitive.Trigger>) {
  return (
    <TabsPrimitive.Trigger
      data-slot="tabs-trigger"
      className={cn(
        "data-[state=active]:bg-background dark:data-[state=active]:text-foreground focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:outline-ring dark:data-[state=active]:border-input dark:data-[state=active]:bg-input/30 text-foreground dark:text-muted-foreground inline-flex h-[calc(100%-1px)] flex-1 items-center justify-center gap-1.5 rounded-md border border-transparent px-2 py-1 text-sm font-medium whitespace-nowrap transition-[color,box-shadow] focus-visible:ring-[3px] focus-visible:outline-1 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:shadow-sm [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",
        className,
      )}
      {...props}
    />
  );
}

function TabsContent({
  className,
  ...props
}: React.ComponentProps<typeof TabsPrimitive.Content>) {
  return (
    <TabsPrimitive.Content
      data-slot="tabs-content"
      className={cn("flex-1 outline-none", className)}
      {...props}
    />
  );
}

export { Tabs, TabsList, TabsTrigger, TabsContent };
frontend/src/components/ui/card.tsx
-----
import * as React from "react";

import { cn } from "@/lib/utils";

const Card = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => (
  <div
    ref={ref}
    className={cn(
      "rounded-lg border bg-card text-card-foreground shadow-sm",
      className,
    )}
    {...props}
  />
));
Card.displayName = "Card";

const CardHeader = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => (
  <div
    ref={ref}
    className={cn("flex flex-col space-y-1.5 p-6", className)}
    {...props}
  />
));
CardHeader.displayName = "CardHeader";

const CardTitle = React.forwardRef<
  HTMLParagraphElement,
  React.HTMLAttributes<HTMLHeadingElement>
>(({ className, ...props }, ref) => (
  <h3
    ref={ref}
    className={cn(
      "text-2xl font-semibold leading-none tracking-tight",
      className,
    )}
    {...props}
  />
));
CardTitle.displayName = "CardTitle";

const CardDescription = React.forwardRef<
  HTMLParagraphElement,
  React.HTMLAttributes<HTMLParagraphElement>
>(({ className, ...props }, ref) => (
  <p
    ref={ref}
    className={cn("text-sm text-muted-foreground", className)}
    {...props}
  />
));
CardDescription.displayName = "CardDescription";

const CardContent = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => (
  <div ref={ref} className={cn("p-6 pt-0", className)} {...props} />
));
CardContent.displayName = "CardContent";

const CardFooter = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => (
  <div
    ref={ref}
    className={cn("flex items-center p-6 pt-0", className)}
    {...props}
  />
));
CardFooter.displayName = "CardFooter";

export {
  Card,
  CardHeader,
  CardFooter,
  CardTitle,
  CardDescription,
  CardContent,
};
frontend/src/components/ui/popover.tsx
-----
import * as React from "react";
import * as PopoverPrimitive from "@radix-ui/react-popover";

import { cn } from "@/lib/utils";

function Popover({
  ...props
}: React.ComponentProps<typeof PopoverPrimitive.Root>) {
  return <PopoverPrimitive.Root data-slot="popover" {...props} />;
}

function PopoverTrigger({
  ...props
}: React.ComponentProps<typeof PopoverPrimitive.Trigger>) {
  return <PopoverPrimitive.Trigger data-slot="popover-trigger" {...props} />;
}

function PopoverContent({
  className,
  align = "center",
  sideOffset = 4,
  ...props
}: React.ComponentProps<typeof PopoverPrimitive.Content>) {
  return (
    <PopoverPrimitive.Portal>
      <PopoverPrimitive.Content
        data-slot="popover-content"
        align={align}
        sideOffset={sideOffset}
        className={cn(
          "bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 w-72 origin-(--radix-popover-content-transform-origin) rounded-md border p-4 shadow-md outline-hidden",
          className,
        )}
        {...props}
      />
    </PopoverPrimitive.Portal>
  );
}

function PopoverAnchor({
  ...props
}: React.ComponentProps<typeof PopoverPrimitive.Anchor>) {
  return <PopoverPrimitive.Anchor data-slot="popover-anchor" {...props} />;
}

export { Popover, PopoverTrigger, PopoverContent, PopoverAnchor };
frontend/src/components/ui/sheet.tsx
-----
"use client";

import * as React from "react";
import * as SheetPrimitive from "@radix-ui/react-dialog";
import { XIcon } from "lucide-react";

import { cn } from "@/lib/utils";

function Sheet({ ...props }: React.ComponentProps<typeof SheetPrimitive.Root>) {
  return <SheetPrimitive.Root data-slot="sheet" {...props} />;
}

function SheetTrigger({
  ...props
}: React.ComponentProps<typeof SheetPrimitive.Trigger>) {
  return <SheetPrimitive.Trigger data-slot="sheet-trigger" {...props} />;
}

function SheetClose({
  ...props
}: React.ComponentProps<typeof SheetPrimitive.Close>) {
  return <SheetPrimitive.Close data-slot="sheet-close" {...props} />;
}

function SheetPortal({
  ...props
}: React.ComponentProps<typeof SheetPrimitive.Portal>) {
  return <SheetPrimitive.Portal data-slot="sheet-portal" {...props} />;
}

function SheetOverlay({
  className,
  ...props
}: React.ComponentProps<typeof SheetPrimitive.Overlay>) {
  return (
    <SheetPrimitive.Overlay
      data-slot="sheet-overlay"
      className={cn(
        "data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",
        className,
      )}
      {...props}
    />
  );
}

function SheetContent({
  className,
  children,
  side = "right",
  ...props
}: React.ComponentProps<typeof SheetPrimitive.Content> & {
  side?: "top" | "right" | "bottom" | "left";
}) {
  return (
    <SheetPortal>
      <SheetOverlay />
      <SheetPrimitive.Content
        data-slot="sheet-content"
        className={cn(
          "bg-background data-[state=open]:animate-in data-[state=closed]:animate-out fixed z-50 flex flex-col gap-4 shadow-lg transition ease-in-out data-[state=closed]:duration-300 data-[state=open]:duration-500",
          side === "right" &&
            "data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right inset-y-0 right-0 h-full w-3/4 border-l sm:max-w-sm",
          side === "left" &&
            "data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left inset-y-0 left-0 h-full w-3/4 border-r sm:max-w-sm",
          side === "top" &&
            "data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top inset-x-0 top-0 h-auto border-b",
          side === "bottom" &&
            "data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom inset-x-0 bottom-0 h-auto border-t",
          className,
        )}
        {...props}
      >
        {children}
        <SheetPrimitive.Close className="ring-offset-background focus:ring-ring data-[state=open]:bg-secondary absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none">
          <XIcon className="size-4" />
          <span className="sr-only">Close</span>
        </SheetPrimitive.Close>
      </SheetPrimitive.Content>
    </SheetPortal>
  );
}

function SheetHeader({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="sheet-header"
      className={cn("flex flex-col gap-1.5 p-4", className)}
      {...props}
    />
  );
}

function SheetFooter({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="sheet-footer"
      className={cn("mt-auto flex flex-col gap-2 p-4", className)}
      {...props}
    />
  );
}

function SheetTitle({
  className,
  ...props
}: React.ComponentProps<typeof SheetPrimitive.Title>) {
  return (
    <SheetPrimitive.Title
      data-slot="sheet-title"
      className={cn("text-foreground font-semibold", className)}
      {...props}
    />
  );
}

function SheetDescription({
  className,
  ...props
}: React.ComponentProps<typeof SheetPrimitive.Description>) {
  return (
    <SheetPrimitive.Description
      data-slot="sheet-description"
      className={cn("text-muted-foreground text-sm", className)}
      {...props}
    />
  );
}

export {
  Sheet,
  SheetTrigger,
  SheetClose,
  SheetContent,
  SheetHeader,
  SheetFooter,
  SheetTitle,
  SheetDescription,
};
frontend/src/components/ui/drawer.tsx
-----
import * as React from "react";
import { Drawer as DrawerPrimitive } from "vaul";

import { cn } from "@/lib/utils";

function Drawer({
  direction = "left",
  ...props
}: React.ComponentProps<typeof DrawerPrimitive.Root>) {
  return (
    <DrawerPrimitive.Root data-slot="drawer" direction={direction} {...props} />
  );
}

function DrawerTrigger({
  ...props
}: React.ComponentProps<typeof DrawerPrimitive.Trigger>) {
  return <DrawerPrimitive.Trigger data-slot="drawer-trigger" {...props} />;
}

function DrawerPortal({
  ...props
}: React.ComponentProps<typeof DrawerPrimitive.Portal>) {
  return <DrawerPrimitive.Portal data-slot="drawer-portal" {...props} />;
}

function DrawerClose({
  ...props
}: React.ComponentProps<typeof DrawerPrimitive.Close>) {
  return <DrawerPrimitive.Close data-slot="drawer-close" {...props} />;
}

function DrawerOverlay({
  className,
  ...props
}: React.ComponentProps<typeof DrawerPrimitive.Overlay>) {
  return (
    <DrawerPrimitive.Overlay
      data-slot="drawer-overlay"
      className={cn(
        "data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",
        className,
      )}
      {...props}
    />
  );
}

function DrawerContent({
  className,
  children,
  ...props
}: React.ComponentProps<typeof DrawerPrimitive.Content>) {
  return (
    <DrawerPortal data-slot="drawer-portal">
      <DrawerOverlay />
      <DrawerPrimitive.Content
        data-slot="drawer-content"
        className={cn(
          "group/drawer-content bg-background fixed z-50 flex h-auto flex-col",
          "data-[vaul-drawer-direction=top]:inset-x-0 data-[vaul-drawer-direction=top]:top-0 data-[vaul-drawer-direction=top]:mb-24 data-[vaul-drawer-direction=top]:max-h-[80vh] data-[vaul-drawer-direction=top]:rounded-b-lg data-[vaul-drawer-direction=top]:border-b",
          "data-[vaul-drawer-direction=bottom]:inset-x-0 data-[vaul-drawer-direction=bottom]:bottom-0 data-[vaul-drawer-direction=bottom]:mt-24 data-[vaul-drawer-direction=bottom]:max-h-[80vh] data-[vaul-drawer-direction=bottom]:rounded-t-lg data-[vaul-drawer-direction=bottom]:border-t",
          "data-[vaul-drawer-direction=right]:inset-y-0 data-[vaul-drawer-direction=right]:right-0 data-[vaul-drawer-direction=right]:w-3/4 data-[vaul-drawer-direction=right]:border-l data-[vaul-drawer-direction=right]:sm:max-w-sm",
          "data-[vaul-drawer-direction=left]:inset-y-0 data-[vaul-drawer-direction=left]:left-0 data-[vaul-drawer-direction=left]:w-3/4 data-[vaul-drawer-direction=left]:border-r data-[vaul-drawer-direction=left]:sm:max-w-sm",
          className,
        )}
        {...props}
      >
        <div className="bg-muted mx-auto mt-4 hidden h-2 w-[100px] shrink-0 rounded-full group-data-[vaul-drawer-direction=bottom]/drawer-content:block" />
        {children}
      </DrawerPrimitive.Content>
    </DrawerPortal>
  );
}

function DrawerHeader({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="drawer-header"
      className={cn(
        "flex flex-col gap-0.5 p-4 group-data-[vaul-drawer-direction=bottom]/drawer-content:text-center group-data-[vaul-drawer-direction=top]/drawer-content:text-center md:gap-1.5 md:text-left",
        className,
      )}
      {...props}
    />
  );
}

function DrawerFooter({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="drawer-footer"
      className={cn("mt-auto flex flex-col gap-2 p-4", className)}
      {...props}
    />
  );
}

function DrawerTitle({
  className,
  ...props
}: React.ComponentProps<typeof DrawerPrimitive.Title>) {
  return (
    <DrawerPrimitive.Title
      data-slot="drawer-title"
      className={cn("text-foreground font-semibold", className)}
      {...props}
    />
  );
}

function DrawerDescription({
  className,
  ...props
}: React.ComponentProps<typeof DrawerPrimitive.Description>) {
  return (
    <DrawerPrimitive.Description
      data-slot="drawer-description"
      className={cn("text-muted-foreground text-sm", className)}
      {...props}
    />
  );
}

export {
  Drawer,
  DrawerPortal,
  DrawerOverlay,
  DrawerTrigger,
  DrawerClose,
  DrawerContent,
  DrawerHeader,
  DrawerFooter,
  DrawerTitle,
  DrawerDescription,
};
frontend/src/components/ui/tooltip.tsx
-----
import * as React from "react";
import * as TooltipPrimitive from "@radix-ui/react-tooltip";

import { cn } from "@/lib/utils";

function TooltipProvider({
  delayDuration = 0,
  ...props
}: React.ComponentProps<typeof TooltipPrimitive.Provider>) {
  return (
    <TooltipPrimitive.Provider
      data-slot="tooltip-provider"
      delayDuration={delayDuration}
      {...props}
    />
  );
}

function Tooltip({
  ...props
}: React.ComponentProps<typeof TooltipPrimitive.Root>) {
  return (
    <TooltipProvider>
      <TooltipPrimitive.Root data-slot="tooltip" {...props} />
    </TooltipProvider>
  );
}

function TooltipTrigger({
  ...props
}: React.ComponentProps<typeof TooltipPrimitive.Trigger>) {
  return <TooltipPrimitive.Trigger data-slot="tooltip-trigger" {...props} />;
}

function TooltipContent({
  className,
  sideOffset = 0,
  children,
  ...props
}: React.ComponentProps<typeof TooltipPrimitive.Content>) {
  return (
    <TooltipPrimitive.Portal>
      <TooltipPrimitive.Content
        data-slot="tooltip-content"
        sideOffset={sideOffset}
        className={cn(
          "bg-foreground text-background animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 w-fit origin-(--radix-tooltip-content-transform-origin) rounded-md px-3 py-1.5 text-xs text-balance",
          className,
        )}
        {...props}
      >
        {children}
        <TooltipPrimitive.Arrow className="bg-foreground fill-foreground z-50 size-2.5 translate-y-[calc(-50%_-_2px)] rotate-45 rounded-[2px]" />
      </TooltipPrimitive.Content>
    </TooltipPrimitive.Portal>
  );
}

export { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider };
frontend/src/components/ui/command.tsx
-----
"use client";

import * as React from "react";
import { Command as CommandPrimitive } from "cmdk";
import { SearchIcon } from "lucide-react";

import { cn } from "@/lib/utils";
import {
  Dialog,
  DialogContent,
  DialogDescription,
  DialogHeader,
  DialogTitle,
} from "@/components/ui/dialog";

function Command({
  className,
  ...props
}: React.ComponentProps<typeof CommandPrimitive>) {
  return (
    <CommandPrimitive
      data-slot="command"
      className={cn(
        "bg-popover text-popover-foreground flex h-full w-full flex-col overflow-hidden rounded-md",
        className,
      )}
      {...props}
    />
  );
}

function CommandDialog({
  title = "Command Palette",
  description = "Search for a command to run...",
  children,
  className,
  showCloseButton = true,
  ...props
}: React.ComponentProps<typeof Dialog> & {
  title?: string;
  description?: string;
  className?: string;
  showCloseButton?: boolean;
}) {
  return (
    <Dialog {...props}>
      <DialogHeader className="sr-only">
        <DialogTitle>{title}</DialogTitle>
        <DialogDescription>{description}</DialogDescription>
      </DialogHeader>
      <DialogContent
        className={cn("overflow-hidden p-0", className)}
        showCloseButton={showCloseButton}
      >
        <Command className="[&_[cmdk-group-heading]]:text-muted-foreground **:data-[slot=command-input-wrapper]:h-12 [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group]]:px-2 [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5">
          {children}
        </Command>
      </DialogContent>
    </Dialog>
  );
}

function CommandInput({
  className,
  ...props
}: React.ComponentProps<typeof CommandPrimitive.Input>) {
  return (
    <div
      data-slot="command-input-wrapper"
      className="flex h-9 items-center gap-2 border-b px-3"
    >
      <SearchIcon className="size-4 shrink-0 opacity-50" />
      <CommandPrimitive.Input
        data-slot="command-input"
        className={cn(
          "placeholder:text-muted-foreground flex h-10 w-full rounded-md bg-transparent py-3 text-sm outline-hidden disabled:cursor-not-allowed disabled:opacity-50",
          className,
        )}
        {...props}
      />
    </div>
  );
}

function CommandList({
  className,
  ...props
}: React.ComponentProps<typeof CommandPrimitive.List>) {
  return (
    <CommandPrimitive.List
      data-slot="command-list"
      className={cn(
        "max-h-[300px] scroll-py-1 overflow-x-hidden overflow-y-auto",
        className,
      )}
      {...props}
    />
  );
}

function CommandEmpty({
  ...props
}: React.ComponentProps<typeof CommandPrimitive.Empty>) {
  return (
    <CommandPrimitive.Empty
      data-slot="command-empty"
      className="py-6 text-center text-sm"
      {...props}
    />
  );
}

function CommandGroup({
  className,
  ...props
}: React.ComponentProps<typeof CommandPrimitive.Group>) {
  return (
    <CommandPrimitive.Group
      data-slot="command-group"
      className={cn(
        "text-foreground [&_[cmdk-group-heading]]:text-muted-foreground overflow-hidden p-1 [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium",
        className,
      )}
      {...props}
    />
  );
}

function CommandSeparator({
  className,
  ...props
}: React.ComponentProps<typeof CommandPrimitive.Separator>) {
  return (
    <CommandPrimitive.Separator
      data-slot="command-separator"
      className={cn("bg-border -mx-1 h-px", className)}
      {...props}
    />
  );
}

function CommandItem({
  className,
  ...props
}: React.ComponentProps<typeof CommandPrimitive.Item>) {
  return (
    <CommandPrimitive.Item
      data-slot="command-item"
      className={cn(
        "data-[selected=true]:bg-accent data-[selected=true]:text-accent-foreground [&_svg:not([class*='text-'])]:text-muted-foreground relative flex cursor-default items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-hidden select-none data-[disabled=true]:pointer-events-none data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",
        className,
      )}
      {...props}
    />
  );
}

function CommandShortcut({
  className,
  ...props
}: React.ComponentProps<"span">) {
  return (
    <span
      data-slot="command-shortcut"
      className={cn(
        "text-muted-foreground ml-auto text-xs tracking-widest",
        className,
      )}
      {...props}
    />
  );
}

export {
  Command,
  CommandDialog,
  CommandInput,
  CommandList,
  CommandEmpty,
  CommandGroup,
  CommandItem,
  CommandShortcut,
  CommandSeparator,
};
frontend/src/components/ui/dialog.tsx
-----
import * as React from "react";
import * as DialogPrimitive from "@radix-ui/react-dialog";
import { XIcon } from "lucide-react";

import { cn } from "@/lib/utils";

function Dialog({
  ...props
}: React.ComponentProps<typeof DialogPrimitive.Root>) {
  return <DialogPrimitive.Root data-slot="dialog" {...props} />;
}

function DialogTrigger({
  ...props
}: React.ComponentProps<typeof DialogPrimitive.Trigger>) {
  return <DialogPrimitive.Trigger data-slot="dialog-trigger" {...props} />;
}

function DialogPortal({
  ...props
}: React.ComponentProps<typeof DialogPrimitive.Portal>) {
  return <DialogPrimitive.Portal data-slot="dialog-portal" {...props} />;
}

function DialogClose({
  ...props
}: React.ComponentProps<typeof DialogPrimitive.Close>) {
  return <DialogPrimitive.Close data-slot="dialog-close" {...props} />;
}

function DialogOverlay({
  className,
  ...props
}: React.ComponentProps<typeof DialogPrimitive.Overlay>) {
  return (
    <DialogPrimitive.Overlay
      data-slot="dialog-overlay"
      className={cn(
        "data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",
        className,
      )}
      {...props}
    />
  );
}

function DialogContent({
  className,
  children,
  showCloseButton = true,
  ...props
}: React.ComponentProps<typeof DialogPrimitive.Content> & {
  showCloseButton?: boolean;
}) {
  return (
    <DialogPortal data-slot="dialog-portal">
      <DialogOverlay />
      <DialogPrimitive.Content
        data-slot="dialog-content"
        className={cn(
          "bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",
          className,
        )}
        {...props}
      >
        {children}
        {showCloseButton && (
          <DialogPrimitive.Close
            data-slot="dialog-close"
            className="ring-offset-background focus:ring-ring data-[state=open]:bg-accent data-[state=open]:text-muted-foreground absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4"
          >
            <XIcon />
            <span className="sr-only">Close</span>
          </DialogPrimitive.Close>
        )}
      </DialogPrimitive.Content>
    </DialogPortal>
  );
}

function DialogHeader({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="dialog-header"
      className={cn("flex flex-col gap-2 text-center sm:text-left", className)}
      {...props}
    />
  );
}

function DialogFooter({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="dialog-footer"
      className={cn(
        "flex flex-col-reverse gap-2 sm:flex-row sm:justify-end",
        className,
      )}
      {...props}
    />
  );
}

function DialogTitle({
  className,
  ...props
}: React.ComponentProps<typeof DialogPrimitive.Title>) {
  return (
    <DialogPrimitive.Title
      data-slot="dialog-title"
      className={cn("text-lg leading-none font-semibold", className)}
      {...props}
    />
  );
}

function DialogDescription({
  className,
  ...props
}: React.ComponentProps<typeof DialogPrimitive.Description>) {
  return (
    <DialogPrimitive.Description
      data-slot="dialog-description"
      className={cn("text-muted-foreground text-sm", className)}
      {...props}
    />
  );
}

export {
  Dialog,
  DialogClose,
  DialogContent,
  DialogDescription,
  DialogFooter,
  DialogHeader,
  DialogOverlay,
  DialogPortal,
  DialogTitle,
  DialogTrigger,
};
frontend/src/components/ui/badge.tsx
-----
import * as React from "react";
import { cva, type VariantProps } from "class-variance-authority";

import { cn } from "@/lib/utils";

const badgeVariants = cva(
  "inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",
  {
    variants: {
      variant: {
        default:
          "border-transparent bg-primary text-primary-foreground hover:bg-primary/80",
        secondary:
          "border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",
        destructive:
          "border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",
        outline: "text-foreground",
      },
    },
    defaultVariants: {
      variant: "default",
    },
  },
);

export interface BadgeProps
  extends React.HTMLAttributes<HTMLDivElement>,
    VariantProps<typeof badgeVariants> {}

function Badge({ className, variant, ...props }: BadgeProps) {
  return (
    <div className={cn(badgeVariants({ variant }), className)} {...props} />
  );
}

// eslint-disable-next-line react-refresh/only-export-components
export { Badge, badgeVariants };
frontend/src/components/ui/sidebar.tsx
-----
"use client";

import * as React from "react";
import { Slot } from "@radix-ui/react-slot";
import { cva, type VariantProps } from "class-variance-authority";
import { PanelLeftIcon } from "lucide-react";

import { useIsMobile } from "@/hooks/use-mobile";
import { cn } from "@/lib/utils";
import { Button } from "@/components/ui/button";
import { Input } from "@/components/ui/input";
import { Separator } from "@/components/ui/separator";
import {
  Sheet,
  SheetContent,
  SheetDescription,
  SheetHeader,
  SheetTitle,
} from "@/components/ui/sheet";
import { Skeleton } from "@/components/ui/skeleton";
import {
  Tooltip,
  TooltipContent,
  TooltipProvider,
  TooltipTrigger,
} from "@/components/ui/tooltip";

const SIDEBAR_COOKIE_NAME = "sidebar_state";
const SIDEBAR_COOKIE_MAX_AGE = 60 * 60 * 24 * 7;
const SIDEBAR_WIDTH = "16rem";
const SIDEBAR_WIDTH_MOBILE = "18rem";
const SIDEBAR_WIDTH_ICON = "3rem";
const SIDEBAR_KEYBOARD_SHORTCUT = "b";

type SidebarContextProps = {
  state: "expanded" | "collapsed";
  open: boolean;
  setOpen: (open: boolean) => void;
  openMobile: boolean;
  setOpenMobile: (open: boolean) => void;
  isMobile: boolean;
  toggleSidebar: () => void;
};

const SidebarContext = React.createContext<SidebarContextProps | null>(null);

function useSidebar() {
  const context = React.useContext(SidebarContext);
  if (!context) {
    throw new Error("useSidebar must be used within a SidebarProvider.");
  }

  return context;
}

function SidebarProvider({
  defaultOpen = true,
  open: openProp,
  onOpenChange: setOpenProp,
  className,
  style,
  children,
  ...props
}: React.ComponentProps<"div"> & {
  defaultOpen?: boolean;
  open?: boolean;
  onOpenChange?: (open: boolean) => void;
}) {
  const isMobile = useIsMobile();
  const [openMobile, setOpenMobile] = React.useState(false);

  // This is the internal state of the sidebar.
  // We use openProp and setOpenProp for control from outside the component.
  const [_open, _setOpen] = React.useState(defaultOpen);
  const open = openProp ?? _open;
  const setOpen = React.useCallback(
    (value: boolean | ((value: boolean) => boolean)) => {
      const openState = typeof value === "function" ? value(open) : value;
      if (setOpenProp) {
        setOpenProp(openState);
      } else {
        _setOpen(openState);
      }

      // This sets the cookie to keep the sidebar state.
      document.cookie = `${SIDEBAR_COOKIE_NAME}=${openState}; path=/; max-age=${SIDEBAR_COOKIE_MAX_AGE}`;
    },
    [setOpenProp, open],
  );

  // Helper to toggle the sidebar.
  const toggleSidebar = React.useCallback(() => {
    return isMobile ? setOpenMobile((open) => !open) : setOpen((open) => !open);
  }, [isMobile, setOpen, setOpenMobile]);

  // Adds a keyboard shortcut to toggle the sidebar.
  React.useEffect(() => {
    const handleKeyDown = (event: KeyboardEvent) => {
      if (
        event.key === SIDEBAR_KEYBOARD_SHORTCUT &&
        (event.metaKey || event.ctrlKey)
      ) {
        event.preventDefault();
        toggleSidebar();
      }
    };

    window.addEventListener("keydown", handleKeyDown);
    return () => window.removeEventListener("keydown", handleKeyDown);
  }, [toggleSidebar]);

  // We add a state so that we can do data-state="expanded" or "collapsed".
  // This makes it easier to style the sidebar with Tailwind classes.
  const state = open ? "expanded" : "collapsed";

  const contextValue = React.useMemo<SidebarContextProps>(
    () => ({
      state,
      open,
      setOpen,
      isMobile,
      openMobile,
      setOpenMobile,
      toggleSidebar,
    }),
    [state, open, setOpen, isMobile, openMobile, setOpenMobile, toggleSidebar],
  );

  return (
    <SidebarContext.Provider value={contextValue}>
      <TooltipProvider delayDuration={0}>
        <div
          data-slot="sidebar-wrapper"
          style={
            {
              "--sidebar-width": SIDEBAR_WIDTH,
              "--sidebar-width-icon": SIDEBAR_WIDTH_ICON,
              ...style,
            } as React.CSSProperties
          }
          className={cn(
            "group/sidebar-wrapper has-data-[variant=inset]:bg-sidebar flex min-h-svh w-full",
            className,
          )}
          {...props}
        >
          {children}
        </div>
      </TooltipProvider>
    </SidebarContext.Provider>
  );
}

function Sidebar({
  side = "left",
  variant = "sidebar",
  collapsible = "offcanvas",
  className,
  children,
  ...props
}: React.ComponentProps<"div"> & {
  side?: "left" | "right";
  variant?: "sidebar" | "floating" | "inset";
  collapsible?: "offcanvas" | "icon" | "none";
}) {
  const { isMobile, state, openMobile, setOpenMobile } = useSidebar();

  if (collapsible === "none") {
    return (
      <div
        data-slot="sidebar"
        className={cn(
          "bg-sidebar text-sidebar-foreground flex h-full w-(--sidebar-width) flex-col",
          className,
        )}
        {...props}
      >
        {children}
      </div>
    );
  }

  if (isMobile) {
    return (
      <Sheet open={openMobile} onOpenChange={setOpenMobile} {...props}>
        <SheetContent
          data-sidebar="sidebar"
          data-slot="sidebar"
          data-mobile="true"
          className="bg-sidebar text-sidebar-foreground w-(--sidebar-width) p-0 [&>button]:hidden"
          style={
            {
              "--sidebar-width": SIDEBAR_WIDTH_MOBILE,
            } as React.CSSProperties
          }
          side={side}
        >
          <SheetHeader className="sr-only">
            <SheetTitle>Sidebar</SheetTitle>
            <SheetDescription>Displays the mobile sidebar.</SheetDescription>
          </SheetHeader>
          <div className="flex h-full w-full flex-col">{children}</div>
        </SheetContent>
      </Sheet>
    );
  }

  return (
    <div
      className="group peer text-sidebar-foreground hidden md:block"
      data-state={state}
      data-collapsible={state === "collapsed" ? collapsible : ""}
      data-variant={variant}
      data-side={side}
      data-slot="sidebar"
    >
      {/* This is what handles the sidebar gap on desktop */}
      <div
        data-slot="sidebar-gap"
        className={cn(
          "relative w-(--sidebar-width) bg-transparent transition-[width] duration-200 ease-linear",
          "group-data-[collapsible=offcanvas]:w-0",
          "group-data-[side=right]:rotate-180",
          variant === "floating" || variant === "inset"
            ? "group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+(--spacing(4)))]"
            : "group-data-[collapsible=icon]:w-(--sidebar-width-icon)",
        )}
      />
      <div
        data-slot="sidebar-container"
        className={cn(
          "fixed inset-y-0 z-10 hidden h-svh w-(--sidebar-width) transition-[left,right,width] duration-200 ease-linear md:flex",
          side === "left"
            ? "left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]"
            : "right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]",
          // Adjust the padding for floating and inset variants.
          variant === "floating" || variant === "inset"
            ? "p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+(--spacing(4))+2px)]"
            : "group-data-[collapsible=icon]:w-(--sidebar-width-icon) group-data-[side=left]:border-r group-data-[side=right]:border-l",
          className,
        )}
        {...props}
      >
        <div
          data-sidebar="sidebar"
          data-slot="sidebar-inner"
          className="bg-sidebar group-data-[variant=floating]:border-sidebar-border flex h-full w-full flex-col group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:shadow-sm"
        >
          {children}
        </div>
      </div>
    </div>
  );
}

function SidebarTrigger({
  className,
  onClick,
  ...props
}: React.ComponentProps<typeof Button>) {
  const { toggleSidebar } = useSidebar();

  return (
    <Button
      data-sidebar="trigger"
      data-slot="sidebar-trigger"
      variant="ghost"
      size="icon"
      className={cn("size-7", className)}
      onClick={(event) => {
        onClick?.(event);
        toggleSidebar();
      }}
      {...props}
    >
      <PanelLeftIcon />
      <span className="sr-only">Toggle Sidebar</span>
    </Button>
  );
}

function SidebarRail({ className, ...props }: React.ComponentProps<"button">) {
  const { toggleSidebar } = useSidebar();

  return (
    <button
      data-sidebar="rail"
      data-slot="sidebar-rail"
      aria-label="Toggle Sidebar"
      tabIndex={-1}
      onClick={toggleSidebar}
      title="Toggle Sidebar"
      className={cn(
        "hover:after:bg-sidebar-border absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear group-data-[side=left]:-right-4 group-data-[side=right]:left-0 after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] sm:flex",
        "in-data-[side=left]:cursor-w-resize in-data-[side=right]:cursor-e-resize",
        "[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize",
        "hover:group-data-[collapsible=offcanvas]:bg-sidebar group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full",
        "[[data-side=left][data-collapsible=offcanvas]_&]:-right-2",
        "[[data-side=right][data-collapsible=offcanvas]_&]:-left-2",
        className,
      )}
      {...props}
    />
  );
}

function SidebarInset({ className, ...props }: React.ComponentProps<"main">) {
  return (
    <main
      data-slot="sidebar-inset"
      className={cn(
        "bg-background relative flex w-full flex-1 flex-col",
        "md:peer-data-[variant=inset]:m-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow-sm md:peer-data-[variant=inset]:peer-data-[state=collapsed]:ml-2",
        className,
      )}
      {...props}
    />
  );
}

function SidebarInput({
  className,
  ...props
}: React.ComponentProps<typeof Input>) {
  return (
    <Input
      data-slot="sidebar-input"
      data-sidebar="input"
      className={cn("bg-background h-8 w-full shadow-none", className)}
      {...props}
    />
  );
}

function SidebarHeader({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="sidebar-header"
      data-sidebar="header"
      className={cn("flex flex-col gap-2 p-2", className)}
      {...props}
    />
  );
}

function SidebarFooter({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="sidebar-footer"
      data-sidebar="footer"
      className={cn("flex flex-col gap-2 p-2", className)}
      {...props}
    />
  );
}

function SidebarSeparator({
  className,
  ...props
}: React.ComponentProps<typeof Separator>) {
  return (
    <Separator
      data-slot="sidebar-separator"
      data-sidebar="separator"
      className={cn("bg-sidebar-border mx-2 w-auto", className)}
      {...props}
    />
  );
}

function SidebarContent({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="sidebar-content"
      data-sidebar="content"
      className={cn(
        "flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden",
        className,
      )}
      {...props}
    />
  );
}

function SidebarGroup({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="sidebar-group"
      data-sidebar="group"
      className={cn("relative flex w-full min-w-0 flex-col p-2", className)}
      {...props}
    />
  );
}

function SidebarGroupLabel({
  className,
  asChild = false,
  ...props
}: React.ComponentProps<"div"> & { asChild?: boolean }) {
  const Comp = asChild ? Slot : "div";

  return (
    <Comp
      data-slot="sidebar-group-label"
      data-sidebar="group-label"
      className={cn(
        "text-sidebar-foreground/70 ring-sidebar-ring flex h-8 shrink-0 items-center rounded-md px-2 text-sm font-medium outline-hidden transition-[margin,opacity] duration-200 ease-linear focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0",
        "group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0",
        className,
      )}
      {...props}
    />
  );
}

function SidebarGroupAction({
  className,
  asChild = false,
  ...props
}: React.ComponentProps<"button"> & { asChild?: boolean }) {
  const Comp = asChild ? Slot : "button";

  return (
    <Comp
      data-slot="sidebar-group-action"
      data-sidebar="group-action"
      className={cn(
        "text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground absolute top-3.5 right-3 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0",
        // Increases the hit area of the button on mobile.
        "after:absolute after:-inset-2 md:after:hidden",
        "group-data-[collapsible=icon]:hidden",
        className,
      )}
      {...props}
    />
  );
}

function SidebarGroupContent({
  className,
  ...props
}: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="sidebar-group-content"
      data-sidebar="group-content"
      className={cn("w-full text-sm", className)}
      {...props}
    />
  );
}

function SidebarMenu({ className, ...props }: React.ComponentProps<"ul">) {
  return (
    <ul
      data-slot="sidebar-menu"
      data-sidebar="menu"
      className={cn("flex w-full min-w-0 flex-col gap-1", className)}
      {...props}
    />
  );
}

function SidebarMenuItem({ className, ...props }: React.ComponentProps<"li">) {
  return (
    <li
      data-slot="sidebar-menu-item"
      data-sidebar="menu-item"
      className={cn("group/menu-item relative", className)}
      {...props}
    />
  );
}

const sidebarMenuButtonVariants = cva(
  "peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-hidden ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-data-[sidebar=menu-action]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:size-8! group-data-[collapsible=icon]:p-2! [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0",
  {
    variants: {
      variant: {
        default: "hover:bg-sidebar-accent hover:text-sidebar-accent-foreground",
        outline:
          "bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]",
      },
      size: {
        default: "h-8 text-sm",
        sm: "h-7 text-xs",
        lg: "h-12 text-sm group-data-[collapsible=icon]:p-0!",
      },
    },
    defaultVariants: {
      variant: "default",
      size: "default",
    },
  },
);

function SidebarMenuButton({
  asChild = false,
  isActive = false,
  variant = "default",
  size = "default",
  tooltip,
  className,
  ...props
}: React.ComponentProps<"button"> & {
  asChild?: boolean;
  isActive?: boolean;
  tooltip?: string | React.ComponentProps<typeof TooltipContent>;
} & VariantProps<typeof sidebarMenuButtonVariants>) {
  const Comp = asChild ? Slot : "button";
  const { isMobile, state } = useSidebar();

  const button = (
    <Comp
      data-slot="sidebar-menu-button"
      data-sidebar="menu-button"
      data-size={size}
      data-active={isActive}
      className={cn(sidebarMenuButtonVariants({ variant, size }), className)}
      {...props}
    />
  );

  if (!tooltip) {
    return button;
  }

  if (typeof tooltip === "string") {
    tooltip = {
      children: tooltip,
    };
  }

  return (
    <Tooltip>
      <TooltipTrigger asChild>{button}</TooltipTrigger>
      <TooltipContent
        side="right"
        align="center"
        hidden={state !== "collapsed" || isMobile}
        {...tooltip}
      />
    </Tooltip>
  );
}

function SidebarMenuAction({
  className,
  asChild = false,
  showOnHover = false,
  ...props
}: React.ComponentProps<"button"> & {
  asChild?: boolean;
  showOnHover?: boolean;
}) {
  const Comp = asChild ? Slot : "button";

  return (
    <Comp
      data-slot="sidebar-menu-action"
      data-sidebar="menu-action"
      className={cn(
        "text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground peer-hover/menu-button:text-sidebar-accent-foreground absolute top-1.5 right-1 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0",
        // Increases the hit area of the button on mobile.
        "after:absolute after:-inset-2 md:after:hidden",
        "peer-data-[size=sm]/menu-button:top-1",
        "peer-data-[size=default]/menu-button:top-1.5",
        "peer-data-[size=lg]/menu-button:top-2.5",
        "group-data-[collapsible=icon]:hidden",
        showOnHover &&
          "peer-data-[active=true]/menu-button:text-sidebar-accent-foreground group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 md:opacity-0",
        className,
      )}
      {...props}
    />
  );
}

function SidebarMenuBadge({
  className,
  ...props
}: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="sidebar-menu-badge"
      data-sidebar="menu-badge"
      className={cn(
        "text-sidebar-foreground pointer-events-none absolute right-1 flex h-5 min-w-5 items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums select-none",
        "peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground",
        "peer-data-[size=sm]/menu-button:top-1",
        "peer-data-[size=default]/menu-button:top-1.5",
        "peer-data-[size=lg]/menu-button:top-2.5",
        "group-data-[collapsible=icon]:hidden",
        className,
      )}
      {...props}
    />
  );
}

function SidebarMenuSkeleton({
  className,
  showIcon = false,
  ...props
}: React.ComponentProps<"div"> & {
  showIcon?: boolean;
}) {
  // Random width between 50 to 90%.
  const width = React.useMemo(() => {
    return `${Math.floor(Math.random() * 40) + 50}%`;
  }, []);

  return (
    <div
      data-slot="sidebar-menu-skeleton"
      data-sidebar="menu-skeleton"
      className={cn("flex h-8 items-center gap-2 rounded-md px-2", className)}
      {...props}
    >
      {showIcon && (
        <Skeleton
          className="size-4 rounded-md"
          data-sidebar="menu-skeleton-icon"
        />
      )}
      <Skeleton
        className="h-4 max-w-(--skeleton-width) flex-1"
        data-sidebar="menu-skeleton-text"
        style={
          {
            "--skeleton-width": width,
          } as React.CSSProperties
        }
      />
    </div>
  );
}

function SidebarMenuSub({ className, ...props }: React.ComponentProps<"ul">) {
  return (
    <ul
      data-slot="sidebar-menu-sub"
      data-sidebar="menu-sub"
      className={cn(
        "border-sidebar-border mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l px-2.5 py-0.5",
        "group-data-[collapsible=icon]:hidden",
        className,
      )}
      {...props}
    />
  );
}

function SidebarMenuSubItem({
  className,
  ...props
}: React.ComponentProps<"li">) {
  return (
    <li
      data-slot="sidebar-menu-sub-item"
      data-sidebar="menu-sub-item"
      className={cn("group/menu-sub-item relative", className)}
      {...props}
    />
  );
}

function SidebarMenuSubButton({
  asChild = false,
  size = "md",
  isActive = false,
  className,
  ...props
}: React.ComponentProps<"a"> & {
  asChild?: boolean;
  size?: "sm" | "md";
  isActive?: boolean;
}) {
  const Comp = asChild ? Slot : "a";

  return (
    <Comp
      data-slot="sidebar-menu-sub-button"
      data-sidebar="menu-sub-button"
      data-size={size}
      data-active={isActive}
      className={cn(
        "text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground active:bg-sidebar-accent active:text-sidebar-accent-foreground [&>svg]:text-sidebar-accent-foreground flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 outline-hidden focus-visible:ring-2 disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0",
        "data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground",
        size === "sm" && "text-xs",
        size === "md" && "text-sm",
        "group-data-[collapsible=icon]:hidden",
        className,
      )}
      {...props}
    />
  );
}

export {
  Sidebar,
  SidebarContent,
  SidebarFooter,
  SidebarGroup,
  SidebarGroupAction,
  SidebarGroupContent,
  SidebarGroupLabel,
  SidebarHeader,
  SidebarInput,
  SidebarInset,
  SidebarMenu,
  SidebarMenuAction,
  SidebarMenuBadge,
  SidebarMenuButton,
  SidebarMenuItem,
  SidebarMenuSkeleton,
  SidebarMenuSub,
  SidebarMenuSubButton,
  SidebarMenuSubItem,
  SidebarProvider,
  SidebarRail,
  SidebarSeparator,
  SidebarTrigger,
  // eslint-disable-next-line react-refresh/only-export-components
  useSidebar,
};
frontend/src/components/ui/table.tsx
-----
import * as React from "react";

import { cn } from "@/lib/utils";

function Table({ className, ...props }: React.ComponentProps<"table">) {
  return (
    <div
      data-slot="table-container"
      className="relative w-full overflow-x-auto"
    >
      <table
        data-slot="table"
        className={cn("w-full caption-bottom text-sm", className)}
        {...props}
      />
    </div>
  );
}

function TableHeader({ className, ...props }: React.ComponentProps<"thead">) {
  return (
    <thead
      data-slot="table-header"
      className={cn("[&_tr]:border-b", className)}
      {...props}
    />
  );
}

function TableBody({ className, ...props }: React.ComponentProps<"tbody">) {
  return (
    <tbody
      data-slot="table-body"
      className={cn("[&_tr:last-child]:border-0", className)}
      {...props}
    />
  );
}

function TableFooter({ className, ...props }: React.ComponentProps<"tfoot">) {
  return (
    <tfoot
      data-slot="table-footer"
      className={cn(
        "bg-muted/50 border-t font-medium [&>tr]:last:border-b-0",
        className,
      )}
      {...props}
    />
  );
}

function TableRow({ className, ...props }: React.ComponentProps<"tr">) {
  return (
    <tr
      data-slot="table-row"
      className={cn(
        "hover:bg-muted/50 data-[state=selected]:bg-muted border-b transition-colors",
        className,
      )}
      {...props}
    />
  );
}

function TableHead({ className, ...props }: React.ComponentProps<"th">) {
  return (
    <th
      data-slot="table-head"
      className={cn(
        "text-foreground h-10 px-2 text-left align-middle font-medium whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",
        className,
      )}
      {...props}
    />
  );
}

function TableCell({ className, ...props }: React.ComponentProps<"td">) {
  return (
    <td
      data-slot="table-cell"
      className={cn(
        "p-2 align-middle whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",
        className,
      )}
      {...props}
    />
  );
}

function TableCaption({
  className,
  ...props
}: React.ComponentProps<"caption">) {
  return (
    <caption
      data-slot="table-caption"
      className={cn("text-muted-foreground mt-4 text-sm", className)}
      {...props}
    />
  );
}

export {
  Table,
  TableHeader,
  TableBody,
  TableFooter,
  TableHead,
  TableRow,
  TableCell,
  TableCaption,
};
frontend/src/components/ui/separator.tsx
-----
import * as React from "react";
import * as SeparatorPrimitive from "@radix-ui/react-separator";

import { cn } from "@/lib/utils";

function Separator({
  className,
  orientation = "horizontal",
  decorative = true,
  ...props
}: React.ComponentProps<typeof SeparatorPrimitive.Root>) {
  return (
    <SeparatorPrimitive.Root
      data-slot="separator"
      decorative={decorative}
      orientation={orientation}
      className={cn(
        "bg-border shrink-0 data-[orientation=horizontal]:h-px data-[orientation=horizontal]:w-full data-[orientation=vertical]:h-full data-[orientation=vertical]:w-px",
        className,
      )}
      {...props}
    />
  );
}

export { Separator };
frontend/src/components/ui/button.tsx
-----
import * as React from "react";
import { Slot } from "@radix-ui/react-slot";
import { cva, type VariantProps } from "class-variance-authority";

import { cn } from "@/lib/utils";

const buttonVariants = cva(
  "inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive cursor-pointer",
  {
    variants: {
      variant: {
        default: "bg-primary text-primary-foreground hover:bg-primary/90",
        destructive:
          "bg-destructive text-white hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",
        outline:
          "border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",
        secondary:
          "bg-secondary text-secondary-foreground hover:bg-secondary/80",
        ghost:
          "hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",
        link: "text-primary underline-offset-4 hover:underline",
      },
      size: {
        default: "h-9 px-4 py-2 has-[>svg]:px-3",
        sm: "h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",
        lg: "h-10 rounded-md px-6 has-[>svg]:px-4",
        icon: "size-9",
      },
    },
    defaultVariants: {
      variant: "default",
      size: "default",
    },
  },
);

function Button({
  className,
  variant,
  size,
  asChild = false,
  ...props
}: React.ComponentProps<"button"> &
  VariantProps<typeof buttonVariants> & {
    asChild?: boolean;
  }) {
  const Comp = asChild ? Slot : "button";

  return (
    <Comp
      data-slot="button"
      className={cn(buttonVariants({ variant, size, className }))}
      {...props}
    />
  );
}

// eslint-disable-next-line react-refresh/only-export-components
export { Button, buttonVariants };
frontend/src/components/ui/select.tsx
-----
import * as React from "react";
import * as SelectPrimitive from "@radix-ui/react-select";
import { CheckIcon, ChevronDownIcon, ChevronUpIcon } from "lucide-react";

import { cn } from "@/lib/utils";

function Select({
  ...props
}: React.ComponentProps<typeof SelectPrimitive.Root>) {
  return <SelectPrimitive.Root data-slot="select" {...props} />;
}

function SelectGroup({
  ...props
}: React.ComponentProps<typeof SelectPrimitive.Group>) {
  return <SelectPrimitive.Group data-slot="select-group" {...props} />;
}

function SelectValue({
  ...props
}: React.ComponentProps<typeof SelectPrimitive.Value>) {
  return <SelectPrimitive.Value data-slot="select-value" {...props} />;
}

function SelectTrigger({
  className,
  size = "default",
  children,
  ...props
}: React.ComponentProps<typeof SelectPrimitive.Trigger> & {
  size?: "sm" | "default";
}) {
  return (
    <SelectPrimitive.Trigger
      data-slot="select-trigger"
      data-size={size}
      className={cn(
        "border-input data-[placeholder]:text-muted-foreground [&_svg:not([class*='text-'])]:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 dark:hover:bg-input/50 flex min-w-fit items-center justify-between gap-2 rounded-md border bg-transparent px-3 py-2 text-sm whitespace-nowrap shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 data-[size=default]:h-9 data-[size=sm]:h-8 *:data-[slot=select-value]:line-clamp-1 *:data-[slot=select-value]:flex *:data-[slot=select-value]:items-center *:data-[slot=select-value]:gap-2 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4 cursor-pointer",
        className,
      )}
      {...props}
    >
      {children}
      <SelectPrimitive.Icon asChild>
        <ChevronDownIcon className="size-4 opacity-50" />
      </SelectPrimitive.Icon>
    </SelectPrimitive.Trigger>
  );
}

function SelectContent({
  className,
  children,
  position = "popper",
  ...props
}: React.ComponentProps<typeof SelectPrimitive.Content>) {
  return (
    <SelectPrimitive.Portal>
      <SelectPrimitive.Content
        data-slot="select-content"
        className={cn(
          "bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 relative z-50 max-h-(--radix-select-content-available-height) min-w-[8rem] origin-(--radix-select-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border shadow-md",
          position === "popper" &&
            "data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",
          className,
        )}
        position={position}
        {...props}
      >
        <SelectScrollUpButton />
        <SelectPrimitive.Viewport
          className={cn(
            "p-1",
            position === "popper" &&
              "h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)] scroll-my-1",
          )}
        >
          {children}
        </SelectPrimitive.Viewport>
        <SelectScrollDownButton />
      </SelectPrimitive.Content>
    </SelectPrimitive.Portal>
  );
}

function SelectLabel({
  className,
  ...props
}: React.ComponentProps<typeof SelectPrimitive.Label>) {
  return (
    <SelectPrimitive.Label
      data-slot="select-label"
      className={cn("text-muted-foreground px-2 py-1.5 text-xs", className)}
      {...props}
    />
  );
}

function SelectItem({
  className,
  children,
  ...props
}: React.ComponentProps<typeof SelectPrimitive.Item>) {
  return (
    <SelectPrimitive.Item
      data-slot="select-item"
      className={cn(
        "focus:bg-accent focus:text-accent-foreground [&_svg:not([class*='text-'])]:text-muted-foreground relative flex w-full items-center gap-2 rounded-sm py-1.5 pr-8 pl-2 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4 *:[span]:last:flex *:[span]:last:items-center *:[span]:last:gap-2 cursor-pointer",
        className,
      )}
      {...props}
    >
      <span className="absolute right-2 flex size-3.5 items-center justify-center">
        <SelectPrimitive.ItemIndicator>
          <CheckIcon className="size-4" />
        </SelectPrimitive.ItemIndicator>
      </span>
      <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>
    </SelectPrimitive.Item>
  );
}

function SelectSeparator({
  className,
  ...props
}: React.ComponentProps<typeof SelectPrimitive.Separator>) {
  return (
    <SelectPrimitive.Separator
      data-slot="select-separator"
      className={cn("bg-border pointer-events-none -mx-1 my-1 h-px", className)}
      {...props}
    />
  );
}

function SelectScrollUpButton({
  className,
  ...props
}: React.ComponentProps<typeof SelectPrimitive.ScrollUpButton>) {
  return (
    <SelectPrimitive.ScrollUpButton
      data-slot="select-scroll-up-button"
      className={cn(
        "flex cursor-default items-center justify-center py-1",
        className,
      )}
      {...props}
    >
      <ChevronUpIcon className="size-4" />
    </SelectPrimitive.ScrollUpButton>
  );
}

function SelectScrollDownButton({
  className,
  ...props
}: React.ComponentProps<typeof SelectPrimitive.ScrollDownButton>) {
  return (
    <SelectPrimitive.ScrollDownButton
      data-slot="select-scroll-down-button"
      className={cn(
        "flex cursor-default items-center justify-center py-1",
        className,
      )}
      {...props}
    >
      <ChevronDownIcon className="size-4" />
    </SelectPrimitive.ScrollDownButton>
  );
}

export {
  Select,
  SelectContent,
  SelectGroup,
  SelectItem,
  SelectLabel,
  SelectScrollDownButton,
  SelectScrollUpButton,
  SelectSeparator,
  SelectTrigger,
  SelectValue,
};
frontend/src/components/ui/input.tsx
-----
import * as React from "react";

import { cn } from "@/lib/utils";

function Input({ className, type, ...props }: React.ComponentProps<"input">) {
  return (
    <input
      type={type}
      data-slot="input"
      className={cn(
        "file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",
        "focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]",
        "aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",
        className,
      )}
      {...props}
    />
  );
}

export { Input };
frontend/src/components/ui/skeleton.tsx
-----
import { cn } from "@/lib/utils";

function Skeleton({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="skeleton"
      className={cn("bg-accent animate-pulse rounded-md", className)}
      {...props}
    />
  );
}

export { Skeleton };
frontend/src/components/analysis-modal.tsx
-----
import {
  Dialog,
  DialogContent,
  DialogDescription,
  DialogHeader,
  DialogTitle,
} from "@/components/ui/dialog.tsx";
import { VotingEquipmentTable } from "@/components/table/voting-equipment-table.tsx";
import type { VotingEquipment } from "@/components/table/voting-equipment-columns.tsx";
import { EquipmentSummaryCards } from "@/components/equipment/equipment-summary-cards.tsx";
import { StateComparisonTable } from "@/components/table/state-comparison-table.tsx";
import { OptInOptOutTable } from "@/components/table/opt-in-opt-out-table.tsx";
import { EarlyVotingTable } from "@/components/table/early-voting-table.tsx";
import votingEquipmentDataJson from "../../data/votingEquipment.json" with { type: "json" };
import equipmentSummaryDataJson from "../../data/equipmentSummary.json" with { type: "json" };
import {
  stateComparisonData,
  republicanStateName,
  democraticStateName,
} from "@/lib/state-comparison-data.ts";
import {
  optInOptOutData,
  optInStateName,
  optOutWithSameDayStateName,
  optOutWithoutSameDayStateName,
} from "@/lib/opt-in-opt-out-data.ts";
import {
  earlyVotingData,
  earlyVotingRepublicanStateName,
  earlyVotingDemocraticStateName,
} from "@/lib/early-voting-data.ts";

import type { AnalysisItem } from "./analysis-drawer";
import type { EquipmentSummary } from "@/components/equipment/equipment-cards-base.tsx";

const votingEquipmentData: VotingEquipment[] =
  votingEquipmentDataJson as VotingEquipment[];
const equipmentSummaryData: EquipmentSummary[] =
  equipmentSummaryDataJson as EquipmentSummary[];

export const AnalysisOption = {
  US_VOTING_EQUIPMENT: "US Voting Equipment",
  EQUIPMENT_SUMMARY: "Equipment Summary",
  REPUBLICAN_VS_DEMOCRATIC: "Republican vs Democratic",
  OPT_IN_VS_OPT_OUT: "Opt-in vs Opt-out",
  EARLY_VOTING_COMPARISON: "Republican vs Democratic Early Voting Comparison",
  DROP_BOX_VOTING_CHART: "Drop Box Voting Chart",
  EQUIPMENT_VS_REJECTED_BALLOTS: "Equipment vs Rejected Ballots",
  POLITICAL_PARTY_BUBBLE_CHART:
    "Political Party Bubble Chart + Regression Line",
} as const;

interface AnalysisModalProps {
  open: boolean;
  onOpenChange: (open: boolean) => void;
  selectedAnalysis: AnalysisItem | null;
}

export default function AnalysisModal({
  open,
  onOpenChange,
  selectedAnalysis,
}: AnalysisModalProps) {
  const renderContent = () => {
    if (!selectedAnalysis) return null;
    switch (selectedAnalysis.title) {
      case AnalysisOption.US_VOTING_EQUIPMENT:
        return <VotingEquipmentTable data={votingEquipmentData} />;
      case AnalysisOption.EQUIPMENT_SUMMARY:
        return <EquipmentSummaryCards data={equipmentSummaryData} />;
      case AnalysisOption.REPUBLICAN_VS_DEMOCRATIC:
        return (
          <StateComparisonTable
            data={stateComparisonData}
            republicanState={republicanStateName}
            democraticState={democraticStateName}
          />
        );
      case AnalysisOption.OPT_IN_VS_OPT_OUT:
        return (
          <OptInOptOutTable
            data={optInOptOutData}
            optInState={optInStateName}
            optOutWithSameDayState={optOutWithSameDayStateName}
            optOutWithoutSameDayState={optOutWithoutSameDayStateName}
          />
        );
      case AnalysisOption.EARLY_VOTING_COMPARISON:
        return (
          <EarlyVotingTable
            data={earlyVotingData}
            republicanState={earlyVotingRepublicanStateName}
            democraticState={earlyVotingDemocraticStateName}
          />
        );
      case AnalysisOption.DROP_BOX_VOTING_CHART:
        return (
          <div className="py-4">
            <p className="text-sm text-muted-foreground">
              Drop box voting bubble chart will be displayed here.
            </p>
          </div>
        );
      case AnalysisOption.EQUIPMENT_VS_REJECTED_BALLOTS:
        return (
          <div className="py-4">
            <p className="text-sm text-muted-foreground">
              Equipment vs rejected ballots analysis will be displayed here.
            </p>
          </div>
        );
      case AnalysisOption.POLITICAL_PARTY_BUBBLE_CHART:
        return (
          <div className="py-4">
            <p className="text-sm text-muted-foreground">
              Political party bubble chart with regression line will be
              displayed here.
            </p>
          </div>
        );
      default:
        return (
          <div className="py-4">
            <p className="text-sm text-muted-foreground">
              Content for {selectedAnalysis.title} will be displayed here.
            </p>
          </div>
        );
    }
  };

  return (
    <Dialog open={open} onOpenChange={onOpenChange}>
      <DialogContent className="max-w-[90vw] sm:max-w-[90vw] w-[90vw] h-[95vh] flex flex-col p-4">
        <DialogHeader className="flex-shrink-0 pb-2">
          <DialogTitle className="text-xl">
            {selectedAnalysis?.title}
          </DialogTitle>
          <DialogDescription className="text-sm">
            {selectedAnalysis?.description}
          </DialogDescription>
        </DialogHeader>
        <div className="flex-1 min-h-0">{renderContent()}</div>
      </DialogContent>
    </Dialog>
  );
}
frontend/src/components/chart/mail-ballots-rejected-bar-chart.tsx
-----
import {
  BarChart,
  Bar,
  XAxis,
  YAxis,
  CartesianGrid,
  Tooltip,
  Legend,
  ResponsiveContainer,
  Cell,
} from "recharts";

export interface MailBallotsRejectedData {
  eavsRegion: string;
  C9b: number;
  C9c: number;
  C9d: number;
  C9e: number;
  C9f: number;
  C9g: number;
  C9h: number;
  C9i: number;
  C9j: number;
  C9k: number;
  C9l: number;
  C9m: number;
  C9n: number;
  C9o: number;
  C9p: number;
  C9q: number;
  notes: string;
}

export interface MailBallotsRejectedBarChartProps {
  stateName: string;
  barData: MailBallotsRejectedData[];
}

const METRIC_KEYS = [
  "C9b",
  "C9c",
  "C9d",
  "C9e",
  "C9f",
  "C9g",
  "C9h",
  "C9i",
  "C9j",
  "C9k",
  "C9l",
  "C9m",
  "C9n",
  "C9o",
  "C9p",
  "C9q",
] as const;
type MetricKey = (typeof METRIC_KEYS)[number];

const METRIC_LABELS: Record<MetricKey, string> = {
  C9b: "C9b ‚Äì Missing signature",
  C9c: "C9c ‚Äì Non-matching signature",
  C9d: "C9d ‚Äì Missing witness signature",
  C9e: "C9e ‚Äì Non-matching witness signature",
  C9f: "C9f ‚Äì Ballot envelope not sealed",
  C9g: "C9g ‚Äì No ballot in envelope",
  C9h: "C9h ‚Äì Arrived after deadline",
  C9i: "C9i ‚Äì Voter deceased",
  C9j: "C9j ‚Äì Envelope not signed",
  C9k: "C9k ‚Äì No voter registration record",
  C9l: "C9l ‚Äì Already voted",
  C9m: "C9m ‚Äì Invalid voter address",
  C9n: "C9n ‚Äì Duplicate ballot",
  C9o: "C9o ‚Äì Ballot damaged/illegible",
  C9p: "C9p ‚Äì Other mail ballot issue",
  C9q: "C9q ‚Äì Rejected - voter ID",
};

// üé® Custom color palette
const BAR_COLORS = [
  "#8e51ff", // purple
  "#8e51ff", // purple
  "#8e51ff", // purple
  "#8e51ff", // purple
  "#8e51ff", // purple
  "#8e51ff", // purple
  "#8e51ff", // purple
  "#8e51ff", // purple
  "#8e51ff", // purple
  "#8e51ff", // purple
  "#8e51ff", // purple
  "#8e51ff", // purple
  "#8e51ff", // purple
  "#8e51ff", // purple
  "#8e51ff", // purple
  "#8e51ff", // purple
];

export function MailBallotsRejectedBarChart({
  stateName,
  barData,
}: MailBallotsRejectedBarChartProps) {
  const totals = METRIC_KEYS.reduce(
    (acc, key) => {
      acc[key] = barData.reduce((sum, row) => sum + (row[key] ?? 0), 0);
      return acc;
    },
    {} as Record<MetricKey, number>,
  );

  const data = METRIC_KEYS.map((key) => ({
    code: key,
    name: METRIC_LABELS[key],
    value: totals[key],
  }));

  return (
    <div className="w-full h-64">
      <ResponsiveContainer width="100%" height="100%">
        <BarChart
          data={data}
          margin={{ top: 8, right: 16, left: 35, bottom: 8 }}
        >
          <CartesianGrid strokeDasharray="3 3" />
          <XAxis
            dataKey="name"
            interval={0}
            angle={-15}
            textAnchor="end"
            height={60}
          />
          <YAxis />
          <Tooltip />
          <Legend />
          <Bar dataKey="value" name={stateName}>
            {data.map((_, index) => (
              <Cell
                key={`cell-${index}`}
                fill={BAR_COLORS[index % BAR_COLORS.length]}
              />
            ))}
          </Bar>
        </BarChart>
      </ResponsiveContainer>
    </div>
  );
}
frontend/src/components/chart/pollbook-deletions-bar-chart.tsx
-----
import {
  BarChart,
  Bar,
  XAxis,
  YAxis,
  CartesianGrid,
  Tooltip,
  Legend,
  ResponsiveContainer,
  Cell,
} from "recharts";

export interface PollbookDeletionsData {
  eavsRegion: string;
  A12b: number;
  A12c: number;
  A12d: number;
  A12e: number;
  A12f: number;
  A12g: number;
  A12h: number;
  notes: string;
}

export interface PollbookDeletionsBarChartProps {
  stateName: string;
  barData: PollbookDeletionsData[];
}

const METRIC_KEYS = [
  "A12b",
  "A12c",
  "A12d",
  "A12e",
  "A12f",
  "A12g",
  "A12h",
] as const;
type MetricKey = (typeof METRIC_KEYS)[number];

const METRIC_LABELS: Record<MetricKey, string> = {
  A12b: "A12b ‚Äì Death",
  A12c: "A12c ‚Äì Felony conviction",
  A12d: "A12d ‚Äì Mental incapacity",
  A12e: "A12e ‚Äì Moved out of jurisdiction",
  A12f: "A12f ‚Äì Voter request",
  A12g: "A12g ‚Äì Failed to respond",
  A12h: "A12h ‚Äì Other",
};

// üé® Custom color palette
const BAR_COLORS = [
  "#8e51ff", // purple
  "#8e51ff", // purple
  "#8e51ff", // purple
  "#8e51ff", // purple
  "#8e51ff", // purple
  "#8e51ff", // purple
  "#8e51ff", // purple
];

export function PollbookDeletionsBarChart({
  stateName,
  barData,
}: PollbookDeletionsBarChartProps) {
  const totals = METRIC_KEYS.reduce(
    (acc, key) => {
      acc[key] = barData.reduce((sum, row) => sum + (row[key] ?? 0), 0);
      return acc;
    },
    {} as Record<MetricKey, number>,
  );

  const data = METRIC_KEYS.map((key) => ({
    code: key,
    name: METRIC_LABELS[key],
    value: totals[key],
  }));

  return (
    <div className="w-full h-64">
      <ResponsiveContainer width="100%" height="100%">
        <BarChart
          data={data}
          margin={{ top: 8, right: 16, left: 8, bottom: 8 }}
        >
          <CartesianGrid strokeDasharray="3 3" />
          <XAxis
            dataKey="name"
            interval={0}
            angle={-15}
            textAnchor="end"
            height={60}
          />
          <YAxis />
          <Tooltip />
          <Legend />
          <Bar dataKey="value" name={stateName}>
            {data.map((_, index) => (
              <Cell
                key={`cell-${index}`}
                fill={BAR_COLORS[index % BAR_COLORS.length]}
              />
            ))}
          </Bar>
        </BarChart>
      </ResponsiveContainer>
    </div>
  );
}
frontend/src/components/chart/equipment-quality-bubble-chart.tsx
-----
import { useMemo } from "react";
import {
  Scatter,
  XAxis,
  YAxis,
  CartesianGrid,
  Tooltip,
  Legend,
  ResponsiveContainer,
  ZAxis,
  Line,
  ComposedChart,
} from "recharts";

export interface EquipmentQualityData {
  county: string;
  equipmentQuality: number;
  rejectedBallotPercentage: number;
  totalBallots: number;
  rejectedBallots: number;
  dominantParty: "republican" | "democratic";
  mailInRejected: number;
  provisionalRejected: number;
  uocavaRejected: number;
}

export interface RegressionCoefficients {
  republican: {
    a: number;
    b: number;
    c: number;
  };
  democratic: {
    a: number;
    b: number;
    c: number;
  };
}

interface EquipmentQualityBubbleChartProps {
  data: EquipmentQualityData[];
  regressionCoefficients: RegressionCoefficients;
  stateName: string;
}

interface TooltipData {
  x: number;
  y: number;
  z: number;
  name: string;
  totalBallots: number;
  rejectedBallots: number;
  mailInRejected: number;
  provisionalRejected: number;
  uocavaRejected: number;
}

export function EquipmentQualityBubbleChart({
  data,
  regressionCoefficients,
  stateName,
}: EquipmentQualityBubbleChartProps) {
  // Split data by party dominance for different colored bubbles
  const { republicanData, democraticData, regressionLines } = useMemo(() => {
    const repData = data
      .filter((d) => d.dominantParty === "republican")
      .map((d) => ({
        x: d.equipmentQuality,
        y: d.rejectedBallotPercentage,
        z: d.totalBallots / 10000, // Scale for bubble size
        name: d.county,
        totalBallots: d.totalBallots,
        rejectedBallots: d.rejectedBallots,
        mailInRejected: d.mailInRejected,
        provisionalRejected: d.provisionalRejected,
        uocavaRejected: d.uocavaRejected,
      }));

    const demData = data
      .filter((d) => d.dominantParty === "democratic")
      .map((d) => ({
        x: d.equipmentQuality,
        y: d.rejectedBallotPercentage,
        z: d.totalBallots / 10000, // Scale for bubble size
        name: d.county,
        totalBallots: d.totalBallots,
        rejectedBallots: d.rejectedBallots,
        mailInRejected: d.mailInRejected,
        provisionalRejected: d.provisionalRejected,
        uocavaRejected: d.uocavaRejected,
      }));

    // Generate regression line data points
    // y = ax^2 + bx + c (quadratic regression)
    const generateRegressionLine = (
      coeffs: { a: number; b: number; c: number },
      minX = 60,
      maxX = 90,
    ) => {
      const points = [];
      for (let x = minX; x <= maxX; x += 1) {
        const y = coeffs.a * x * x + coeffs.b * x + coeffs.c;
        points.push({ x, y });
      }
      return points;
    };

    const repRegressionLine = generateRegressionLine(
      regressionCoefficients.republican,
    );
    const demRegressionLine = generateRegressionLine(
      regressionCoefficients.democratic,
    );

    return {
      republicanData: repData,
      democraticData: demData,
      regressionLines: {
        republican: repRegressionLine,
        democratic: demRegressionLine,
      },
    };
  }, [data, regressionCoefficients]);

  const CustomTooltip = ({
    active,
    payload,
  }: {
    active?: boolean;
    payload?: Array<{ payload: TooltipData }>;
  }) => {
    if (active && payload && payload.length) {
      const data = payload[0].payload;

      // Check if this is scatter data (has name property) or regression line data (doesn't)
      if (!data.name) {
        // This is a regression line point, don't show tooltip
        return null;
      }

      return (
        <div className="bg-white p-3 border border-gray-300 rounded shadow-lg">
          <p className="font-semibold text-sm mb-1">{data.name} County</p>
          <p className="text-xs text-gray-700">
            Equipment Quality: {data.x?.toFixed(0) ?? "N/A"}
          </p>
          <p className="text-xs text-gray-700">
            Rejected Ballots: {data.y?.toFixed(2) ?? "N/A"}%
          </p>
          <p className="text-xs text-gray-700">
            Total Ballots: {data.totalBallots?.toLocaleString() ?? "N/A"}
          </p>
          <p className="text-xs text-gray-700 mt-1 font-semibold">
            Rejected Breakdown:
          </p>
          <p className="text-xs text-gray-700 ml-2">
            Mail-in: {data.mailInRejected?.toLocaleString() ?? "N/A"}
          </p>
          <p className="text-xs text-gray-700 ml-2">
            Provisional: {data.provisionalRejected?.toLocaleString() ?? "N/A"}
          </p>
          <p className="text-xs text-gray-700 ml-2">
            UOCAVA: {data.uocavaRejected?.toLocaleString() ?? "N/A"}
          </p>
        </div>
      );
    }
    return null;
  };

  return (
    <div className="w-full h-full min-h-[600px]">
      <h3 className="text-lg font-semibold mb-2 text-center">
        Voting Equipment Quality vs Rejected Ballots - {stateName}
      </h3>
      <p className="text-sm text-gray-600 mb-4 text-center">
        Bubble size represents total ballots. Color indicates county party
        dominance. Lines show quadratic regression by party.
      </p>
      <ResponsiveContainer width="100%" height="85%">
        <ComposedChart margin={{ top: 20, right: 30, bottom: 40, left: 40 }}>
          <CartesianGrid strokeDasharray="3 3" />
          <XAxis
            type="number"
            dataKey="x"
            name="Equipment Quality"
            domain={[60, 90]}
            label={{
              value: "Equipment Quality Score",
              position: "insideBottom",
              offset: -20,
            }}
          />
          <YAxis
            type="number"
            dataKey="y"
            name="Rejected Ballots %"
            unit="%"
            domain={[0, "auto"]}
            label={{
              value: "Rejected Ballot Percentage",
              angle: -90,
              position: "insideLeft",
              style: { textAnchor: "middle" },
              offset: -10,
            }}
          />
          <ZAxis
            type="number"
            dataKey="z"
            range={[100, 1000]}
            name="Total Ballots (10k)"
          />
          <Tooltip content={<CustomTooltip />} />
          <Legend
            verticalAlign="top"
            height={36}
            wrapperStyle={{ paddingBottom: "10px" }}
          />

          {/* Regression lines */}
          <Line
            type="monotone"
            data={regressionLines.republican}
            dataKey="y"
            stroke="#dc2626"
            strokeWidth={2}
            dot={false}
            name="Republican regression"
            strokeDasharray="5 5"
          />
          <Line
            type="monotone"
            data={regressionLines.democratic}
            dataKey="y"
            stroke="#2563eb"
            strokeWidth={2}
            dot={false}
            name="Democratic regression"
            strokeDasharray="5 5"
          />

          {/* Scatter plots */}
          <Scatter
            name="Republican counties"
            data={republicanData}
            fill="#dc2626"
            fillOpacity={0.7}
          />
          <Scatter
            name="Democratic counties"
            data={democraticData}
            fill="#2563eb"
            fillOpacity={0.7}
          />
        </ComposedChart>
      </ResponsiveContainer>
    </div>
  );
}
frontend/src/components/chart/provisional-ballots-bar-chart.tsx
-----
import {
  BarChart,
  Bar,
  XAxis,
  YAxis,
  CartesianGrid,
  Tooltip,
  Legend,
  ResponsiveContainer,
  Cell,
} from "recharts";

export interface ProvisionBallotsData {
  E2a: number; // Not on List
  E2b: number; // Lacked ID
  E2c: number; // Challenged Eligibility
  E2d: number; // Not Eligible
  E2e: number; // Not Resident
  E2f: number; // Registration Not Updated
  E2g: number; // Did Not Surrender Mail Ballot
  E2h: number; // Judge Extended Hours
  E2i: number; // Used SDR
}

export interface ProvisionalBallotsBarChartProps {
  stateName: string;
  barData: ProvisionBallotsData[];
}

const METRIC_KEYS = [
  "E2a",
  "E2b",
  "E2c",
  "E2d",
  "E2e",
  "E2f",
  "E2g",
  "E2h",
  "E2i",
] as const;
type MetricKey = (typeof METRIC_KEYS)[number];

const METRIC_LABELS: Record<MetricKey, string> = {
  E2a: "E2a ‚Äì Not on List",
  E2b: "E2b ‚Äì Lacked ID",
  E2c: "E2c ‚Äì Challenged Eligibility",
  E2d: "E2d ‚Äì Not Eligible",
  E2e: "E2e ‚Äì Not Resident",
  E2f: "E2f ‚Äì Registration Not Updated",
  E2g: "E2g ‚Äì Did Not Surrender Mail Ballot",
  E2h: "E2h ‚Äì Judge Extended Hours",
  E2i: "E2i ‚Äì Used SDR",
};


// üé® Custom color palette
const BAR_COLORS = [
  "#8e51ff", // purple
  "#8e51ff", // purple
  "#8e51ff", // purple
  "#8e51ff", // purple
  "#8e51ff", // purple
  "#8e51ff", // purple
  "#8e51ff", // purple
  "#8e51ff", // purple
];

export function ProvisionalBallotsBarChart({
  stateName,
  barData,
}: ProvisionalBallotsBarChartProps) {
  const totals = METRIC_KEYS.reduce(
    (acc, key) => {
      acc[key] = barData.reduce((sum, row) => sum + (row[key] ?? 0), 0);
      return acc;
    },
    {} as Record<MetricKey, number>,
  );

  const data = METRIC_KEYS.map((key) => ({
    code: key,
    name: METRIC_LABELS[key],
    value: totals[key],
  }));

  return (
    <div className="w-full h-64">
      <ResponsiveContainer width="100%" height="100%">
        <BarChart
          data={data}
          margin={{ top: 8, right: 16, left: 8, bottom: 8 }}
        >
          <CartesianGrid strokeDasharray="3 3" />
          <XAxis
            dataKey="name"
            interval={0}
            angle={-15}
            textAnchor="end"
            height={60}
          />
          <YAxis
            label={{
              value: "Number of Ballots",
              angle: -90,
              position: "insideLeft",
              style: { textAnchor: "middle" },
            }}
          />
          <Tooltip />
          <Legend />
          <Bar dataKey="value" name={stateName}>
            {data.map((_, index) => (
              <Cell
                key={`cell-${index}`}
                fill={BAR_COLORS[index % BAR_COLORS.length]}
              />
            ))}
          </Bar>
        </BarChart>
      </ResponsiveContainer>
    </div>
  );
}
frontend/src/components/chart/voter-registration-line-chart.tsx
-----
import {
  LineChart,
  Line,
  XAxis,
  YAxis,
  CartesianGrid,
  Tooltip,
  Legend,
  ResponsiveContainer,
} from "recharts";

type VoterRegistrationData = {
  jurisdiction: string;
  registeredVoters2016: number;
  registeredVoters2020: number;
  registeredVoters2024: number;
};

type ChartDataPoint = {
  jurisdiction: number;
  jurisdictionName: string;
  "2016": number;
  "2020": number;
  "2024": number;
};

interface VoterRegistrationLineChartProps {
  data: VoterRegistrationData[];
}

export function VoterRegistrationLineChart({
  data,
}: VoterRegistrationLineChartProps) {
  // Transform data for the line chart
  // The data is already sorted by 2024 registered voters in ascending order
  const chartData: ChartDataPoint[] = data.map((item, index) => ({
    jurisdiction: index + 1, // Use index for x-axis (sorted order)
    jurisdictionName: item.jurisdiction,
    "2016": item.registeredVoters2016,
    "2020": item.registeredVoters2020,
    "2024": item.registeredVoters2024,
  }));

  const CustomTooltip = ({
    active,
    payload,
  }: {
    active?: boolean;
    payload?: Array<{
      payload: ChartDataPoint;
      value: number;
      dataKey: string;
    }>;
  }) => {
    if (active && payload && payload.length) {
      const tooltipData = payload[0].payload;
      return (
        <div className="bg-background border rounded-lg p-3 shadow-lg">
          <p className="font-medium text-sm mb-2">
            {tooltipData.jurisdictionName}
          </p>
          <p className="text-sm text-blue-600">
            2016: {tooltipData["2016"].toLocaleString()} registered voters
          </p>
          <p className="text-sm text-green-600">
            2020: {tooltipData["2020"].toLocaleString()} registered voters
          </p>
          <p className="text-sm text-orange-600">
            2024: {tooltipData["2024"].toLocaleString()} registered voters
          </p>
        </div>
      );
    }
    return null;
  };

  return (
    <div className="w-full h-full">
      <ResponsiveContainer width="100%" height="100%">
        <LineChart
          data={chartData}
          margin={{ top: 50, right: 30, left: 30, bottom: 60 }}
        >
          <CartesianGrid strokeDasharray="3 3" />
          <XAxis
            dataKey="jurisdiction"
            label={{
              value:
                "Counties (Ordered from Smallest to Largest by 2024 Registration)",
              position: "insideBottom",
              offset: -10,
            }}
            tick={{ fontSize: 12 }}
          />
          <YAxis
            label={{
              value: "Number of Registered Voters",
              angle: -90,
              position: "insideLeft",
              style: { textAnchor: "middle" },
            }}
            tick={{ fontSize: 12 }}
            tickFormatter={(value) => value.toLocaleString()}
            width={80}
          />
          <Tooltip content={<CustomTooltip />} />
          <Legend
            verticalAlign="top"
            height={36}
            wrapperStyle={{ paddingBottom: "10px" }}
          />
          <Line
            type="monotone"
            dataKey="2016"
            stroke="#2563eb"
            strokeWidth={3}
            dot={false}
            name="2016 Registered Voters"
            strokeOpacity={0.9}
          />
          <Line
            type="monotone"
            dataKey="2020"
            stroke="#16a34a"
            strokeWidth={3}
            dot={false}
            name="2020 Registered Voters"
            strokeOpacity={0.9}
          />
          <Line
            type="monotone"
            dataKey="2024"
            stroke="#ea580c"
            strokeWidth={3}
            dot={false}
            name="2024 Registered Voters"
            strokeOpacity={0.9}
          />
        </LineChart>
      </ResponsiveContainer>
    </div>
  );
}
frontend/src/components/chart/voting-equipment-bar-chart.tsx
-----
import {
  BarChart,
  Bar,
  XAxis,
  YAxis,
  CartesianGrid,
  Tooltip,
  ResponsiveContainer,
} from "recharts";

interface VotingEquipmentBarChartProps {
  stateName: string;
  data: {
    year: number;
    dreNoVVPAT: number;
    dreWithVVPAT: number;
    ballotMarkingDevice: number;
    scanner: number;
  }[];
}

export function VotingEquipmentBarChart({
  stateName,
  data,
}: VotingEquipmentBarChartProps) {
  const categories = [
    {
      key: "dreNoVVPAT",
      label: "DRE (No VVPAT)",
      color: "#8e51ff",
    },
    {
      key: "dreWithVVPAT",
      label: "DRE (With VVPAT)",
      color: "#8e51ff",
    },
    {
      key: "ballotMarkingDevice",
      label: "Ballot Marking Device",
      color: "#8e51ff",
    },
    {
      key: "scanner",
      label: "Scanner",
      color: "#8e51ff",
    },
  ];

  return (
    <div className="space-y-2">
      <h3 className="text-sm font-semibold text-center">
        Voting Equipment by Category - {stateName}
      </h3>
      <div className="grid grid-cols-2 gap-3">
        {categories.map((category) => (
          <div key={category.key} className="bg-white rounded-lg border p-2">
            <h4 className="text-xs font-semibold mb-1 text-center">
              {category.label}
            </h4>
            <ResponsiveContainer width="100%" height={140}>
              <BarChart
                data={data}
                margin={{ top: 5, right: 5, left: 5, bottom: 5 }}
              >
                <CartesianGrid strokeDasharray="3 3" />
                <XAxis
                  dataKey="year"
                  label={{
                    value: "Year",
                    position: "insideBottom",
                    offset: -3,
                    style: { fontSize: 10 },
                  }}
                  tick={{ fontSize: 10 }}
                />
                <YAxis
                  label={{
                    value: "Qty",
                    angle: -90,
                    position: "insideLeft",
                    style: { fontSize: 10 },
                  }}
                  tick={{ fontSize: 10 }}
                />
                <Tooltip
                  formatter={(value: number) => [
                    value.toLocaleString(),
                    "Devices",
                  ]}
                  labelFormatter={(label) => `Year: ${label}`}
                />
                <Bar
                  dataKey={category.key}
                  fill={category.color}
                  name={category.label}
                  radius={[4, 4, 0, 0]}
                />
              </BarChart>
            </ResponsiveContainer>
          </div>
        ))}
      </div>
    </div>
  );
}
frontend/src/components/chart/drop-box-voting-bubble-chart.tsx
-----
import { useMemo } from "react";
import {
  ScatterChart,
  Scatter,
  XAxis,
  YAxis,
  CartesianGrid,
  Tooltip,
  Legend,
  ResponsiveContainer,
  ZAxis,
} from "recharts";

export interface DropBoxVotingData {
  eavsRegion: string;
  totalDropBoxVotes: number;
  republicanVotes: number;
  democraticVotes: number;
  otherVotes: number;
  totalVotes: number;
  republicanPercentage: number;
  dropBoxPercentage: number;
  dominantParty: "republican" | "democratic";
}

interface DropBoxVotingBubbleChartProps {
  data: DropBoxVotingData[];
  stateName: string;
}

interface TooltipData {
  x: number;
  y: number;
  z: number;
  name: string;
  republicanVotes: number;
  democraticVotes: number;
  totalDropBoxVotes: number;
}

export function DropBoxVotingBubbleChart({
  data,
  stateName,
}: DropBoxVotingBubbleChartProps) {
  // Split data by party dominance for different colored bubbles
  const { republicanData, democraticData } = useMemo(() => {
    const repData = data
      .filter((d) => d.dominantParty === "republican")
      .map((d) => ({
        x: d.republicanPercentage,
        y: d.dropBoxPercentage,
        z: d.totalDropBoxVotes / 1000, // Scale for bubble size
        name: d.eavsRegion,
        republicanVotes: d.republicanVotes,
        democraticVotes: d.democraticVotes,
        totalDropBoxVotes: d.totalDropBoxVotes,
      }));

    const demData = data
      .filter((d) => d.dominantParty === "democratic")
      .map((d) => ({
        x: d.republicanPercentage,
        y: d.dropBoxPercentage,
        z: d.totalDropBoxVotes / 1000, // Scale for bubble size
        name: d.eavsRegion,
        republicanVotes: d.republicanVotes,
        democraticVotes: d.democraticVotes,
        totalDropBoxVotes: d.totalDropBoxVotes,
      }));

    return { republicanData: repData, democraticData: demData };
  }, [data]);

  const CustomTooltip = ({
    active,
    payload,
  }: {
    active?: boolean;
    payload?: Array<{ payload: TooltipData }>;
  }) => {
    if (active && payload && payload.length) {
      const data = payload[0].payload;
      return (
        <div className="bg-white p-3 border border-gray-300 rounded shadow-lg">
          <p className="font-semibold text-sm mb-1">{data.name}</p>
          <p className="text-xs text-gray-700">
            Republican Votes: {data.x.toFixed(1)}%
          </p>
          <p className="text-xs text-gray-700">
            Drop Box Voting: {data.y.toFixed(1)}%
          </p>
          <p className="text-xs text-gray-700">
            Total Drop Box Votes: {data.totalDropBoxVotes.toLocaleString()}
          </p>
          <p className="text-xs text-gray-700">
            Republican: {data.republicanVotes.toLocaleString()}
          </p>
          <p className="text-xs text-gray-700">
            Democratic: {data.democraticVotes.toLocaleString()}
          </p>
        </div>
      );
    }
    return null;
  };

  return (
    <div className="w-full h-full min-h-[600px]">
      <h3 className="text-lg font-semibold mb-2 text-center">
        Drop Box Voting by EAVS Region - {stateName}
      </h3>
      <p className="text-sm text-gray-600 mb-4 text-center">
        Bubble size represents total drop box votes. Color indicates party
        dominance in 2024 Presidential election.
      </p>
      <ResponsiveContainer width="100%" height="85%">
        <ScatterChart margin={{ top: 20, right: 30, bottom: 40, left: 40 }}>
          <CartesianGrid strokeDasharray="3 3" />
          <XAxis
            type="number"
            dataKey="x"
            name="Republican Vote %"
            unit="%"
            domain={[0, 100]}
            label={{
              value: "Republican Vote Percentage",
              position: "insideBottom",
              offset: -20,
            }}
          />
          <YAxis
            type="number"
            dataKey="y"
            name="Drop Box Voting %"
            unit="%"
            domain={[0, "auto"]}
            label={{
              value: "Drop Box Voting Percentage",
              angle: -90,
              position: "insideLeft",
              style: { textAnchor: "middle" },
              offset: -10,
            }}
          />
          <ZAxis
            type="number"
            dataKey="z"
            range={[100, 1000]}
            name="Total Votes (thousands)"
          />
          <Tooltip content={<CustomTooltip />} />
          <Legend
            verticalAlign="top"
            height={36}
            wrapperStyle={{ paddingBottom: "10px" }}
          />
          <Scatter
            name="Republican-dominated regions"
            data={republicanData}
            fill="#dc2626"
            fillOpacity={0.7}
          />
          <Scatter
            name="Democratic-dominated regions"
            data={democraticData}
            fill="#2563eb"
            fillOpacity={0.7}
          />
        </ScatterChart>
      </ResponsiveContainer>
    </div>
  );
}
frontend/src/components/chart/active-voters-bar-chart.tsx
-----
import {
  BarChart,
  Bar,
  XAxis,
  YAxis,
  CartesianGrid,
  Tooltip,
  Legend,
  ResponsiveContainer,
  Cell,
} from "recharts";

export interface ActiveVotersData {
  eavsRegion: string;
  activeVoters: number;
  totalVoters: number;
  inactiveVoters: number;
  notes: string;
}

export interface ActiveVotersBarChartProps {
  stateName: string;
  barData: ActiveVotersData[];
}

const METRIC_KEYS = ["activeVoters", "totalVoters", "inactiveVoters"] as const;
type MetricKey = (typeof METRIC_KEYS)[number];

const METRIC_LABELS: Record<MetricKey, string> = {
  activeVoters: "Active Voters",
  totalVoters: "Total Voters",
  inactiveVoters: "Inactive Voters",
};

// üé® Custom color palette
const BAR_COLORS = [
  "#8e51ff", // purple
  "#8e51ff", // purple
  "#8e51ff", // purple
];

export function ActiveVotersBarChart({
  stateName,
  barData,
}: ActiveVotersBarChartProps) {
  const totals = METRIC_KEYS.reduce(
    (acc, key) => {
      acc[key] = barData.reduce((sum, row) => sum + (row[key] ?? 0), 0);
      return acc;
    },
    {} as Record<MetricKey, number>,
  );

  const data = METRIC_KEYS.map((key) => ({
    code: key,
    name: METRIC_LABELS[key],
    value: totals[key],
  }));

  return (
    <div className="w-full h-64">
      <ResponsiveContainer width="100%" height="100%">
        <BarChart
          data={data}
          margin={{ top: 8, right: 16, left: 8, bottom: 8 }}
        >
          <CartesianGrid strokeDasharray="3 3" />
          <XAxis
            dataKey="name"
            interval={0}
            angle={-15}
            textAnchor="end"
            height={60}
          />
          <YAxis />
          <Tooltip />
          <Legend />
          <Bar dataKey="value" name={stateName}>
            {data.map((_, index) => (
              <Cell
                key={`cell-${index}`}
                fill={BAR_COLORS[index % BAR_COLORS.length]}
              />
            ))}
          </Bar>
        </BarChart>
      </ResponsiveContainer>
    </div>
  );
}
frontend/src/components/choropleth-legend.tsx
-----
import { Card } from "@/components/ui/card";
import {
  VOTING_EQUIPMENT_COLORS,
  equipmentAgeScale,
  provisionalBallotsScale,
  activeVotersScale,
  pollbookDeletionsScale,
  mailBallotsRejectedScale,
  voterRegistrationScale,
  type ColorScale,
} from "@/lib/colors";
import {
  SPLASH_CHOROPLETH_OPTIONS,
  STATE_CHOROPLETH_OPTIONS,
  type ChoroplethOption,
} from "@/constants/choropleth";

interface ChoroplethLegendProps {
  choroplethOption: ChoroplethOption;
  votingEquipmentData?: Array<{
    eavsRegion: string;
    equipmentTypes: string[];
    primaryEquipment: string;
  }>;
}

export function ChoroplethLegend({
  choroplethOption,
  votingEquipmentData,
}: ChoroplethLegendProps) {
  // Don't render if choropleth is off
  if (choroplethOption === "off") {
    return null;
  }

  // Voting Equipment Type Legend (categorical)
  if (choroplethOption === STATE_CHOROPLETH_OPTIONS.VOTING_EQUIPMENT_TYPE) {
    if (!votingEquipmentData || votingEquipmentData.length === 0) {
      return null;
    }

    const equipmentCounts = votingEquipmentData.reduce(
      (acc, item) => {
        const equipmentType =
          item.equipmentTypes.length > 1 ? "mixed" : item.primaryEquipment;
        acc[equipmentType] = (acc[equipmentType] || 0) + 1;
        return acc;
      },
      {} as Record<string, number>,
    );

    const equipmentLabels: Record<string, string> = {
      dre_no_vvpat: "DRE without VVPAT",
      dre_with_vvpat: "DRE with VVPAT",
      ballot_marking_device: "Ballot Marking Device",
      scanner: "Scanner",
      mixed: "Mixed Equipment Types",
    };

    return (
      <Card className="p-4">
        <h3 className="text-sm font-semibold mb-3">Voting Equipment Types</h3>
        <div className="space-y-2">
          {Object.entries(equipmentCounts).map(([type, count]) => (
            <div key={type} className="flex items-center gap-2">
              <div
                className="w-6 h-6 rounded border border-gray-300"
                style={{
                  backgroundColor:
                    VOTING_EQUIPMENT_COLORS[
                      type as keyof typeof VOTING_EQUIPMENT_COLORS
                    ],
                }}
              />
              <div className="flex-1">
                <div className="text-sm font-medium">
                  {equipmentLabels[type]}
                </div>
                <div className="text-xs text-muted-foreground">
                  {count} {count === 1 ? "region" : "regions"}
                </div>
              </div>
            </div>
          ))}
        </div>
      </Card>
    );
  }

  // Get the appropriate color scale and labels for sequential legends
  let scale: ColorScale | null = null;
  let title = "";
  let unit = "";

  switch (choroplethOption) {
    case SPLASH_CHOROPLETH_OPTIONS.EQUIPMENT_AGE:
      scale = equipmentAgeScale;
      title = "Voting Equipment Age";
      unit = "years";
      break;
    case STATE_CHOROPLETH_OPTIONS.PROVISIONAL_BALLOTS:
      scale = provisionalBallotsScale;
      title = "Provisional Ballots";
      unit = "%";
      break;
    case STATE_CHOROPLETH_OPTIONS.ACTIVE_VOTERS:
      scale = activeVotersScale;
      title = "Active Voters";
      unit = "%";
      break;
    case STATE_CHOROPLETH_OPTIONS.POLLBOOK_DELETIONS:
      scale = pollbookDeletionsScale;
      title = "Pollbook Deletions";
      unit = "%";
      break;
    case STATE_CHOROPLETH_OPTIONS.MAIL_BALLOTS_REJECTED:
      scale = mailBallotsRejectedScale;
      title = "Mail Ballots Rejected";
      unit = "%";
      break;
    case STATE_CHOROPLETH_OPTIONS.VOTER_REGISTRATION:
      scale = voterRegistrationScale;
      title = "Voter Registration";
      unit = "%";
      break;
  }

  if (!scale) {
    return null;
  }

  // Render sequential color scale legend
  return (
    <Card className="p-4">
      <h3 className="text-sm font-semibold mb-3">{title}</h3>
      <div className="space-y-2">
        {scale.colors.map((color, idx) => (
          <div key={idx} className="flex items-center gap-2">
            <div
              className="w-6 h-6 rounded border border-gray-300 flex-shrink-0"
              style={{ backgroundColor: color }}
            />
            <div className="text-sm">
              {idx === 0 ? (
                <span>
                  ‚â§ {scale.breaks[idx]}
                  {unit}
                </span>
              ) : idx === scale.colors.length - 1 ? (
                <span>
                  &gt; {scale.breaks[idx - 1]}
                  {unit}
                </span>
              ) : (
                <span>
                  {scale.breaks[idx - 1]} - {scale.breaks[idx]}
                  {unit}
                </span>
              )}
            </div>
          </div>
        ))}
      </div>
    </Card>
  );
}
frontend/src/components/analysis-drawer.tsx
-----
import { Button } from "@/components/ui/button.tsx";
import {
  Drawer,
  DrawerClose,
  DrawerContent,
  DrawerDescription,
  DrawerFooter,
  DrawerHeader,
  DrawerTitle,
} from "@/components/ui/drawer.tsx";
import {
  Sidebar,
  SidebarContent,
  SidebarGroup,
  SidebarGroupContent,
  SidebarGroupLabel,
  SidebarMenu,
  SidebarMenuButton,
  SidebarMenuItem,
  SidebarProvider,
} from "@/components/ui/sidebar.tsx";
import AnalysisModal, { AnalysisOption } from "@/components/analysis-modal.tsx";
import { Database, Users } from "lucide-react";
import { useState } from "react";

interface AnalysisDrawerProps {
  open: boolean;
  onOpenChange: (open: boolean) => void;
}

export type AnalysisItem = {
  title: string;
  icon: typeof Database;
  description: string;
};

export default function AnalysisDrawer({
  open,
  onOpenChange,
}: AnalysisDrawerProps) {
  const [modalOpen, setModalOpen] = useState(false);
  const [selectedAnalysis, setSelectedAnalysis] = useState<AnalysisItem | null>(
    null,
  );

  const nationalAnalysisItems: AnalysisItem[] = [
    {
      title: AnalysisOption.US_VOTING_EQUIPMENT,
      icon: Database,
      description: "National voting equipment by state table",
    },
    {
      title: AnalysisOption.EQUIPMENT_SUMMARY,
      icon: Database,
      description: "US voting equipment summary by provider",
    },
  ];

  const comparisonItems: AnalysisItem[] = [
    {
      title: AnalysisOption.REPUBLICAN_VS_DEMOCRATIC,
      icon: Users,
      description: "Compare selected Republican and Democratic states",
    },
    {
      title: AnalysisOption.EARLY_VOTING_COMPARISON,
      icon: Users,
      description: "Republican vs Democratic early voting data",
    },
    {
      title: AnalysisOption.OPT_IN_VS_OPT_OUT,
      icon: Users,
      description: "Compare opt-in and opt-out registration states",
    },
  ];

  const handleItemClick = (item: AnalysisItem) => {
    setSelectedAnalysis(item);
    setModalOpen(true);
  };

  return (
    <>
      <AnalysisModal
        open={modalOpen}
        onOpenChange={setModalOpen}
        selectedAnalysis={selectedAnalysis}
      />

      <Drawer open={open} onOpenChange={onOpenChange}>
        {/*
      TODO: functionality for tables and graphs here, use https://ui.shadcn.com/docs/components/data-table imo and then chart js
      TODO: for the rest, generate the mock data, table/chart labels should be in the use cases */}
        <DrawerContent className="h-[85vh]">
          <DrawerHeader className="text-left border-b">
            <DrawerTitle>Election Analysis Tools</DrawerTitle>
            <DrawerDescription>
              Comprehensive analysis tools for election data exploration
            </DrawerDescription>
          </DrawerHeader>

          <div className="flex-1 overflow-auto">
            <SidebarProvider>
              <Sidebar variant="sidebar" className="w-full border-0">
                <SidebarContent>
                  <SidebarGroup>
                    <SidebarGroupLabel>National Equipment</SidebarGroupLabel>
                    <SidebarGroupContent>
                      <SidebarMenu>
                        {nationalAnalysisItems.map((item) => (
                          <SidebarMenuItem key={item.title}>
                            <SidebarMenuButton
                              tooltip={item.description}
                              onClick={() => handleItemClick(item)}
                            >
                              <item.icon className="h-4 w-4" />
                              <span>{item.title}</span>
                            </SidebarMenuButton>
                          </SidebarMenuItem>
                        ))}
                      </SidebarMenu>
                    </SidebarGroupContent>
                  </SidebarGroup>

                  <SidebarGroup>
                    <SidebarGroupLabel>State Comparisons</SidebarGroupLabel>
                    <SidebarGroupContent>
                      <SidebarMenu>
                        {comparisonItems.map((item) => (
                          <SidebarMenuItem key={item.title}>
                            <SidebarMenuButton
                              tooltip={item.description}
                              onClick={() => handleItemClick(item)}
                            >
                              <item.icon className="h-4 w-4" />
                              <span>{item.title}</span>
                            </SidebarMenuButton>
                          </SidebarMenuItem>
                        ))}
                      </SidebarMenu>
                    </SidebarGroupContent>
                  </SidebarGroup>
                </SidebarContent>
              </Sidebar>
            </SidebarProvider>
          </div>

          <DrawerFooter className="border-t">
            <DrawerClose asChild>
              <Button variant="outline">Close</Button>
            </DrawerClose>
          </DrawerFooter>
        </DrawerContent>
      </Drawer>
    </>
  );
}
frontend/src/components/map/bubble-chart-layer.tsx
-----
import { CircleMarker, Popup, useMap } from "react-leaflet";
import { useEffect } from "react";

export interface CensusBlockData {
  blockId: string;
  latitude: number;
  longitude: number;
  dominantParty: "Democratic" | "Republican";
  democraticVoters: number;
  republicanVoters: number;
}

interface BubbleChartLayerProps {
  data: CensusBlockData[];
  visible: boolean;
}

// Component to create custom pane for bubble chart
function BubbleChartPane() {
  const map = useMap();

  useEffect(() => {
    if (!map.getPane("bubbleChart")) {
      const bubbleChartPane = map.createPane("bubbleChart");
      bubbleChartPane.style.zIndex = "700"; // Higher than other layers
      bubbleChartPane.style.pointerEvents = "auto";
    }
  }, [map]);

  return null;
}

export default function BubbleChartLayer({
  data,
  visible,
}: BubbleChartLayerProps) {
  useEffect(() => {
    console.log("BubbleChartLayer - visible:", visible);
    console.log("BubbleChartLayer - data length:", data.length);
    console.log("BubbleChartLayer - sample data:", data.slice(0, 2));
  }, [visible, data]);

  if (!visible) {
    console.log("BubbleChartLayer not visible, returning null");
    return null;
  }

  if (!data || data.length === 0) {
    console.log("BubbleChartLayer has no data");
    return null;
  }

  console.log("BubbleChartLayer rendering", data.length, "bubbles");

  return (
    <>
      <BubbleChartPane />
      {data.map((block) => (
        <CircleMarker
          key={block.blockId}
          center={[block.latitude, block.longitude]}
          radius={6}
          pathOptions={{
            fillColor:
              block.dominantParty === "Democratic" ? "#3b82f6" : "#ef4444",
            color: block.dominantParty === "Democratic" ? "#1d4ed8" : "#dc2626",
            weight: 2,
            opacity: 0.9,
            fillOpacity: 0.7,
          }}
          pane="bubbleChart"
        >
          <Popup>
            <div className="text-xs">
              <div className="font-semibold mb-1">Block {block.blockId}</div>
              <div className="space-y-1">
                <div className="text-blue-600">
                  Democratic: {block.democraticVoters.toLocaleString()}
                </div>
                <div className="text-red-600">
                  Republican: {block.republicanVoters.toLocaleString()}
                </div>
                <div className="font-medium">
                  Dominant: {block.dominantParty}
                </div>
              </div>
            </div>
          </Popup>
        </CircleMarker>
      ))}
    </>
  );
}
frontend/src/components/map/base-map.tsx
-----
import React, { type ReactNode, useEffect, useState } from "react";
import { MapContainer, TileLayer, useMap } from "react-leaflet";
import type { MapContainerProps } from "react-leaflet";
import type { LatLngExpression } from "leaflet";
import type { FeatureCollection, Geometry } from "geojson";
import L from "leaflet";
import "leaflet/dist/leaflet.css";

// FitBoundsToGeoJSON component to automatically zoom to fit the GeoJSON data
function FitBoundsToGeoJSON<T = Record<string, unknown>>({
  geoJsonData,
}: {
  geoJsonData?: FeatureCollection<Geometry, T>;
}) {
  const map = useMap();

  useEffect(() => {
    if (geoJsonData && geoJsonData.features.length > 0) {
      const group = L.geoJSON(geoJsonData);
      const bounds = group.getBounds();

      if (bounds.isValid()) {
        map.fitBounds(bounds, { padding: [75, 75] });
      }
    }
  }, [map, geoJsonData]);

  return null;
}

const CustomPanes = () => {
  const map = useMap();

  useEffect(() => {
    // Create a custom pane for labels so they appear above other layers
    if (!map.getPane("labels")) {
      const labelsPane = map.createPane("labels");
      labelsPane.style.zIndex = "650";
      labelsPane.style.pointerEvents = "none"; // Prevent labels from blocking mouse events
    }

    // Create a custom pane for the base tiles with lower z-index
    if (!map.getPane("baseTiles")) {
      const baseTilesPane = map.createPane("baseTiles");
      baseTilesPane.style.zIndex = "100"; // Lower than overlays (200)
    }

    map.zoomControl.setPosition("bottomright");

    // Add custom styling to prevent zoom controls from being cut off using relative positioning
    const zoomControl = map.zoomControl.getContainer();
    if (zoomControl) {
      zoomControl.style.position = "relative";
      zoomControl.style.bottom = "20px";
      zoomControl.style.left = "20px";
      zoomControl.style.transform = "translate(-50%, -100%)";
    }

    // Also add padding to the map container to ensure controls don't get cut off
    const mapContainer = map.getContainer();
    if (mapContainer) {
      mapContainer.style.paddingBottom = "50px";
      mapContainer.style.paddingLeft = "50px";
    }
  }, [map]);

  return null;
};

// Component to update map minZoom dynamically
function UpdateMinZoom({ minZoom }: { minZoom: number }) {
  const map = useMap();

  useEffect(() => {
    map.setMinZoom(minZoom);
  }, [map, minZoom]);

  return null;
}

interface BaseMapProps<T = Record<string, unknown>>
  extends Omit<MapContainerProps, "center" | "zoom"> {
  center?: LatLngExpression;
  zoom?: number;
  style?: React.CSSProperties;
  className?: string;
  children?: ReactNode;
  fitToGeoJSON?: FeatureCollection<Geometry, T>;
}

export default function BaseMap<T = Record<string, unknown>>({
  center = [38.5, -99.0],
  zoom = 4,
  style = {
    width: "100%",
    height: "100%",
    zIndex: 0,
  },
  className = "",
  children,
  fitToGeoJSON,
  ...mapProps
}: BaseMapProps<T>) {
  const [minZoom, setMinZoom] = useState(4);

  useEffect(() => {
    const updateMinZoom = () => {
      // Consider screens 1366px and below as laptop/small screens
      const isSmallScreen = window.innerWidth <= 1366;
      setMinZoom(isSmallScreen ? 4 : 5);
    };

    // Set initial value
    updateMinZoom();

    // Listen for window resize
    window.addEventListener("resize", updateMinZoom);

    // Cleanup listener
    return () => window.removeEventListener("resize", updateMinZoom);
  }, []);

  return (
    <MapContainer
      center={center}
      zoom={zoom}
      zoomSnap={0.5}
      minZoom={minZoom}
      maxZoom={8}
      maxBounds={[
        [15, -140],
        [56, -54],
      ]} // Constrain view to roughly continental US area
      maxBoundsViscosity={0.95}
      style={style}
      className={className}
      scrollWheelZoom={true}
      doubleClickZoom={true}
      {...mapProps}
    >
      <CustomPanes />
      <UpdateMinZoom minZoom={minZoom} />

      {/* Auto-fit bounds if GeoJSON data is provided */}
      {fitToGeoJSON && <FitBoundsToGeoJSON geoJsonData={fitToGeoJSON} />}

      {/* Base layer without labels */}
      <TileLayer
        url="https://{s}.basemaps.cartocdn.com/rastertiles/voyager_nolabels/{z}/{x}/{y}{r}.png"
        attribution="¬©OpenStreetMap, ¬©CartoDB"
        maxZoom={18}
        pane="baseTiles"
      />

      {/* Labels layer on top */}
      <TileLayer
        url="https://{s}.basemaps.cartocdn.com/light_only_labels/{z}/{x}/{y}.png"
        attribution="¬©OpenStreetMap, ¬©CartoDB"
        maxZoom={18}
        pane="labels"
      />

      {children}
    </MapContainer>
  );
}
frontend/src/components/map/choropleth-layer.tsx
-----
import { GeoJSON } from "react-leaflet";
import type { FeatureCollection, Geometry, Feature } from "geojson";
import type { PathOptions, Layer, LeafletMouseEvent } from "leaflet";
import type { BaseMapProps, MapFeatureProps } from "@/types/map";
import {
  defaultGrayTint,
  getEquipmentAgeColor,
  getProvisionalBallotsColor,
  getActiveVotersColor,
  getPollbookDeletionsColor,
  getMailBallotsRejectedColor,
  getVoterRegistrationColor,
  getVotingEquipmentTypeColor,
  type VotingEquipmentType,
} from "@/lib/colors";
import {
  SPLASH_CHOROPLETH_OPTIONS,
  STATE_CHOROPLETH_OPTIONS,
  type ChoroplethOption,
} from "@/constants/choropleth";

interface ChoroplethLayerProps<T extends BaseMapProps = MapFeatureProps> {
  data: FeatureCollection<Geometry, T>;
  choroplethOption?: ChoroplethOption;
  stateView?: boolean;
}

export default function ChoroplethLayer<
  T extends BaseMapProps = MapFeatureProps,
>({
  data,
  choroplethOption = STATE_CHOROPLETH_OPTIONS.OFF,
  stateView = false,
}: ChoroplethLayerProps<T>) {
  const getFeatureStyle = (feature?: Feature<Geometry, T>): PathOptions => {
    if (choroplethOption === "off") {
      return {
        fillColor: defaultGrayTint(),
        weight: 0,
        opacity: 0,
        color: "transparent",
        fillOpacity: 0.7,
      };
    }

    let fillColor = defaultGrayTint();

    if (feature?.properties) {
      const props = feature.properties as Record<string, unknown>;

      switch (choroplethOption) {
        // Splash page choropleth options
        case SPLASH_CHOROPLETH_OPTIONS.EQUIPMENT_AGE: {
          const equipmentAge =
            "EQUIPMENT_AGE" in props ? (props.EQUIPMENT_AGE as number) || 0 : 0;
          fillColor = getEquipmentAgeColor(equipmentAge);
          break;
        }

        // State page choropleth options
        case STATE_CHOROPLETH_OPTIONS.PROVISIONAL_BALLOTS: {
          const provisionalBallotsPct =
            "PROVISIONAL_BALLOTS_PCT" in props
              ? (props.PROVISIONAL_BALLOTS_PCT as number) || 0
              : 0;
          fillColor = getProvisionalBallotsColor(provisionalBallotsPct);
          break;
        }

        case STATE_CHOROPLETH_OPTIONS.ACTIVE_VOTERS: {
          const activeVotersPct =
            "ACTIVE_VOTERS_PCT" in props
              ? (props.ACTIVE_VOTERS_PCT as number) || 0
              : 0;
          fillColor = getActiveVotersColor(activeVotersPct);
          break;
        }

        case STATE_CHOROPLETH_OPTIONS.POLLBOOK_DELETIONS: {
          const pollbookDeletionsPct =
            "POLLBOOK_DELETIONS_PCT" in props
              ? (props.POLLBOOK_DELETIONS_PCT as number) || 0
              : 0;
          fillColor = getPollbookDeletionsColor(pollbookDeletionsPct);
          break;
        }

        case STATE_CHOROPLETH_OPTIONS.MAIL_BALLOTS_REJECTED: {
          const mailBallotsRejectedPct =
            "MAIL_BALLOTS_REJECTED_PCT" in props
              ? (props.MAIL_BALLOTS_REJECTED_PCT as number) || 0
              : 0;
          fillColor = getMailBallotsRejectedColor(mailBallotsRejectedPct);
          break;
        }

        case STATE_CHOROPLETH_OPTIONS.VOTER_REGISTRATION: {
          const voterRegistrationPct =
            "VOTER_REGISTRATION_PCT" in props
              ? (props.VOTER_REGISTRATION_PCT as number) || 0
              : 0;
          fillColor = getVoterRegistrationColor(voterRegistrationPct);
          break;
        }

        case STATE_CHOROPLETH_OPTIONS.VOTING_EQUIPMENT_TYPE: {
          const equipmentType =
            "VOTING_EQUIPMENT_TYPE" in props
              ? (props.VOTING_EQUIPMENT_TYPE as VotingEquipmentType)
              : "scanner";
          fillColor = getVotingEquipmentTypeColor(equipmentType);
          break;
        }
      }
    }

    return {
      fillColor,
      weight: 0,
      opacity: 0,
      color: "transparent",
      fillOpacity: 0.7,
    };
  };

  const onEachFeature = (feature: Feature<Geometry, T>, layer: Layer) => {
    if (feature.properties && choroplethOption !== "off") {
      if (!stateView)
        layer.on({
          mouseover: (e: LeafletMouseEvent) => {
            const targetLayer = e.target;
            targetLayer.setStyle({
              fillOpacity: 0.8,
            });
          },
          mouseout: (e: LeafletMouseEvent) => {
            const targetLayer = e.target;
            targetLayer.setStyle(getFeatureStyle(feature));
          },
        });
    }
  };

  return (
    <GeoJSON
      data={data}
      style={getFeatureStyle}
      onEachFeature={onEachFeature}
    />
  );
}
frontend/src/components/map/state-map.tsx
-----
import { useMemo, useState } from "react";
import { GeoJSON } from "react-leaflet";
import BaseMap from "@/components/map/base-map.tsx";
import OutlineLayer from "@/components/map/outline-layer.tsx";
import ChoroplethLayer from "@/components/map/choropleth-layer.tsx";
import BubbleChartLayer, {
  type CensusBlockData,
} from "@/components/map/bubble-chart-layer.tsx";
import type { FeatureCollection, Geometry } from "geojson";
import type { StateProps, CountyProps } from "@/types/map.ts";
import type { StateChoroplethOption } from "@/constants/choropleth.ts";
import { ChoroplethLegend } from "@/components/choropleth-legend.tsx";
import {
  Dialog,
  DialogContent,
  DialogHeader,
  DialogTitle,
  DialogDescription,
  DialogFooter,
  DialogClose,
} from "@/components/ui/dialog";
import { Button } from "@/components/ui/button";

/** ---------- Types ---------- */
interface StateMapProps {
  currentStateData: FeatureCollection<Geometry, StateProps>;
  currentCountiesData: FeatureCollection<Geometry, CountyProps> | null;
  isDetailedState: boolean;
  choroplethOption?: StateChoroplethOption;
  censusBlockData?: CensusBlockData[];
  showBubbleChart?: boolean;
  votingEquipmentData?: Array<{
    eavsRegion: string;
    equipmentTypes: string[];
    primaryEquipment: string;
  }>;
}

type SafeCounty = {
  name: string;
  statefp: string; // e.g., "01"
  countyfp: string; // e.g., "001"
  geoid: string; // e.g., "01001"
};

type Party = "Democrat" | "Republican" | "Other";

type Voter = {
  id: string;
  name: string;
  email: string;
  party: Party;
  registered: boolean;
  mailInVote: boolean;
  zip: string;
};

type PartyStats = {
  party: Party;
  count: number;
  pct: number; // 0-100
};

type DummyVoterData = {
  geoid: string;
  total: number;
  byParty: PartyStats[];
  votersSample: Voter[]; // subset to show in modal
};

/** ---------- Utils: schema-safe, seeded RNG, dummy gen ---------- */
function toSafeCounty(props: unknown): SafeCounty {
  const p = (props ?? {}) as Record<string, unknown>;
  const pick = (...keys: string[]) => {
    for (const k of keys) {
      const v = p[k];
      if (v != null && v !== "") return String(v);
    }
    return "";
  };

  return {
    name: pick("NAME", "name") || "Unknown County",
    statefp: pick("STATEFP", "state", "STATE", "state_code") || "N/A",
    countyfp: pick("COUNTYFP", "county_code") || "N/A",
    geoid:
      pick("GEOID", "FIPS", "fips", "id") ||
      `FAKE-${Math.floor(Math.random() * 10000)}`,
  };
}

// Simple deterministic string hash ‚Üí 32-bit int
function hash32(s: string): number {
  let h = 2166136261 >>> 0;
  for (let i = 0; i < s.length; i++) {
    h ^= s.charCodeAt(i);
    h = Math.imul(h, 16777619);
  }
  return h >>> 0;
}

// Mulberry32 PRNG
function mulberry32(seed: number) {
  let t = seed >>> 0;
  return function rand() {
    t += 0x6d2b79f5;
    let x = Math.imul(t ^ (t >>> 15), 1 | t);
    x ^= x + Math.imul(x ^ (x >>> 7), 61 | x);
    return ((x ^ (x >>> 14)) >>> 0) / 4294967296;
  };
}

const FIRST_NAMES = [
  "Alex",
  "Taylor",
  "Jordan",
  "Casey",
  "Riley",
  "Morgan",
  "Avery",
  "Sam",
  "Jamie",
  "Cameron",
  "Devin",
  "Quinn",
  "Parker",
  "Drew",
  "Reese",
  "Rowan",
  "Elliot",
  "Kyle",
  "Logan",
  "Harper",
];
const LAST_NAMES = [
  "Smith",
  "Johnson",
  "Brown",
  "Taylor",
  "Anderson",
  "Thomas",
  "Jackson",
  "White",
  "Harris",
  "Martin",
  "Thompson",
  "Garcia",
  "Martinez",
  "Robinson",
  "Clark",
  "Rodriguez",
  "Lewis",
  "Lee",
  "Walker",
  "Hall",
];

// Random-ish 3-letter ‚ÄúZIP‚Äù token for demo
const ZIPS = [
  "MIA",
  "LAX",
  "NYC",
  "SEA",
  "DAL",
  "ATL",
  "PHL",
  "BOS",
  "DEN",
  "PHX",
  "MSP",
  "DTW",
  "CLT",
  "HOU",
  "SFO",
];

function pickOne<T>(arr: T[], r: () => number): T {
  return arr[Math.floor(r() * arr.length)];
}

function makeEmail(name: string, r: () => number): string {
  const providers = ["example.com", "mail.com", "inbox.com", "post.com"];
  const handle =
    name.toLowerCase().replace(/\s+/g, ".") + Math.floor(r() * 100);
  return `${handle}@${pickOne(providers, r)}`;
}

// Given a seed, produce stable party distribution that still "looks random"
function partyMix(rand: () => number): [number, number, number] {
  // Draw two points on simplex and normalize to 100
  const d = rand() * 0.6 + 0.2; // 20‚Äì80%
  const r = rand() * (1 - d);
  const o = 1 - d - r;
  // randomize which party is "strong"
  const roll = rand();
  let dem = d,
    rep = r,
    oth = o;
  if (roll < 0.33) [dem, rep] = [rep, dem];
  else if (roll < 0.66) [dem, oth] = [oth, dem];
  // percentages as integers that sum to 100
  const D = Math.max(5, Math.round(dem * 100));
  const R = Math.max(5, Math.round(rep * 100));
  let O = Math.max(2, 100 - D - R);
  // re-balance if rounding pushed sum off
  const diff = 100 - (D + R + O);
  if (diff !== 0) O += diff;
  return [D, R, O];
}

function generateDummyVoters(geoid: string, countHint = 180): DummyVoterData {
  const seed = hash32(geoid);
  const r = mulberry32(seed);

  // Total voters between ~120 and ~420
  const total = Math.floor(countHint * (0.7 + r() * 1.6));

  const [demPct, repPct, othPct] = partyMix(r);
  const demCount = Math.round((demPct / 100) * total);
  const repCount = Math.round((repPct / 100) * total);
  const othCount = total - demCount - repCount;

  const voters: Voter[] = [];
  const mkVoter = (party: Party): Voter => {
    const name = `${pickOne(FIRST_NAMES, r)} ${pickOne(LAST_NAMES, r)}`;
    return {
      id: Math.floor(r() * 0xffffffff)
        .toString(16)
        .padStart(8, "0"),
      name,
      email: makeEmail(name, r),
      party,
      registered: r() > 0.05, // ~95% registered
      mailInVote: r() > 0.7, // ~30% mail-in
      zip: pickOne(ZIPS, r),
    };
  };

  for (let i = 0; i < demCount; i++) voters.push(mkVoter("Democrat"));
  for (let i = 0; i < repCount; i++) voters.push(mkVoter("Republican"));
  for (let i = 0; i < othCount; i++) voters.push(mkVoter("Other"));

  // Stable shuffle based on seed (Fisher‚ÄìYates using r)
  for (let i = voters.length - 1; i > 0; i--) {
    const j = Math.floor(r() * (i + 1));
    [voters[i], voters[j]] = [voters[j], voters[i]];
  }

  const sample = voters.slice(0, 12); // keep modal light

  const byParty: PartyStats[] = [
    { party: "Democrat", count: demCount, pct: demPct },
    { party: "Republican", count: repCount, pct: repPct },
    { party: "Other", count: othCount, pct: othPct },
  ];

  return { geoid, total, byParty, votersSample: sample };
}

/** ---------- Component ---------- */
export default function StateMap({
  currentStateData,
  currentCountiesData,
  isDetailedState,
  choroplethOption,
  censusBlockData = [],
  showBubbleChart = false,
  votingEquipmentData = [],
}: StateMapProps) {
  const [selectedCounty, setSelectedCounty] = useState<SafeCounty | null>(null);
  const [currentPage, setCurrentPage] = useState(0);
  const pageSize = 5;

  const transparentStyle = useMemo(
    () => ({ color: "#000000", weight: 0, opacity: 0, fillOpacity: 0 }),
    [],
  );

  // Generate dummy voter data whenever county changes
  const voterData = useMemo<DummyVoterData | null>(() => {
    if (!selectedCounty?.geoid) return null;
    return generateDummyVoters(selectedCounty.geoid);
  }, [selectedCounty?.geoid]);

  // Reset pagination when county changes
  const handleCountyChange = (county: SafeCounty | null) => {
    setSelectedCounty(county);
    setCurrentPage(0);
  };

  // Calculate pagination for sample voters
  const totalPages = voterData
    ? Math.ceil(voterData.votersSample.length / pageSize)
    : 0;
  const paginatedVoters = voterData
    ? voterData.votersSample.slice(
        currentPage * pageSize,
        (currentPage + 1) * pageSize,
      )
    : [];

  const handleNextPage = () => {
    if (currentPage < totalPages - 1) {
      setCurrentPage(currentPage + 1);
    }
  };

  const handlePrevPage = () => {
    if (currentPage > 0) {
      setCurrentPage(currentPage - 1);
    }
  };

  return (
    <div className="relative overflow-hidden h-screen">
      <div className="w-full h-full">
        <BaseMap
          center={[39, -97]}
          zoom={4}
          style={{ width: "100%", height: "78%", zIndex: 0 }}
          fitToGeoJSON={currentStateData}
        >
          {isDetailedState && currentCountiesData ? (
            <>
              <ChoroplethLayer
                data={currentCountiesData}
                choroplethOption={choroplethOption}
                stateView
              />
              <OutlineLayer data={currentCountiesData} stateView />

              {/* Click-only overlay */}
              <GeoJSON
                data={currentCountiesData}
                style={() => transparentStyle}
                eventHandlers={{
                  click: (e) => {
                    const props =
                      e?.sourceTarget?.feature?.properties ??
                      e?.layer?.feature?.properties ??
                      e?.target?.feature?.properties ??
                      null;
                    handleCountyChange(props ? toSafeCounty(props) : null);
                  },
                }}
              />
            </>
          ) : (
            <>
              <ChoroplethLayer
                data={currentStateData}
                choroplethOption={choroplethOption}
                stateView
              />
              <OutlineLayer data={currentStateData} stateView />
            </>
          )}

          <BubbleChartLayer data={censusBlockData} visible={showBubbleChart} />
        </BaseMap>

        {/* Choropleth Legend - positioned on the map */}
        {choroplethOption && choroplethOption !== "off" && (
          <div className="absolute bottom-32 left-4 z-10 max-w-xs">
            <ChoroplethLegend
              choroplethOption={choroplethOption}
              votingEquipmentData={votingEquipmentData}
            />
          </div>
        )}
      </div>

      {/* Modal */}
      <Dialog
        open={!!selectedCounty}
        onOpenChange={(open) => !open && handleCountyChange(null)}
      >
        <DialogContent className="sm:max-w-3xl">
          <DialogHeader>
            <DialogTitle>
              {selectedCounty?.name ?? "County Details"}
            </DialogTitle>
            <DialogDescription>
              GEOID: {selectedCounty?.geoid ?? "N/A"} ‚Ä¢ StateFP:{" "}
              {selectedCounty?.statefp ?? "N/A"} ‚Ä¢ CountyFP:{" "}
              {selectedCounty?.countyfp ?? "N/A"}
            </DialogDescription>
          </DialogHeader>

          {/* Party breakdown */}
          <div className="mt-2">
            <h3 className="text-sm font-semibold mb-2">Party Breakdown</h3>
            <div className="overflow-x-auto rounded-2xl border">
              <table className="min-w-full text-sm">
                <thead className="bg-muted/50">
                  <tr>
                    <th className="px-3 py-2 text-left">Party</th>
                    <th className="px-3 py-2 text-right">Count</th>
                    <th className="px-3 py-2 text-right">Percent</th>
                  </tr>
                </thead>
                <tbody>
                  {voterData?.byParty.map((row) => (
                    <tr key={row.party} className="border-t">
                      <td className="px-3 py-2">{row.party}</td>
                      <td className="px-3 py-2 text-right">
                        {row.count.toLocaleString()}
                      </td>
                      <td className="px-3 py-2 text-right">{row.pct}%</td>
                    </tr>
                  ))}
                  <tr className="border-t font-semibold">
                    <td className="px-3 py-2">Total</td>
                    <td className="px-3 py-2 text-right">
                      {voterData?.total.toLocaleString() ?? "‚Äî"}
                    </td>
                    <td className="px-3 py-2 text-right">100%</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>

          {/* Sample voters */}
          <div className="mt-6">
            <div className="flex items-center justify-between mb-2">
              <h3 className="text-sm font-semibold">
                Sample Voters ({voterData?.votersSample.length ?? 0})
              </h3>
              {voterData && totalPages > 1 && (
                <div className="text-xs text-muted-foreground">
                  Page {currentPage + 1} of {totalPages}
                </div>
              )}
            </div>
            <div className="overflow-x-auto rounded-2xl border">
              <table className="min-w-full text-sm">
                <thead className="bg-muted/50">
                  <tr>
                    <th className="px-3 py-2 text-left">Name</th>
                    <th className="px-3 py-2 text-left">Email</th>
                    <th className="px-3 py-2 text-left">Party</th>
                    <th className="px-3 py-2 text-left">ZIP</th>
                    <th className="px-3 py-2 text-left">Registered</th>
                    <th className="px-3 py-2 text-left">Mail-in</th>
                  </tr>
                </thead>
                <tbody>
                  {paginatedVoters.map((v) => (
                    <tr key={v.id} className="border-t">
                      <td className="px-3 py-2">{v.name}</td>
                      <td className="px-3 py-2">{v.email}</td>
                      <td className="px-3 py-2">{v.party}</td>
                      <td className="px-3 py-2">{v.zip}</td>
                      <td className="px-3 py-2">
                        {v.registered ? "Yes" : "No"}
                      </td>
                      <td className="px-3 py-2">
                        {v.mailInVote ? "Yes" : "No"}
                      </td>
                    </tr>
                  ))}
                  {!voterData && (
                    <tr>
                      <td
                        className="px-3 py-6 text-center text-muted-foreground"
                        colSpan={6}
                      >
                        Click a county to generate sample voters.
                      </td>
                    </tr>
                  )}
                </tbody>
              </table>
            </div>

            {/* Pagination controls */}
            {voterData && totalPages > 1 && (
              <div className="flex items-center justify-between mt-3">
                <div className="text-xs text-muted-foreground">
                  Showing {currentPage * pageSize + 1}-
                  {Math.min(
                    (currentPage + 1) * pageSize,
                    voterData.votersSample.length,
                  )}{" "}
                  of {voterData.votersSample.length} voters
                </div>
                <div className="flex items-center space-x-2">
                  <Button
                    variant="outline"
                    size="sm"
                    onClick={handlePrevPage}
                    disabled={currentPage === 0}
                  >
                    Previous
                  </Button>
                  <Button
                    variant="outline"
                    size="sm"
                    onClick={handleNextPage}
                    disabled={currentPage >= totalPages - 1}
                  >
                    Next
                  </Button>
                </div>
              </div>
            )}
          </div>

          <DialogFooter className="mt-4">
            <DialogClose asChild>
              <Button variant="secondary">Close</Button>
            </DialogClose>
          </DialogFooter>
        </DialogContent>
      </Dialog>
    </div>
  );
}
frontend/src/components/map/outline-layer.tsx
-----
import { GeoJSON } from "react-leaflet";
import type { FeatureCollection, Geometry, Feature } from "geojson";
import type { PathOptions, Layer, LeafletMouseEvent } from "leaflet";
import { useRouter } from "@tanstack/react-router";
import { DETAILED_STATES } from "@/constants/states.ts";
import { formatStateNameForUrl } from "@/lib/utils";
import type { BaseMapProps, MapFeatureProps } from "@/types/map";

interface OutlineLayerProps<T extends BaseMapProps = MapFeatureProps> {
  data: FeatureCollection<Geometry, T>;
  onFeatureClick?: (feature: Feature<Geometry, T>) => void;
  showPopup?: boolean;
  outlineColor?: string;
  outlineWeight?: number;
  hoverColor?: string;
  hoverWeight?: number;
  stateView?: boolean;
}

export default function OutlineLayer<T extends BaseMapProps = MapFeatureProps>({
  data,
  onFeatureClick,
  outlineColor = "#5d5656",
  outlineWeight = 1,
  hoverColor = "#1a1a1a",
  hoverWeight = 4,
  stateView = false,
}: OutlineLayerProps<T>) {
  const router = useRouter();

  const getFeatureStyle = (feature?: Feature<Geometry, T>): PathOptions => {
    // Check if this state is in our detailed states
    const isDetailedState =
      feature?.properties?.NAME &&
      Object.keys(DETAILED_STATES).includes(
        formatStateNameForUrl(feature.properties.NAME),
      );
    const isCounty = feature?.properties && "STATEFP" in feature.properties;
    return {
      fillColor: "transparent",
      fillOpacity: 0,
      weight:
        isDetailedState || (stateView && !isCounty)
          ? outlineWeight * 3
          : outlineWeight,
      opacity: 1,
      color: isDetailedState ? "#101010" : outlineColor,
    };
  };

  const onEachFeature = (feature: Feature<Geometry, T>, layer: Layer) => {
    if (feature.properties) {
      layer.on({
        mouseover: (e: LeafletMouseEvent) => {
          const targetLayer = e.target;
          targetLayer.setStyle({
            weight: hoverWeight,
            color: hoverColor,
          });
        },
        mouseout: (e: LeafletMouseEvent) => {
          const targetLayer = e.target;
          targetLayer.setStyle(getFeatureStyle(feature));
        },
        click: () => {
          // Only handle navigation for state features and when not in state view
          if (feature.properties.NAME && !stateView) {
            const stateName = formatStateNameForUrl(feature.properties.NAME);
            router.navigate({ to: `/state/${stateName}` });
          }

          if (onFeatureClick) {
            onFeatureClick(feature);
          }
        },
      });
    }
  };

  return (
    <GeoJSON
      data={data}
      style={(feature) => getFeatureStyle(feature)}
      onEachFeature={onEachFeature}
    />
  );
}
frontend/src/components/table/voting-equipment-columns.tsx
-----
import type { ColumnDef } from "@tanstack/react-table";

export type VotingEquipment = {
  state: string;
  dreNoVVPAT: number;
  dreWithVVPAT: number;
  ballotMarkingDevice: number;
  scanner: number;
};

export const votingEquipmentColumns: ColumnDef<VotingEquipment>[] = [
  {
    accessorKey: "state",
    header: "State",
    cell: ({ row }) => (
      <div className="font-medium">{row.getValue("state")}</div>
    ),
  },
  {
    accessorKey: "dreNoVVPAT",
    header: () => <div className="text-right">DRE (No VVPAT)</div>,
    cell: ({ row }) => {
      const value = row.getValue("dreNoVVPAT") as number;
      return <div className="text-right">{value.toLocaleString()}</div>;
    },
  },
  {
    accessorKey: "dreWithVVPAT",
    header: () => <div className="text-right">DRE (With VVPAT)</div>,
    cell: ({ row }) => {
      const value = row.getValue("dreWithVVPAT") as number;
      return <div className="text-right">{value.toLocaleString()}</div>;
    },
  },
  {
    accessorKey: "ballotMarkingDevice",
    header: () => <div className="text-right">Ballot Marking Device</div>,
    cell: ({ row }) => {
      const value = row.getValue("ballotMarkingDevice") as number;
      return <div className="text-right">{value.toLocaleString()}</div>;
    },
  },
  {
    accessorKey: "scanner",
    header: () => <div className="text-right">Scanner</div>,
    cell: ({ row }) => {
      const value = row.getValue("scanner") as number;
      return <div className="text-right">{value.toLocaleString()}</div>;
    },
  },
];
frontend/src/components/table/mail-ballots-rejected-columns.tsx
-----
import type { ColumnDef, Row } from "@tanstack/react-table";

export interface MailBallotsRejectedData {
  eavsRegion: string;
  C9b: number;
  C9c: number;
  C9d: number;
  C9e: number;
  C9f: number;
  C9g: number;
  C9h: number;
  C9i: number;
  C9j: number;
  C9k: number;
  C9l: number;
  C9m: number;
  C9n: number;
  C9o: number;
  C9p: number;
  C9q: number;
  notes: string;
}

export const mailBallotsRejectedColumns: ColumnDef<MailBallotsRejectedData>[] =
  [
    {
      accessorKey: "eavsRegion",
      header: () => <div className="text-left">EAVS Region</div>,
      cell: ({ row }: { row: Row<MailBallotsRejectedData> }) => (
        <div className="text-xs text-left text-black font-medium">
          {row.getValue("eavsRegion")}
        </div>
      ),
    },
    ...(
      [
        "C9b",
        "C9c",
        "C9d",
        "C9e",
        "C9f",
        "C9g",
        "C9h",
        "C9i",
        "C9j",
        "C9k",
        "C9l",
        "C9m",
        "C9n",
        "C9o",
        "C9p",
        "C9q",
      ] as const
    ).map((key) => ({
      accessorKey: key,
      header: () => <div className="text-right">{key.toUpperCase()}</div>,
      cell: ({ row }: { row: Row<MailBallotsRejectedData> }) => (
        <div className="text-xs text-right text-black">
          {(row.getValue(key) as number).toLocaleString()}
        </div>
      ),
    })),
    {
      accessorKey: "notes",
      header: () => <div className="text-left">Notes</div>,
      cell: ({ row }: { row: Row<MailBallotsRejectedData> }) => (
        <div className="text-xs text-left text-black">
          {row.getValue("notes")}
        </div>
      ),
    },
  ];
frontend/src/components/table/data-table.tsx
-----
"use client";
import type { ColumnDef } from "@tanstack/react-table";

import {
  flexRender,
  getCoreRowModel,
  useReactTable,
  getPaginationRowModel,
} from "@tanstack/react-table";

import {
  Table,
  TableBody,
  TableCell,
  TableHead,
  TableHeader,
  TableRow,
} from "@/components/ui/table";

import { Button } from "@/components/ui/button";

interface DataTableProps<TData, TValue> {
  columns: ColumnDef<TData, TValue>[];
  data: TData[];
}

export function DataTable<TData, TValue>({
  columns,
  data,
}: DataTableProps<TData, TValue>) {
  const table = useReactTable({
    data,
    columns,
    getCoreRowModel: getCoreRowModel(),
    getPaginationRowModel: getPaginationRowModel(),
    initialState: {
      pagination: {
        pageSize: 6,
      },
    },
  });

  return (
    <div>
      <div className="overflow-hidden rounded-md border">
        <Table>
          <TableHeader>
            {table.getHeaderGroups().map((headerGroup) => (
              <TableRow key={headerGroup.id} className="text-xs">
                {" "}
                {/*styling for headers*/}
                {headerGroup.headers.map((header) => {
                  return (
                    <TableHead key={header.id}>
                      {header.isPlaceholder
                        ? null
                        : flexRender(
                            header.column.columnDef.header,
                            header.getContext(),
                          )}
                    </TableHead>
                  );
                })}
              </TableRow>
            ))}
          </TableHeader>
          <TableBody>
            {table.getRowModel().rows?.length ? (
              table.getRowModel().rows.map((row) => (
                <TableRow
                  key={row.id}
                  data-state={row.getIsSelected() && "selected"}
                  className="text-[10px]" //styling for rows
                >
                  {row.getVisibleCells().map((cell) => (
                    <TableCell key={cell.id}>
                      {flexRender(
                        cell.column.columnDef.cell,
                        cell.getContext(),
                      )}
                    </TableCell>
                  ))}
                </TableRow>
              ))
            ) : (
              <TableRow>
                <TableCell
                  colSpan={columns.length}
                  className="h-24 text-center"
                >
                  No results.
                </TableCell>
              </TableRow>
            )}
          </TableBody>
        </Table>
      </div>
      <div className="flex items-center justify-end space-x-2 py-4">
        <Button
          variant="outline"
          size="sm"
          onClick={() => table.previousPage()}
          disabled={!table.getCanPreviousPage()}
        >
          Previous
        </Button>
        <Button
          variant="outline"
          size="sm"
          onClick={() => table.nextPage()}
          disabled={!table.getCanNextPage()}
        >
          Next
        </Button>
      </div>
    </div>
  );
}
frontend/src/components/table/columns.tsx
-----
"use client";

import type { ColumnDef } from "@tanstack/react-table";

export type Voter = {
  id: string;
  name: string;
  registered: "true" | "false" | "unknown";
  email: string;
  mailInVote: boolean;
  zip: string;
};

export const columns: ColumnDef<Voter>[] = [
  {
    accessorKey: "name",
    header: "Name",
  },
  {
    accessorKey: "email",
    header: "Email",
  },
  {
    accessorKey: "registered",
    header: "Registered",
  },
  {
    accessorKey: "mailInVote",
    header: "Mail-in Vote",
    cell: ({ row }) => (row.original.mailInVote ? "Yes" : "No"),
  },
  {
    accessorKey: "zip",
    header: "Zip Code",
  },
];
frontend/src/components/table/provisional-ballot-table.tsx
-----
"use client";

import { useEffect, useState } from "react";
import { DataTable } from "./data-table";
import {
  provisionalBallotsColumns,
  type ProvisionBallotsData,
} from "./provisional-ballot-columns";

interface ProvisionalBallotsTableProps {
  fipsPrefix: string; // e.g. "30" for Montana
}

interface ProvisionalBallotsApiResponse {
  jurisdictionName: string;
  provisionalBallots?: {
    totalProvisionalBallotsCast?: number;
    provisionalBallotsFullyCounted?: number;
    provisionalBallotsPartiallyCounted?: number;
    provisionalBallotsRejected?: number;
    reasonNoRegistration?: number;
    reasonNameNotFound?: number;
    provisionalComments?: string;
  };
}

export function ProvisionBallotsTable({
  fipsPrefix,
}: ProvisionalBallotsTableProps) {
  const [data, setData] = useState<ProvisionBallotsData[]>([]);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    async function fetchData() {
      try {
        const res = await fetch(
          `http://localhost:8080/api/eavs/provisional/state/${fipsPrefix}`,
        );
        const json: ProvisionalBallotsApiResponse[] = await res.json();

        const mapped = json.map((record) => {
          const p = record.provisionalBallots || {};
          return {
            region: record.jurisdictionName || "Unknown",
            E2a: p.totalProvisionalBallotsCast ?? 0,
            E2b: p.provisionalBallotsFullyCounted ?? 0,
            E2c: p.provisionalBallotsPartiallyCounted ?? 0,
            E2d: p.provisionalBallotsRejected ?? 0,
            E2e: p.reasonNoRegistration ?? 0,
            E2f: p.reasonNameNotFound ?? 0,
            E2g: 0,
            E2h: 0,
            E2i: 0,
          };
        });

        setData(mapped);
      } catch (error) {
        console.error("‚ùå Failed to fetch provisional ballot data", error);
      } finally {
        setLoading(false);
      }
    }

    fetchData();
  }, [fipsPrefix]);

  if (loading) return <p className="text-xs text-gray-500">Loading‚Ä¶</p>;

  return (
    <div className="space-y-2">
      <h2 className="text-sm font-semibold">
        Provisional Ballots (All jurisdictions ‚Äî FIPS prefix {fipsPrefix})
      </h2>
      <DataTable columns={provisionalBallotsColumns} data={data} />
    </div>
  );
}
frontend/src/components/table/opt-in-opt-out-table.tsx
-----
import {
  flexRender,
  getCoreRowModel,
  getPaginationRowModel,
  useReactTable,
} from "@tanstack/react-table";
import { Button } from "@/components/ui/button.tsx";
import {
  Table,
  TableBody,
  TableCell,
  TableHead,
  TableHeader,
  TableRow,
} from "@/components/ui/table.tsx";
import {
  optInOptOutColumns,
  type OptInOptOutRow,
} from "./opt-in-opt-out-columns.tsx";

interface OptInOptOutTableProps {
  data: OptInOptOutRow[];
  optInState: string;
  optOutWithSameDayState: string;
  optOutWithoutSameDayState: string;
}

export function OptInOptOutTable({
  data,
  optInState,
  optOutWithSameDayState,
  optOutWithoutSameDayState,
}: OptInOptOutTableProps) {
  // Update column headers with state names
  const updatedColumns = optInOptOutColumns.map((col, idx) => {
    if (idx === 1) {
      return { ...col, header: `${optInState} (Opt-in)` };
    }
    if (idx === 2) {
      return {
        ...col,
        header: `${optOutWithSameDayState} (Opt-out, Same-Day)`,
      };
    }
    if (idx === 3) {
      return { ...col, header: `${optOutWithoutSameDayState} (Opt-out)` };
    }
    return col;
  });

  const table = useReactTable({
    data,
    columns: updatedColumns,
    getCoreRowModel: getCoreRowModel(),
    getPaginationRowModel: getPaginationRowModel(),
    initialState: {
      pagination: {
        pageSize: 10,
      },
    },
  });

  return (
    <div className="flex flex-col h-full space-y-2">
      <div className="flex-1 min-h-0 rounded-md border overflow-auto">
        <Table>
          <TableHeader className="sticky top-0 bg-background z-10">
            {table.getHeaderGroups().map((headerGroup) => (
              <TableRow key={headerGroup.id}>
                {headerGroup.headers.map((header) => {
                  return (
                    <TableHead key={header.id} className="py-2">
                      {header.isPlaceholder
                        ? null
                        : flexRender(
                            header.column.columnDef.header,
                            header.getContext(),
                          )}
                    </TableHead>
                  );
                })}
              </TableRow>
            ))}
          </TableHeader>
          <TableBody>
            {table.getRowModel().rows?.length ? (
              table.getRowModel().rows.map((row) => (
                <TableRow
                  key={row.id}
                  data-state={row.getIsSelected() && "selected"}
                  className="h-10"
                >
                  {row.getVisibleCells().map((cell) => (
                    <TableCell key={cell.id} className="py-2">
                      {flexRender(
                        cell.column.columnDef.cell,
                        cell.getContext(),
                      )}
                    </TableCell>
                  ))}
                </TableRow>
              ))
            ) : (
              <TableRow>
                <TableCell
                  colSpan={optInOptOutColumns.length}
                  className="h-24 text-center"
                >
                  No results.
                </TableCell>
              </TableRow>
            )}
          </TableBody>
        </Table>
      </div>
      <div className="flex items-center justify-end space-x-2 py-2">
        <div className="flex-1 text-sm text-muted-foreground">
          Page {table.getState().pagination.pageIndex + 1} of{" "}
          {table.getPageCount()}
        </div>
        <div className="space-x-2">
          <Button
            variant="outline"
            size="sm"
            onClick={() => table.previousPage()}
            disabled={!table.getCanPreviousPage()}
          >
            Previous
          </Button>
          <Button
            variant="outline"
            size="sm"
            onClick={() => table.nextPage()}
            disabled={!table.getCanNextPage()}
          >
            Next
          </Button>
        </div>
      </div>
    </div>
  );
}
frontend/src/components/table/voter-registration-table.tsx
-----
"use client";

import { DataTable } from "./data-table";
import {
  voterRegistrationColumns,
  type EAVSRegionVoterData,
} from "./voter-registration-columns";

interface VoterRegistrationTableProps {
  data: EAVSRegionVoterData[];
}

export function VoterRegistrationTable({ data }: VoterRegistrationTableProps) {
  return (
    <div className="space-y-2">
      <div className="text-xs">
        <DataTable columns={voterRegistrationColumns} data={data} />
      </div>
    </div>
  );
}
frontend/src/components/table/early-voting-columns.tsx
-----
import type { ColumnDef } from "@tanstack/react-table";

export type EarlyVotingRow = {
  metric: string;
  republicanValue: string | number;
  democraticValue: string | number;
};

export const earlyVotingColumns: ColumnDef<EarlyVotingRow>[] = [
  {
    accessorKey: "metric",
    header: "Metric",
    cell: ({ row }) => (
      <div className="font-medium">{row.getValue("metric")}</div>
    ),
  },
  {
    accessorKey: "republicanValue",
    header: "Republican State",
    cell: ({ row }) => <div>{row.getValue("republicanValue")}</div>,
  },
  {
    accessorKey: "democraticValue",
    header: "Democratic State",
    cell: ({ row }) => <div>{row.getValue("democraticValue")}</div>,
  },
];
frontend/src/components/table/state-comparison-columns.tsx
-----
import type { ColumnDef } from "@tanstack/react-table";

export type StateComparisonRow = {
  metric: string;
  republicanValue: string | number;
  democraticValue: string | number;
};

export const stateComparisonColumns: ColumnDef<StateComparisonRow>[] = [
  {
    accessorKey: "metric",
    header: "Metric",
    cell: ({ row }) => (
      <div className="font-medium">{row.getValue("metric")}</div>
    ),
  },
  {
    accessorKey: "republicanValue",
    header: "Republican State",
    cell: ({ row }) => <div>{row.getValue("republicanValue")}</div>,
  },
  {
    accessorKey: "democraticValue",
    header: "Democratic State",
    cell: ({ row }) => <div>{row.getValue("democraticValue")}</div>,
  },
];
frontend/src/components/table/active-voters-columns.tsx
-----
import type { ColumnDef, Row } from "@tanstack/react-table";

export interface ActiveVotersData {
  eavsRegion: string;
  activeVoters: number;
  totalVoters: number;
  inactiveVoters: number;
  cvap2023?: number; // 2023 ACS CVAP (Citizen Voting Age Population)
  registrationRate?: number; // Percentage of CVAP registered (totalVoters / cvap2023 * 100)
  notes: string;
}

export const activeVotersColumns: ColumnDef<ActiveVotersData>[] = [
  {
    accessorKey: "eavsRegion",
    header: () => <div className="text-left">EAVS Region</div>,
    cell: ({ row }: { row: Row<ActiveVotersData> }) => (
      <div className="text-xs text-left text-black font-medium">
        {row.getValue("eavsRegion")}
      </div>
    ),
  },
  {
    accessorKey: "activeVoters",
    header: () => <div className="text-right">Active Voters</div>,
    cell: ({ row }: { row: Row<ActiveVotersData> }) => (
      <div className="text-xs text-right text-black">
        {(row.getValue("activeVoters") as number).toLocaleString()}
      </div>
    ),
  },
  {
    accessorKey: "totalVoters",
    header: () => <div className="text-right">Total Voters</div>,
    cell: ({ row }: { row: Row<ActiveVotersData> }) => (
      <div className="text-xs text-right text-black">
        {(row.getValue("totalVoters") as number).toLocaleString()}
      </div>
    ),
  },
  {
    accessorKey: "inactiveVoters",
    header: () => <div className="text-right">Inactive Voters</div>,
    cell: ({ row }: { row: Row<ActiveVotersData> }) => (
      <div className="text-xs text-right text-black">
        {(row.getValue("inactiveVoters") as number).toLocaleString()}
      </div>
    ),
  },
  {
    accessorKey: "cvap2023",
    header: () => <div className="text-right">2023 CVAP</div>,
    cell: ({ row }: { row: Row<ActiveVotersData> }) => {
      const value = row.getValue("cvap2023") as number | undefined;
      if (value === undefined)
        return <div className="text-xs text-right text-gray-400">N/A</div>;
      return (
        <div className="text-xs text-right text-black">
          {value.toLocaleString()}
        </div>
      );
    },
  },
  {
    accessorKey: "registrationRate",
    header: () => <div className="text-right">CVAP Reg. Rate</div>,
    cell: ({ row }: { row: Row<ActiveVotersData> }) => {
      const value = row.getValue("registrationRate") as number | undefined;
      if (value === undefined)
        return <div className="text-xs text-right text-gray-400">N/A</div>;

      return (
        <div className="text-xs text-right text-black">{value.toFixed(1)}%</div>
      );
    },
  },
  {
    accessorKey: "notes",
    header: () => <div className="text-left">Notes</div>,
    cell: ({ row }: { row: Row<ActiveVotersData> }) => (
      <div className="text-xs text-left text-black">
        {row.getValue("notes")}
      </div>
    ),
  },
];
frontend/src/components/table/provisional-ballot-columns.tsx
-----
import type { ColumnDef, Row } from "@tanstack/react-table";

export interface ProvisionBallotsData {
  region: string; // County/Geographic region name
  E2a: number;
  E2b: number;
  E2c: number;
  E2d: number;
  E2e: number;
  E2f: number;
  E2g: number;
  E2h: number;
  E2i: number;
}

export const provisionalBallotsColumns: ColumnDef<ProvisionBallotsData>[] = [
  {
    accessorKey: "region",
    header: () => <div className="text-left font-semibold">Region</div>,
    cell: ({ row }: { row: Row<ProvisionBallotsData> }) => (
      <div className="text-xs text-left text-black font-medium py-0 px-0 max-w-3">{row.getValue("region")}</div>
    ),
  },
  ...(["E2a", "E2b", "E2c", "E2d", "E2e", "E2f", "E2g", "E2h", "E2i"] as const).map(
    (key, index, array) => ({
      accessorKey: key,
      header: () => <div className={`text-right ${index === array.length - 1 ? 'pr-4' : ''}`}>{key.toUpperCase()}</div>,
      cell: ({ row }: { row: Row<ProvisionBallotsData> }) => (
        <div className={`text-xs text-right text-black ${index === array.length - 1 ? 'pr-4' : ''}`}>
          {row.getValue(key)}
        </div>
      ),
    }),
  ),
];
frontend/src/components/table/pollbook-deletions-columns.tsx
-----
import type { ColumnDef, Row } from "@tanstack/react-table";

export interface PollbookDeletionsData {
  eavsRegion: string;
  A12b: number;
  A12c: number;
  A12d: number;
  A12e: number;
  A12f: number;
  A12g: number;
  A12h: number;
  notes: string;
}

export const pollbookDeletionsColumns: ColumnDef<PollbookDeletionsData>[] = [
  {
    accessorKey: "eavsRegion",
    header: () => <div className="text-left">EAVS Region</div>,
    cell: ({ row }: { row: Row<PollbookDeletionsData> }) => (
      <div className="text-xs text-left text-black font-medium">
        {row.getValue("eavsRegion")}
      </div>
    ),
  },
  ...(["A12b", "A12c", "A12d", "A12e", "A12f", "A12g", "A12h"] as const).map(
    (key) => ({
      accessorKey: key,
      header: () => <div className="text-right">{key.toUpperCase()}</div>,
      cell: ({ row }: { row: Row<PollbookDeletionsData> }) => (
        <div className="text-xs text-right text-black">
          {(row.getValue(key) as number).toLocaleString()}
        </div>
      ),
    }),
  ),
  {
    accessorKey: "notes",
    header: () => <div className="text-left">Notes</div>,
    cell: ({ row }: { row: Row<PollbookDeletionsData> }) => (
      <div className="text-xs text-left text-black">
        {row.getValue("notes")}
      </div>
    ),
  },
];
frontend/src/components/table/opt-in-opt-out-columns.tsx
-----
import type { ColumnDef } from "@tanstack/react-table";

export type OptInOptOutRow = {
  metric: string;
  optInValue: string | number;
  optOutWithSameDayValue: string | number;
  optOutWithoutSameDayValue: string | number;
};

export const optInOptOutColumns: ColumnDef<OptInOptOutRow>[] = [
  {
    accessorKey: "metric",
    header: "Metric",
    cell: ({ row }) => (
      <div className="font-medium">{row.getValue("metric")}</div>
    ),
  },
  {
    accessorKey: "optInValue",
    header: "Opt-in State",
    cell: ({ row }) => <div>{row.getValue("optInValue")}</div>,
  },
  {
    accessorKey: "optOutWithSameDayValue",
    header: "Opt-out (Same-Day)",
    cell: ({ row }) => <div>{row.getValue("optOutWithSameDayValue")}</div>,
  },
  {
    accessorKey: "optOutWithoutSameDayValue",
    header: "Opt-out (No Same-Day)",
    cell: ({ row }) => <div>{row.getValue("optOutWithoutSameDayValue")}</div>,
  },
];
frontend/src/components/table/voting-equipment-table.tsx
-----
import {
  flexRender,
  getCoreRowModel,
  getPaginationRowModel,
  useReactTable,
  getSortedRowModel,
  type SortingState,
  type RowSelectionState,
} from "@tanstack/react-table";
import { useState } from "react";
import { Button } from "@/components/ui/button.tsx";
import {
  Table,
  TableBody,
  TableCell,
  TableHead,
  TableHeader,
  TableRow,
} from "@/components/ui/table.tsx";
import {
  votingEquipmentColumns,
  type VotingEquipment,
} from "./voting-equipment-columns.tsx";
import { VotingEquipmentBarChart } from "@/components/chart/voting-equipment-bar-chart.tsx";
import votingEquipmentByYearJson from "../../../data/votingEquipmentByYear.json" with { type: "json" };

interface VotingEquipmentTableProps {
  data: VotingEquipment[];
}

export function VotingEquipmentTable({ data }: VotingEquipmentTableProps) {
  const [sorting, setSorting] = useState<SortingState>([]);
  const [rowSelection, setRowSelection] = useState<RowSelectionState>({});

  const table = useReactTable({
    data,
    columns: votingEquipmentColumns,
    getCoreRowModel: getCoreRowModel(),
    getPaginationRowModel: getPaginationRowModel(),
    getSortedRowModel: getSortedRowModel(),
    onSortingChange: setSorting,
    onRowSelectionChange: setRowSelection,
    state: {
      sorting,
      rowSelection,
    },
    initialState: {
      pagination: {
        pageSize: 3, // Reduced from 5 to 3
      },
    },
    enableRowSelection: true,
    enableMultiRowSelection: false, // Only allow selecting one state at a time
  });

  // Get selected state
  const selectedRows = table.getSelectedRowModel().rows;
  const selectedState =
    selectedRows.length > 0 ? selectedRows[0].original : null;

  // Get equipment data by year for selected state
  const equipmentByYear =
    selectedState && selectedState.state in votingEquipmentByYearJson
      ? (
          votingEquipmentByYearJson as Record<
            string,
            Array<{
              year: number;
              dreNoVVPAT: number;
              dreWithVVPAT: number;
              ballotMarkingDevice: number;
              scanner: number;
            }>
          >
        )[selectedState.state]
      : [];

  return (
    <div className="flex flex-col h-full space-y-2">
      {/* Table Section */}
      <div className="flex flex-col space-y-1 flex-shrink-0">
        <div className="rounded-md border">
          <Table>
            <TableHeader className="bg-background">
              {table.getHeaderGroups().map((headerGroup) => (
                <TableRow key={headerGroup.id}>
                  {headerGroup.headers.map((header) => {
                    return (
                      <TableHead key={header.id} className="py-1 px-2">
                        {header.isPlaceholder
                          ? null
                          : flexRender(
                              header.column.columnDef.header,
                              header.getContext(),
                            )}
                      </TableHead>
                    );
                  })}
                </TableRow>
              ))}
            </TableHeader>
            <TableBody>
              {table.getRowModel().rows?.length ? (
                table.getRowModel().rows.map((row) => (
                  <TableRow
                    key={row.id}
                    data-state={row.getIsSelected() && "selected"}
                    className="h-7 cursor-pointer hover:bg-muted/50"
                    onClick={() => row.toggleSelected()}
                  >
                    {row.getVisibleCells().map((cell) => (
                      <TableCell key={cell.id} className="py-1 px-2">
                        {flexRender(
                          cell.column.columnDef.cell,
                          cell.getContext(),
                        )}
                      </TableCell>
                    ))}
                  </TableRow>
                ))
              ) : (
                <TableRow>
                  <TableCell
                    colSpan={votingEquipmentColumns.length}
                    className="h-12 text-center"
                  >
                    No results.
                  </TableCell>
                </TableRow>
              )}
            </TableBody>
          </Table>
        </div>
        <div className="flex items-center justify-between px-1 py-0.5">
          <div className="text-xs text-muted-foreground">
            Page {table.getState().pagination.pageIndex + 1} of{" "}
            {table.getPageCount()} | Total: {data.length} states
            {selectedState && (
              <span className="ml-2 font-semibold text-primary">
                | Selected: {selectedState.state}
              </span>
            )}
          </div>
          <div className="flex items-center space-x-2">
            <Button
              variant="outline"
              size="sm"
              onClick={() => table.previousPage()}
              disabled={!table.getCanPreviousPage()}
            >
              Previous
            </Button>
            <Button
              variant="outline"
              size="sm"
              onClick={() => table.nextPage()}
              disabled={!table.getCanNextPage()}
            >
              Next
            </Button>
          </div>
        </div>
      </div>

      {/* Bar Charts Section - Only shown when a state is selected */}
      {selectedState && equipmentByYear.length > 0 && (
        <div className="flex-shrink-0 border-t pt-2">
          <VotingEquipmentBarChart
            stateName={selectedState.state}
            data={equipmentByYear}
          />
        </div>
      )}

      {/* Message when state has no data */}
      {selectedState && equipmentByYear.length === 0 && (
        <div className="flex items-center justify-center border-t pt-2 h-16">
          <p className="text-xs text-muted-foreground">
            No historical equipment data available for {selectedState.state}.
          </p>
        </div>
      )}

      {/* Instruction message when no state selected */}
      {!selectedState && (
        <div className="flex items-center justify-center h-16">
          <p className="text-xs text-muted-foreground">
            Click on a state to view equipment trends from 2016-2024
          </p>
        </div>
      )}
    </div>
  );
}
frontend/src/components/table/active-voters-table.tsx
-----
"use client";

import { DataTable } from "./data-table";
import {
  activeVotersColumns,
  type ActiveVotersData,
} from "./active-voters-columns";

interface ActiveVotersTableProps {
  data: ActiveVotersData[];
}

export function ActiveVotersTable({ data }: ActiveVotersTableProps) {
  return (
    <div className="space-y-2">
      <div className="text-xs">
        <DataTable columns={activeVotersColumns} data={data} />
      </div>
    </div>
  );
}
frontend/src/components/table/state-comparison-table.tsx
-----
import {
  flexRender,
  getCoreRowModel,
  getPaginationRowModel,
  useReactTable,
} from "@tanstack/react-table";
import { Button } from "@/components/ui/button.tsx";
import {
  Table,
  TableBody,
  TableCell,
  TableHead,
  TableHeader,
  TableRow,
} from "@/components/ui/table.tsx";
import {
  stateComparisonColumns,
  type StateComparisonRow,
} from "./state-comparison-columns.tsx";

interface StateComparisonTableProps {
  data: StateComparisonRow[];
  republicanState: string;
  democraticState: string;
}

export function StateComparisonTable({
  data,
  republicanState,
  democraticState,
}: StateComparisonTableProps) {
  // Update column headers with state names
  const updatedColumns = stateComparisonColumns.map((col, idx) => {
    if (idx === 1) {
      return { ...col, header: `${republicanState} (R)` };
    }
    if (idx === 2) {
      return { ...col, header: `${democraticState} (D)` };
    }
    return col;
  });

  const table = useReactTable({
    data,
    columns: updatedColumns,
    getCoreRowModel: getCoreRowModel(),
    getPaginationRowModel: getPaginationRowModel(),
    initialState: {
      pagination: {
        pageSize: 7,
      },
    },
  });

  return (
    <div className="flex flex-col h-full space-y-2">
      <div className="flex-1 min-h-0 rounded-md border overflow-auto">
        <Table>
          <TableHeader className="sticky top-0 bg-background z-10">
            {table.getHeaderGroups().map((headerGroup) => (
              <TableRow key={headerGroup.id}>
                {headerGroup.headers.map((header) => {
                  return (
                    <TableHead key={header.id} className="py-2">
                      {header.isPlaceholder
                        ? null
                        : flexRender(
                            header.column.columnDef.header,
                            header.getContext(),
                          )}
                    </TableHead>
                  );
                })}
              </TableRow>
            ))}
          </TableHeader>
          <TableBody>
            {table.getRowModel().rows?.length ? (
              table.getRowModel().rows.map((row) => (
                <TableRow
                  key={row.id}
                  data-state={row.getIsSelected() && "selected"}
                  className="h-10"
                >
                  {row.getVisibleCells().map((cell) => (
                    <TableCell key={cell.id} className="py-2">
                      {flexRender(
                        cell.column.columnDef.cell,
                        cell.getContext(),
                      )}
                    </TableCell>
                  ))}
                </TableRow>
              ))
            ) : (
              <TableRow>
                <TableCell
                  colSpan={stateComparisonColumns.length}
                  className="h-24 text-center"
                >
                  No results.
                </TableCell>
              </TableRow>
            )}
          </TableBody>
        </Table>
      </div>
      <div className="flex-shrink-0 flex items-center justify-between px-2 py-1">
        <div className="text-sm text-muted-foreground">
          Page {table.getState().pagination.pageIndex + 1} of{" "}
          {table.getPageCount()} | Total: {data.length} metrics
        </div>
        <div className="flex items-center space-x-2">
          <Button
            variant="outline"
            size="sm"
            onClick={() => table.previousPage()}
            disabled={!table.getCanPreviousPage()}
          >
            Previous
          </Button>
          <Button
            variant="outline"
            size="sm"
            onClick={() => table.nextPage()}
            disabled={!table.getCanNextPage()}
          >
            Next
          </Button>
        </div>
      </div>
    </div>
  );
}
frontend/src/components/table/mail-ballots-rejected-table.tsx
-----
"use client";

import { DataTable } from "./data-table";
import {
  mailBallotsRejectedColumns,
  type MailBallotsRejectedData,
} from "./mail-ballots-rejected-columns";

interface MailBallotsRejectedTableProps {
  data: MailBallotsRejectedData[];
}

export function MailBallotsRejectedTable({
  data,
}: MailBallotsRejectedTableProps) {
  return (
    <div className="space-y-2">
      <div className="text-xs">
        <DataTable columns={mailBallotsRejectedColumns} data={data} />
      </div>
    </div>
  );
}
frontend/src/components/table/pollbook-deletions-table.tsx
-----
"use client";

import { DataTable } from "./data-table";
import {
  pollbookDeletionsColumns,
  type PollbookDeletionsData,
} from "./pollbook-deletions-columns";

interface PollbookDeletionsTableProps {
  data: PollbookDeletionsData[];
}

export function PollbookDeletionsTable({ data }: PollbookDeletionsTableProps) {
  return (
    <div className="space-y-2">
      <div className="text-xs">
        <DataTable columns={pollbookDeletionsColumns} data={data} />
      </div>
    </div>
  );
}
frontend/src/components/table/early-voting-table.tsx
-----
import {
  flexRender,
  getCoreRowModel,
  getPaginationRowModel,
  useReactTable,
} from "@tanstack/react-table";
import { Button } from "@/components/ui/button.tsx";
import {
  Table,
  TableBody,
  TableCell,
  TableHead,
  TableHeader,
  TableRow,
} from "@/components/ui/table.tsx";
import {
  earlyVotingColumns,
  type EarlyVotingRow,
} from "./early-voting-columns.tsx";

interface EarlyVotingTableProps {
  data: EarlyVotingRow[];
  republicanState: string;
  democraticState: string;
}

export function EarlyVotingTable({
  data,
  republicanState,
  democraticState,
}: EarlyVotingTableProps) {
  // Update column headers with state names
  const updatedColumns = earlyVotingColumns.map((col, idx) => {
    if (idx === 1) {
      return { ...col, header: `${republicanState} (R)` };
    }
    if (idx === 2) {
      return { ...col, header: `${democraticState} (D)` };
    }
    return col;
  });

  const table = useReactTable({
    data,
    columns: updatedColumns,
    getCoreRowModel: getCoreRowModel(),
    getPaginationRowModel: getPaginationRowModel(),
    initialState: {
      pagination: {
        pageSize: 10,
      },
    },
  });

  return (
    <div className="flex flex-col h-full space-y-2">
      <div className="flex-1 min-h-0 rounded-md border overflow-auto">
        <Table>
          <TableHeader className="sticky top-0 bg-background z-10">
            {table.getHeaderGroups().map((headerGroup) => (
              <TableRow key={headerGroup.id}>
                {headerGroup.headers.map((header) => {
                  return (
                    <TableHead key={header.id} className="py-2">
                      {header.isPlaceholder
                        ? null
                        : flexRender(
                            header.column.columnDef.header,
                            header.getContext(),
                          )}
                    </TableHead>
                  );
                })}
              </TableRow>
            ))}
          </TableHeader>
          <TableBody>
            {table.getRowModel().rows?.length ? (
              table.getRowModel().rows.map((row) => (
                <TableRow
                  key={row.id}
                  data-state={row.getIsSelected() && "selected"}
                  className="h-10"
                >
                  {row.getVisibleCells().map((cell) => (
                    <TableCell key={cell.id} className="py-2">
                      {flexRender(
                        cell.column.columnDef.cell,
                        cell.getContext(),
                      )}
                    </TableCell>
                  ))}
                </TableRow>
              ))
            ) : (
              <TableRow>
                <TableCell
                  colSpan={earlyVotingColumns.length}
                  className="h-24 text-center"
                >
                  No results.
                </TableCell>
              </TableRow>
            )}
          </TableBody>
        </Table>
      </div>
      <div className="flex items-center justify-end space-x-2 py-2">
        <div className="flex-1 text-sm text-muted-foreground">
          Page {table.getState().pagination.pageIndex + 1} of{" "}
          {table.getPageCount()}
        </div>
        <div className="space-x-2">
          <Button
            variant="outline"
            size="sm"
            onClick={() => table.previousPage()}
            disabled={!table.getCanPreviousPage()}
          >
            Previous
          </Button>
          <Button
            variant="outline"
            size="sm"
            onClick={() => table.nextPage()}
            disabled={!table.getCanNextPage()}
          >
            Next
          </Button>
        </div>
      </div>
    </div>
  );
}
frontend/src/components/table/voter-registration-columns.tsx
-----
"use client";

import type { ColumnDef } from "@tanstack/react-table";

export type EAVSRegionVoterData = {
  eavsRegion: string;
  totalRegisteredVoters: number;
  democraticVoters: number;
  republicanVoters: number;
  unaffiliatedVoters: number;
  otherPartyVoters: number;
  registrationRate: number;
  activeVoters: number;
  inactiveVoters: number;
};

export const voterRegistrationColumns: ColumnDef<EAVSRegionVoterData>[] = [
  {
    accessorKey: "eavsRegion",
    header: "County",
    cell: ({ row }) => (
      <div className="font-medium text-xs">{row.getValue("eavsRegion")}</div>
    ),
  },
  {
    accessorKey: "totalRegisteredVoters",
    header: () => <div className="text-right">Total</div>,
    cell: ({ row }) => {
      const amount = parseFloat(row.getValue("totalRegisteredVoters"));
      return (
        <div className="text-right text-xs">{amount.toLocaleString()}</div>
      );
    },
  },
  {
    accessorKey: "democraticVoters",
    header: () => <div className="text-right">Dem</div>,
    cell: ({ row }) => {
      const amount = parseFloat(row.getValue("democraticVoters"));
      const total = parseFloat(row.getValue("totalRegisteredVoters"));
      const percentage = ((amount / total) * 100).toFixed(0);
      return (
        <div className="text-right text-xs">
          <div>{amount.toLocaleString()}</div>
          <div className="text-gray-500">({percentage}%)</div>
        </div>
      );
    },
  },
  {
    accessorKey: "republicanVoters",
    header: () => <div className="text-right">Rep</div>,
    cell: ({ row }) => {
      const amount = parseFloat(row.getValue("republicanVoters"));
      const total = parseFloat(row.getValue("totalRegisteredVoters"));
      const percentage = ((amount / total) * 100).toFixed(0);
      return (
        <div className="text-right text-xs">
          <div>{amount.toLocaleString()}</div>
          <div className="text-gray-500">({percentage}%)</div>
        </div>
      );
    },
  },
  {
    accessorKey: "unaffiliatedVoters",
    header: () => <div className="text-right">Unaffiliated</div>,
    cell: ({ row }) => {
      const amount = parseFloat(row.getValue("unaffiliatedVoters"));
      const total = parseFloat(row.getValue("totalRegisteredVoters"));
      const percentage = ((amount / total) * 100).toFixed(0);
      return (
        <div className="text-right text-xs">
          <div>{amount.toLocaleString()}</div>
          <div className="text-gray-500">({percentage}%)</div>
        </div>
      );
    },
  },
  {
    accessorKey: "registrationRate",
    header: () => <div className="text-right">Rate</div>,
    cell: ({ row }) => {
      const rate = parseFloat(row.getValue("registrationRate"));
      return <div className="text-right text-xs">{rate}%</div>;
    },
  },
];
frontend/src/components/header.tsx
-----
import { Link } from "@tanstack/react-router";
import capitolIcon from "@/assets/united-states-capitol-3-svgrepo-com.svg";

export default function Header() {
  return (
    <header className="w-full text-white shadow-lg relative z-50 bg-slate-900 border-b border-slate-700">
      {/* Purple top bar */}
      <div
        className="w-full h-1"
        style={{
          background:
            "linear-gradient(to right, oklch(0.606 0.25 292.717), oklch(0.506 0.25 292.717))",
        }}
      />

      <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div className="flex justify-between items-center h-16">
          <div className="flex items-center space-x-4">
            <Link
              to="/"
              className="flex items-center space-x-5 hover:opacity-90 transition-opacity"
            >
              <div
                className="w-8 h-8 rounded-md flex items-center justify-center"
                style={{
                  background:
                    "linear-gradient(to right, oklch(0.606 0.25 292.717), oklch(0.506 0.25 292.717))",
                }}
              >
                <img
                  src={capitolIcon}
                  alt="US Capitol"
                  className="w-6 h-6"
                  style={{
                    filter: "brightness(0) saturate(100%) invert(100%)",
                  }}
                />
              </div>
              <div>
                <h1 className="text-xl font-bold tracking-tight">
                  US Election Analyzer
                </h1>
                <p className="text-xs opacity-70 -mt-0.5">
                  Data-Driven Election Insights
                </p>
              </div>
            </Link>
          </div>
          <div className="text-xl font-bold px-3 py-1 rounded-full text-white">
            Team Lakers
          </div>
        </div>
      </div>
    </header>
  );
}
frontend/src/components/equipment/equipment-cards-base.tsx
-----
import { type ReactNode, useState } from "react";
import { Button } from "@/components/ui/button";
import { Card } from "@/components/ui/card";

// Base equipment interface with common fields
export interface BaseEquipment {
  quantity: number;
  age: number;
  operatingSystem: string;
  certification: string;
  scanRate: number;
  errorRate: number;
  reliability: number;
}

// Equipment Summary type (used for general equipment analysis)
export interface EquipmentSummary extends BaseEquipment {
  provider: string;
  model: string;
  qualityMeasure: string;
}

interface StatCard {
  label: string;
  value: string | number;
  className?: string;
}

interface EquipmentCardsBaseProps<T extends BaseEquipment> {
  data: T[];
  itemsPerPage: number;
  renderCard: (item: T, idx: number) => ReactNode;
  statsCards: StatCard[];
  footer?: ReactNode;
}

export function EquipmentCardsBase<T extends BaseEquipment>({
  data,
  itemsPerPage,
  renderCard,
  statsCards,
  footer,
}: EquipmentCardsBaseProps<T>) {
  const [currentPage, setCurrentPage] = useState(1);

  // Pagination
  const totalPages = Math.ceil(data.length / itemsPerPage);
  const startIndex = (currentPage - 1) * itemsPerPage;
  const endIndex = startIndex + itemsPerPage;
  const paginatedData = data.slice(startIndex, endIndex);

  return (
    <div className="flex flex-col h-full space-y-3">
      {/* Stats Summary */}
      <div className="flex-shrink-0 grid grid-cols-4 gap-2">
        {statsCards.map((stat, idx) => (
          <Card key={idx} className="p-3">
            <div className="text-xs text-muted-foreground">{stat.label}</div>
            <div className={`text-2xl font-bold ${stat.className || ""}`}>
              {stat.value}
            </div>
          </Card>
        ))}
      </div>

      {/* Equipment Cards */}
      <div className="flex-1 min-h-0 overflow-y-auto space-y-3 pr-2">
        <div className="grid grid-cols-2 gap-2">
          {paginatedData.map((item, idx) => renderCard(item, idx))}
        </div>
      </div>

      {/* Pagination Controls */}
      <div className="flex-shrink-0 flex items-center justify-between px-2 py-1">
        <div className="text-xs text-muted-foreground">
          Page {currentPage} of {totalPages} | Showing {startIndex + 1}-
          {Math.min(endIndex, data.length)} of {data.length}
        </div>
        <div className="flex items-center space-x-2">
          <Button
            variant="outline"
            size="sm"
            onClick={() => setCurrentPage((prev) => Math.max(1, prev - 1))}
            disabled={currentPage === 1}
          >
            Previous
          </Button>
          <Button
            variant="outline"
            size="sm"
            onClick={() =>
              setCurrentPage((prev) => Math.min(totalPages, prev + 1))
            }
            disabled={currentPage === totalPages}
          >
            Next
          </Button>
        </div>
      </div>

      {/* Optional Footer */}
      {footer}
    </div>
  );
}
frontend/src/components/equipment/state-equipment-summary-cards.tsx
-----
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card";
import { Badge } from "@/components/ui/badge";
import { EquipmentCardsBase, type BaseEquipment } from "./equipment-cards-base";
import { getCertificationBadge } from "./equipment-helpers";

export type StateEquipmentSummary = BaseEquipment & {
  make: string;
  model: string;
  equipmentType: string;
  description: string;
  discontinued: boolean;
};

interface StateEquipmentSummaryCardsProps {
  data: StateEquipmentSummary[];
}

export function StateEquipmentSummaryCards({
  data,
}: StateEquipmentSummaryCardsProps) {
  const statsCards = [
    { label: "Total Devices", value: data.length },
    {
      label: "Total Quantity",
      value: data.reduce((sum, d) => sum + d.quantity, 0).toLocaleString(),
    },
    {
      label: "Avg Age",
      value: `${(
        data.reduce((sum, d) => sum + d.age, 0) / data.length || 0
      ).toFixed(1)}y`,
    },
    {
      label: "Discontinued",
      value: data.filter((d) => d.discontinued).length,
      className: "text-red-600",
    },
  ];

  const renderCard = (item: StateEquipmentSummary, idx: number) => (
    <Card
      key={`${item.make}-${item.model}-${idx}`}
      className={`${item.discontinued ? "border-red-300 bg-red-50/30" : ""}`}
    >
      <CardHeader className="pb-2 pt-2 px-3">
        <CardTitle className="text-sm flex items-start justify-between">
          <div className="flex-1">
            <div className="text-xs text-muted-foreground mb-0.5">
              {item.make}
            </div>
            <div
              className={`font-semibold ${
                item.discontinued ? "text-red-600" : ""
              }`}
            >
              {item.model}
            </div>
            <div className="text-xs font-normal text-muted-foreground mt-0.5">
              {item.equipmentType}
            </div>
          </div>
          <Badge variant="secondary" className="ml-2 text-xs shrink-0">
            Quantity: {item.quantity.toLocaleString()}
          </Badge>
        </CardTitle>
      </CardHeader>
      <CardContent className="px-3 pb-2 space-y-1.5">
        <p
          className="text-xs text-gray-600 line-clamp-2"
          title={item.description}
        >
          {item.description}
        </p>
        <div className="flex items-center justify-between text-xs">
          <div className="flex items-center gap-1">
            <span className="text-muted-foreground">OS:</span>{" "}
            <span
              className="font-medium truncate max-w-[120px]"
              title={item.operatingSystem}
            >
              {item.operatingSystem}
            </span>
          </div>
          <div className="flex items-center gap-1 shrink-0">
            <span className="text-muted-foreground">Age:</span>{" "}
            <span className="font-medium">{item.age}y</span>
          </div>
        </div>
        <div className="flex items-center justify-between">
          {getCertificationBadge(item.certification)}
        </div>
        <div className="grid grid-cols-3 gap-2 pt-1 border-t text-xs">
          <div className="text-center">
            <div className="text-muted-foreground text-[10px]">Scan Rate</div>
            <div className="font-semibold">{item.scanRate.toFixed(1)}%</div>
          </div>
          <div className="text-center">
            <div className="text-muted-foreground text-[10px]">Error Rate</div>
            <div className="font-semibold">{item.errorRate.toFixed(2)}%</div>
          </div>
          <div className="text-center">
            <div className="text-muted-foreground text-[10px]">Reliability</div>
            <div className="font-semibold">{item.reliability.toFixed(1)}%</div>
          </div>
        </div>
      </CardContent>
    </Card>
  );

  const footer = (
    <div className="flex-shrink-0 px-2 py-2 bg-red-50 border border-red-200 rounded-md flex items-center gap-2">
      <div className="flex-shrink-0 w-4 h-4 rounded-full bg-red-100 flex items-center justify-center">
        <span className="text-red-600 text-xs font-bold">!</span>
      </div>
      <div className="text-xs text-red-800">
        <span className="font-semibold">Red text/border</span> indicates devices
        no longer available from the manufacturer
      </div>
    </div>
  );

  return (
    <EquipmentCardsBase
      data={data}
      itemsPerPage={4}
      renderCard={renderCard}
      statsCards={statsCards}
      footer={footer}
    />
  );
}
frontend/src/components/equipment/equipment-helpers.tsx
-----
import { Badge } from "@/components/ui/badge";

export function getCertificationBadge(cert: string) {
  const variants: Record<string, { label: string }> = {
    "VVSG 2.0 Certified": {
      label: "VVSG 2.0 ‚úì",
    },
    "VVSG 2.0 Applied": {
      label: "VVSG 2.0 ‚ãØ",
    },
    "VVSG 1.1 Certified": {
      label: "VVSG 1.1 ‚úì",
    },
    "VVSG 1.0 Certified": {
      label: "VVSG 1.0 ‚úì",
    },
    "Not Certified": {
      label: "None",
    },
  };
  const config = variants[cert] || variants["Not Certified"];
  return (
    <Badge variant="outline" className="text-xs">
      {config.label}
    </Badge>
  );
}

export function getReliabilityColor(reliability: number) {
  if (reliability >= 99) return "text-green-700";
  if (reliability >= 98) return "text-amber-700";
  return "text-orange-700";
}

export function getQualityBadge(quality: string) {
  const variants: Record<string, string> = {
    High: "bg-green-100 text-green-800 border-green-300",
    Medium: "bg-amber-100 text-amber-800 border-amber-300",
    Low: "bg-red-100 text-red-800 border-red-300",
  };
  return (
    <Badge
      variant="outline"
      className={`${variants[quality] || variants["Medium"]} text-xs`}
    >
      {quality}
    </Badge>
  );
}
frontend/src/components/equipment/equipment-summary-cards.tsx
-----
import {
  Card,
  CardContent,
  CardHeader,
  CardTitle,
} from "@/components/ui/card.tsx";
import { Badge } from "@/components/ui/badge.tsx";
import {
  EquipmentCardsBase,
  type EquipmentSummary,
} from "@/components/equipment/equipment-cards-base.tsx";
import { getCertificationBadge } from "@/components/equipment/equipment-helpers.tsx";

interface EquipmentSummaryTableProps {
  data: EquipmentSummary[];
}

export function EquipmentSummaryCards({ data }: EquipmentSummaryTableProps) {
  const statsCards = [
    { label: "Total Devices", value: data.length },
    {
      label: "Total Quantity",
      value: data.reduce((sum, d) => sum + d.quantity, 0).toLocaleString(),
    },
    {
      label: "Avg Age",
      value: `${(data.reduce((sum, d) => sum + d.age, 0) / data.length || 0).toFixed(1)}y`,
    },
    {
      label: "Avg Reliability",
      value: `${(data.reduce((sum, d) => sum + d.reliability, 0) / data.length || 0).toFixed(1)}%`,
    },
  ];

  const renderCard = (item: EquipmentSummary, idx: number) => (
    <Card key={`${item.provider}-${item.model}-${idx}`}>
      <CardHeader className="pb-2 pt-2 px-3">
        <CardTitle className="text-sm flex items-start justify-between">
          <div className="flex-1">
            <div className="text-xs text-muted-foreground mb-0.5">
              {item.provider}
            </div>
            <div className="font-semibold">{item.model}</div>
            <div className="text-xs font-normal text-muted-foreground mt-0.5">
              Quality: {item.qualityMeasure}
            </div>
          </div>
          <Badge variant="secondary" className="ml-2 text-xs shrink-0">
            Quantity: {item.quantity.toLocaleString()}
          </Badge>
        </CardTitle>
      </CardHeader>
      <CardContent className="px-3 pb-2 space-y-1.5">
        <div className="flex items-center justify-between text-xs">
          <div className="flex items-center gap-1">
            <span className="text-muted-foreground">OS:</span>{" "}
            <span
              className="font-medium truncate max-w-[120px]"
              title={item.operatingSystem}
            >
              {item.operatingSystem}
            </span>
          </div>
          <div className="flex items-center gap-1 shrink-0">
            <span className="text-muted-foreground">Age:</span>{" "}
            <span className="font-medium">{item.age}y</span>
          </div>
        </div>
        <div className="flex items-center justify-between">
          {getCertificationBadge(item.certification)}
          Quality: {item.qualityMeasure}
        </div>
        <div className="grid grid-cols-3 gap-2 pt-1 border-t text-xs">
          <div className="text-center">
            <div className="text-muted-foreground text-[10px]">Scan Rate</div>
            <div className="font-semibold">{item.scanRate.toFixed(1)}%</div>
          </div>
          <div className="text-center">
            <div className="text-muted-foreground text-[10px]">Error Rate</div>
            <div className="font-semibold">{item.errorRate.toFixed(2)}%</div>
          </div>
          <div className="text-center">
            <div className="text-muted-foreground text-[10px]">Reliability</div>
            <div className="font-semibold">{item.reliability.toFixed(1)}%</div>
          </div>
        </div>
      </CardContent>
    </Card>
  );

  return (
    <EquipmentCardsBase
      data={data}
      itemsPerPage={4}
      renderCard={renderCard}
      statsCards={statsCards}
    />
  );
}
frontend/src/vite-env.d.ts
-----
/// <reference types="vite/client" />
frontend/src/hooks/use-mobile.ts
-----
import * as React from "react";

const MOBILE_BREAKPOINT = 768;

export function useIsMobile() {
  const [isMobile, setIsMobile] = React.useState<boolean | undefined>(
    undefined,
  );

  React.useEffect(() => {
    const mql = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT - 1}px)`);
    const onChange = () => {
      setIsMobile(window.innerWidth < MOBILE_BREAKPOINT);
    };
    mql.addEventListener("change", onChange);
    setIsMobile(window.innerWidth < MOBILE_BREAKPOINT);
    return () => mql.removeEventListener("change", onChange);
  }, []);

  return !!isMobile;
}
frontend/src/routeTree.gen.ts
-----
/* eslint-disable */

// @ts-nocheck

// noinspection JSUnusedGlobalSymbols

// This file was automatically generated by TanStack Router.
// You should NOT make any changes in this file as it will be overwritten.
// Additionally, you should also exclude this file from your linter and/or formatter to prevent it from being checked or modified.

import { Route as rootRouteImport } from './routes/__root'
import { Route as IndexRouteImport } from './routes/index'
import { Route as StateStateNameRouteImport } from './routes/state/$stateName'

const IndexRoute = IndexRouteImport.update({
  id: '/',
  path: '/',
  getParentRoute: () => rootRouteImport,
} as any)
const StateStateNameRoute = StateStateNameRouteImport.update({
  id: '/state/$stateName',
  path: '/state/$stateName',
  getParentRoute: () => rootRouteImport,
} as any)

export interface FileRoutesByFullPath {
  '/': typeof IndexRoute
  '/state/$stateName': typeof StateStateNameRoute
}
export interface FileRoutesByTo {
  '/': typeof IndexRoute
  '/state/$stateName': typeof StateStateNameRoute
}
export interface FileRoutesById {
  __root__: typeof rootRouteImport
  '/': typeof IndexRoute
  '/state/$stateName': typeof StateStateNameRoute
}
export interface FileRouteTypes {
  fileRoutesByFullPath: FileRoutesByFullPath
  fullPaths: '/' | '/state/$stateName'
  fileRoutesByTo: FileRoutesByTo
  to: '/' | '/state/$stateName'
  id: '__root__' | '/' | '/state/$stateName'
  fileRoutesById: FileRoutesById
}
export interface RootRouteChildren {
  IndexRoute: typeof IndexRoute
  StateStateNameRoute: typeof StateStateNameRoute
}

declare module '@tanstack/react-router' {
  interface FileRoutesByPath {
    '/': {
      id: '/'
      path: '/'
      fullPath: '/'
      preLoaderRoute: typeof IndexRouteImport
      parentRoute: typeof rootRouteImport
    }
    '/state/$stateName': {
      id: '/state/$stateName'
      path: '/state/$stateName'
      fullPath: '/state/$stateName'
      preLoaderRoute: typeof StateStateNameRouteImport
      parentRoute: typeof rootRouteImport
    }
  }
}

const rootRouteChildren: RootRouteChildren = {
  IndexRoute: IndexRoute,
  StateStateNameRoute: StateStateNameRoute,
}
export const routeTree = rootRouteImport
  ._addFileChildren(rootRouteChildren)
  ._addFileTypes<FileRouteTypes>()
frontend/src/lib/colors.ts
-----
// Color utility functions for choropleth maps

export interface ColorScale {
  colors: string[];
  breaks: number[];
}

// Default gray tint function
export const defaultGrayTint = () => "rgba(220,220,220,0.36)";

// Default color scale for density data
export const defaultDensityScale: ColorScale = {
  colors: [
    "#f7fcf5",
    "#e5f5e0",
    "#c7e9c0",
    "#a1d99b",
    "#74c476",
    "#41ab5d",
    "#238b45",
    "#005a32",
  ],
  breaks: [0, 10, 20, 50, 100, 200, 500, 1000],
};

// Red color scale for Republican-leaning data
export const republicanScale: ColorScale = {
  colors: [
    "#fff5f0",
    "#fee0d2",
    "#fcbba1",
    "#fc9272",
    "#fb6a4a",
    "#ef3b2c",
    "#cb181d",
    "#99000d",
  ],
  breaks: [0, 10, 20, 30, 40, 50, 60, 70],
};

// Blue color scale for Democratic-leaning data
export const democraticScale: ColorScale = {
  colors: [
    "#f7fbff",
    "#deebf7",
    "#c6dbef",
    "#9ecae1",
    "#6baed6",
    "#4292c6",
    "#2171b5",
    "#08519c",
  ],
  breaks: [0, 10, 20, 30, 40, 50, 60, 70],
};

// Equipment age color scale (yellow to red, older = redder)
export const equipmentAgeScale: ColorScale = {
  colors: [
    "#ffffcc",
    "#ffeda0",
    "#fed976",
    "#feb24c",
    "#fd8d3c",
    "#fc4e2a",
    "#e31a1c",
    "#b10026",
  ],
  breaks: [0, 2, 4, 6, 8, 10, 12, 15],
};

// Provisional ballots color scale (light to dark purple)
export const provisionalBallotsScale: ColorScale = {
  colors: [
    "#fcfbfd",
    "#efedf5",
    "#dadaeb",
    "#bcbddc",
    "#9e9ac8",
    "#807dba",
    "#6a51a3",
    "#4a1486",
  ],
  breaks: [0, 0.5, 1.0, 1.5, 2.0, 3.0, 4.0, 5.0],
};

// Active voters color scale (light to dark green)
export const activeVotersScale: ColorScale = {
  colors: [
    "#f7fcf5",
    "#e5f5e0",
    "#c7e9c0",
    "#a1d99b",
    "#74c476",
    "#41ab5d",
    "#238b45",
    "#005a32",
  ],
  breaks: [85, 87, 89, 91, 93, 95, 97, 98],
};

// Pollbook deletions color scale (light to dark orange)
export const pollbookDeletionsScale: ColorScale = {
  colors: [
    "#fff5eb",
    "#fee6ce",
    "#fdd0a2",
    "#fdae6b",
    "#fd8d3c",
    "#f16913",
    "#d94801",
    "#8c2d04",
  ],
  breaks: [0, 1, 2, 3, 4, 5, 6, 8],
};

// Mail ballots rejected color scale (light to dark red)
export const mailBallotsRejectedScale: ColorScale = {
  colors: [
    "#fff5f0",
    "#fee0d2",
    "#fcbba1",
    "#fc9272",
    "#fb6a4a",
    "#ef3b2c",
    "#cb181d",
    "#99000d",
  ],
  breaks: [0, 0.5, 1.0, 2.0, 3.0, 4.0, 5.0, 6.0],
};

// Voter registration color scale (light to dark blue)
export const voterRegistrationScale: ColorScale = {
  colors: [
    "#f7fbff",
    "#deebf7",
    "#c6dbef",
    "#9ecae1",
    "#6baed6",
    "#4292c6",
    "#2171b5",
    "#08519c",
  ],
  breaks: [50, 55, 60, 65, 70, 75, 80, 85],
};

// Voting equipment type colors (high contrast colors)
export const VOTING_EQUIPMENT_COLORS = {
  dre_no_vvpat: "#e41a1c", // Red
  dre_with_vvpat: "#ff7f00", // Orange
  ballot_marking_device: "#4daf4a", // Green
  scanner: "#377eb8", // Blue
  mixed: "#984ea3", // Purple (for multiple types)
} as const;

export type VotingEquipmentType =
  | "dre_no_vvpat"
  | "dre_with_vvpat"
  | "ballot_marking_device"
  | "scanner"
  | "mixed";

// Generic function to get color based on value and color scale
export function getColorFromScale(value: number, scale: ColorScale): string {
  for (let i = 0; i < scale.breaks.length; i++) {
    if (value <= scale.breaks[i]) {
      return scale.colors[i];
    }
  }
  return scale.colors[scale.colors.length - 1];
}

export function getDensityColor(density: number): string {
  return getColorFromScale(density, defaultDensityScale);
}

export function getRepublicanColor(percentage: number): string {
  return getColorFromScale(percentage, republicanScale);
}

export function getDemocraticColor(percentage: number): string {
  return getColorFromScale(percentage, democraticScale);
}

export function getEquipmentAgeColor(age: number): string {
  return getColorFromScale(age, equipmentAgeScale);
}

export function getProvisionalBallotsColor(percentage: number): string {
  return getColorFromScale(percentage, provisionalBallotsScale);
}

export function getActiveVotersColor(percentage: number): string {
  return getColorFromScale(percentage, activeVotersScale);
}

export function getPollbookDeletionsColor(percentage: number): string {
  return getColorFromScale(percentage, pollbookDeletionsScale);
}

export function getMailBallotsRejectedColor(percentage: number): string {
  return getColorFromScale(percentage, mailBallotsRejectedScale);
}

export function getVoterRegistrationColor(percentage: number): string {
  return getColorFromScale(percentage, voterRegistrationScale);
}

// Get voting equipment type color
export function getVotingEquipmentTypeColor(
  equipmentType: VotingEquipmentType,
): string {
  return (
    VOTING_EQUIPMENT_COLORS[equipmentType] || VOTING_EQUIPMENT_COLORS.mixed
  );
}

// Function to get political color based on which party has higher percentage
export function getPoliticalColor(
  republicanPct: number,
  democraticPct: number,
): string {
  if (republicanPct > democraticPct) {
    // Use Republican color scale based on the margin of victory
    const margin = republicanPct - democraticPct;
    return getRepublicanColor(Math.min(70, 40 + margin)); // Scale margin to color intensity
  } else {
    // Use Democratic color scale based on the margin of victory
    const margin = democraticPct - republicanPct;
    return getDemocraticColor(Math.min(70, 40 + margin)); // Scale margin to color intensity
  }
}
frontend/src/lib/early-voting-data.ts
-----
import earlyVotingDataJson from "../../data/earlyVotingComparison.json" with { type: "json" };
import type { EarlyVotingRow } from "@/components/table/early-voting-columns.tsx";

// Transform early voting data into table rows
const earlyVotingRaw = earlyVotingDataJson as {
  republicanState: {
    state: string;
    politicalDominance: string;
    totalVotesCast: number;
    earlyVotingCategories: {
      inPersonEarlyVoting: { votes: number; percentage: number };
      mailInAbsenteeVoting: { votes: number; percentage: number };
      dropBoxVoting: { votes: number; percentage: number };
      totalEarlyVoting: { votes: number; percentage: number };
    };
    electionDayVoting: { votes: number; percentage: number };
  };
  democraticState: {
    state: string;
    politicalDominance: string;
    totalVotesCast: number;
    earlyVotingCategories: {
      inPersonEarlyVoting: { votes: number; percentage: number };
      mailInAbsenteeVoting: { votes: number; percentage: number };
      dropBoxVoting: { votes: number; percentage: number };
      totalEarlyVoting: { votes: number; percentage: number };
    };
    electionDayVoting: { votes: number; percentage: number };
  };
};

export const earlyVotingData: EarlyVotingRow[] = [
  {
    metric: "State",
    republicanValue: earlyVotingRaw.republicanState.state,
    democraticValue: earlyVotingRaw.democraticState.state,
  },
  {
    metric: "Political Dominance",
    republicanValue: earlyVotingRaw.republicanState.politicalDominance,
    democraticValue: earlyVotingRaw.democraticState.politicalDominance,
  },
  {
    metric: "Total Votes Cast",
    republicanValue:
      earlyVotingRaw.republicanState.totalVotesCast.toLocaleString(),
    democraticValue:
      earlyVotingRaw.democraticState.totalVotesCast.toLocaleString(),
  },
  {
    metric: "In-Person Early Voting (Votes)",
    republicanValue:
      earlyVotingRaw.republicanState.earlyVotingCategories.inPersonEarlyVoting.votes.toLocaleString(),
    democraticValue:
      earlyVotingRaw.democraticState.earlyVotingCategories.inPersonEarlyVoting.votes.toLocaleString(),
  },
  {
    metric: "In-Person Early Voting (%)",
    republicanValue: `${earlyVotingRaw.republicanState.earlyVotingCategories.inPersonEarlyVoting.percentage}%`,
    democraticValue: `${earlyVotingRaw.democraticState.earlyVotingCategories.inPersonEarlyVoting.percentage}%`,
  },
  {
    metric: "Mail-In/Absentee Voting (Votes)",
    republicanValue:
      earlyVotingRaw.republicanState.earlyVotingCategories.mailInAbsenteeVoting.votes.toLocaleString(),
    democraticValue:
      earlyVotingRaw.democraticState.earlyVotingCategories.mailInAbsenteeVoting.votes.toLocaleString(),
  },
  {
    metric: "Mail-In/Absentee Voting (%)",
    republicanValue: `${earlyVotingRaw.republicanState.earlyVotingCategories.mailInAbsenteeVoting.percentage}%`,
    democraticValue: `${earlyVotingRaw.democraticState.earlyVotingCategories.mailInAbsenteeVoting.percentage}%`,
  },
  {
    metric: "Drop Box Voting (Votes)",
    republicanValue:
      earlyVotingRaw.republicanState.earlyVotingCategories.dropBoxVoting.votes.toLocaleString(),
    democraticValue:
      earlyVotingRaw.democraticState.earlyVotingCategories.dropBoxVoting.votes.toLocaleString(),
  },
  {
    metric: "Drop Box Voting (%)",
    republicanValue: `${earlyVotingRaw.republicanState.earlyVotingCategories.dropBoxVoting.percentage}%`,
    democraticValue: `${earlyVotingRaw.democraticState.earlyVotingCategories.dropBoxVoting.percentage}%`,
  },
  {
    metric: "Total Early Voting (Votes)",
    republicanValue:
      earlyVotingRaw.republicanState.earlyVotingCategories.totalEarlyVoting.votes.toLocaleString(),
    democraticValue:
      earlyVotingRaw.democraticState.earlyVotingCategories.totalEarlyVoting.votes.toLocaleString(),
  },
  {
    metric: "Total Early Voting (%)",
    republicanValue: `${earlyVotingRaw.republicanState.earlyVotingCategories.totalEarlyVoting.percentage}%`,
    democraticValue: `${earlyVotingRaw.democraticState.earlyVotingCategories.totalEarlyVoting.percentage}%`,
  },
  {
    metric: "Election Day Voting (Votes)",
    republicanValue:
      earlyVotingRaw.republicanState.electionDayVoting.votes.toLocaleString(),
    democraticValue:
      earlyVotingRaw.democraticState.electionDayVoting.votes.toLocaleString(),
  },
  {
    metric: "Election Day Voting (%)",
    republicanValue: `${earlyVotingRaw.republicanState.electionDayVoting.percentage}%`,
    democraticValue: `${earlyVotingRaw.democraticState.electionDayVoting.percentage}%`,
  },
];

export const earlyVotingRepublicanStateName =
  earlyVotingRaw.republicanState.state;
export const earlyVotingDemocraticStateName =
  earlyVotingRaw.democraticState.state;
frontend/src/lib/state-comparison-data.ts
-----
import stateComparisonDataJson from "../../data/stateComparison.json" with { type: "json" };
import type { StateComparisonRow } from "@/components/table/state-comparison-columns.tsx";

// Transform state comparison data into table rows
const stateComparisonRaw = stateComparisonDataJson as {
  republicanState: Record<string, string | number>;
  democraticState: Record<string, string | number>;
};

export const stateComparisonData: StateComparisonRow[] = [
  {
    metric: "State",
    republicanValue: stateComparisonRaw.republicanState.state,
    democraticValue: stateComparisonRaw.democraticState.state,
  },
  {
    metric: "Felony Voting Rights",
    republicanValue: stateComparisonRaw.republicanState.felonyVotingRights,
    democraticValue: stateComparisonRaw.democraticState.felonyVotingRights,
  },
  {
    metric: "Mail Ballot Percentage",
    republicanValue: `${stateComparisonRaw.republicanState.mailBallotPercentage}%`,
    democraticValue: `${stateComparisonRaw.democraticState.mailBallotPercentage}%`,
  },
  {
    metric: "Drop Box Ballot Percentage",
    republicanValue: `${stateComparisonRaw.republicanState.dropBoxBallotPercentage}%`,
    democraticValue: `${stateComparisonRaw.democraticState.dropBoxBallotPercentage}%`,
  },
  {
    metric: "Turnout",
    republicanValue: `${stateComparisonRaw.republicanState.turnout}%`,
    democraticValue: `${stateComparisonRaw.democraticState.turnout}%`,
  },
  {
    metric: "Registered Voters",
    republicanValue: (
      stateComparisonRaw.republicanState.registeredVoters as number
    ).toLocaleString(),
    democraticValue: (
      stateComparisonRaw.democraticState.registeredVoters as number
    ).toLocaleString(),
  },
  {
    metric: "Total Votes Cast",
    republicanValue: (
      stateComparisonRaw.republicanState.totalVotes as number
    ).toLocaleString(),
    democraticValue: (
      stateComparisonRaw.democraticState.totalVotes as number
    ).toLocaleString(),
  },
  {
    metric: "Early Voting Percentage",
    republicanValue: `${stateComparisonRaw.republicanState.earlyVotingPercentage}%`,
    democraticValue: `${stateComparisonRaw.democraticState.earlyVotingPercentage}%`,
  },
  {
    metric: "Same-Day Registration",
    republicanValue: stateComparisonRaw.republicanState.sameDayRegistration,
    democraticValue: stateComparisonRaw.democraticState.sameDayRegistration,
  },
  {
    metric: "Voter ID Required",
    republicanValue: stateComparisonRaw.republicanState.voterIdRequired,
    democraticValue: stateComparisonRaw.democraticState.voterIdRequired,
  },
  {
    metric: "Polls Open Time",
    republicanValue: stateComparisonRaw.republicanState.pollsOpenTime,
    democraticValue: stateComparisonRaw.democraticState.pollsOpenTime,
  },
  {
    metric: "Polls Close Time",
    republicanValue: stateComparisonRaw.republicanState.pollsCloseTime,
    democraticValue: stateComparisonRaw.democraticState.pollsCloseTime,
  },
  {
    metric: "Absentee Ballot Deadline",
    republicanValue: stateComparisonRaw.republicanState.absenteeBallotDeadline,
    democraticValue: stateComparisonRaw.democraticState.absenteeBallotDeadline,
  },
  {
    metric: "Provisional Ballots Cast",
    republicanValue: (
      stateComparisonRaw.republicanState.provisionalBallotsCast as number
    ).toLocaleString(),
    democraticValue: (
      stateComparisonRaw.democraticState.provisionalBallotsCast as number
    ).toLocaleString(),
  },
  {
    metric: "Rejected Ballots",
    republicanValue: (
      stateComparisonRaw.republicanState.rejectedBallots as number
    ).toLocaleString(),
    democraticValue: (
      stateComparisonRaw.democraticState.rejectedBallots as number
    ).toLocaleString(),
  },
  {
    metric: "Average Wait Time (minutes)",
    republicanValue: stateComparisonRaw.republicanState.averageWaitTime,
    democraticValue: stateComparisonRaw.democraticState.averageWaitTime,
  },
];

export const republicanStateName = stateComparisonRaw.republicanState
  .state as string;
export const democraticStateName = stateComparisonRaw.democraticState
  .state as string;
frontend/src/lib/opt-in-opt-out-data.ts
-----
import optInOptOutDataJson from "../../data/optInVsOptOutComparison.json" with { type: "json" };
import type { OptInOptOutRow } from "@/components/table/opt-in-opt-out-columns.tsx";

// Transform opt-in vs opt-out data into table rows
const optInOptOutRaw = optInOptOutDataJson as {
  optInState: Record<string, string | number>;
  optOutWithSameDay: Record<string, string | number>;
  optOutWithoutSameDay: Record<string, string | number>;
};

export const optInOptOutData: OptInOptOutRow[] = [
  {
    metric: "State",
    optInValue: optInOptOutRaw.optInState.state,
    optOutWithSameDayValue: optInOptOutRaw.optOutWithSameDay.state,
    optOutWithoutSameDayValue: optInOptOutRaw.optOutWithoutSameDay.state,
  },
  {
    metric: "Registration Type",
    optInValue: optInOptOutRaw.optInState.registrationType,
    optOutWithSameDayValue: optInOptOutRaw.optOutWithSameDay.registrationType,
    optOutWithoutSameDayValue:
      optInOptOutRaw.optOutWithoutSameDay.registrationType,
  },
  {
    metric: "Same-Day Registration",
    optInValue: optInOptOutRaw.optInState.sameDayRegistration,
    optOutWithSameDayValue:
      optInOptOutRaw.optOutWithSameDay.sameDayRegistration,
    optOutWithoutSameDayValue:
      optInOptOutRaw.optOutWithoutSameDay.sameDayRegistration,
  },
  {
    metric: "Eligible Voters",
    optInValue: (
      optInOptOutRaw.optInState.eligibleVoters as number
    ).toLocaleString(),
    optOutWithSameDayValue: (
      optInOptOutRaw.optOutWithSameDay.eligibleVoters as number
    ).toLocaleString(),
    optOutWithoutSameDayValue: (
      optInOptOutRaw.optOutWithoutSameDay.eligibleVoters as number
    ).toLocaleString(),
  },
  {
    metric: "Registered Voters",
    optInValue: (
      optInOptOutRaw.optInState.registeredVoters as number
    ).toLocaleString(),
    optOutWithSameDayValue: (
      optInOptOutRaw.optOutWithSameDay.registeredVoters as number
    ).toLocaleString(),
    optOutWithoutSameDayValue: (
      optInOptOutRaw.optOutWithoutSameDay.registeredVoters as number
    ).toLocaleString(),
  },
  {
    metric: "Registration Rate",
    optInValue: `${optInOptOutRaw.optInState.registrationRate}%`,
    optOutWithSameDayValue: `${optInOptOutRaw.optOutWithSameDay.registrationRate}%`,
    optOutWithoutSameDayValue: `${optInOptOutRaw.optOutWithoutSameDay.registrationRate}%`,
  },
  {
    metric: "Total Votes Cast",
    optInValue: (
      optInOptOutRaw.optInState.totalVotesCast as number
    ).toLocaleString(),
    optOutWithSameDayValue: (
      optInOptOutRaw.optOutWithSameDay.totalVotesCast as number
    ).toLocaleString(),
    optOutWithoutSameDayValue: (
      optInOptOutRaw.optOutWithoutSameDay.totalVotesCast as number
    ).toLocaleString(),
  },
  {
    metric: "Turnout Rate (of Registered)",
    optInValue: `${optInOptOutRaw.optInState.turnoutRate}%`,
    optOutWithSameDayValue: `${optInOptOutRaw.optOutWithSameDay.turnoutRate}%`,
    optOutWithoutSameDayValue: `${optInOptOutRaw.optOutWithoutSameDay.turnoutRate}%`,
  },
  {
    metric: "Turnout Rate (of Eligible)",
    optInValue: `${optInOptOutRaw.optInState.turnoutOfEligible}%`,
    optOutWithSameDayValue: `${optInOptOutRaw.optOutWithSameDay.turnoutOfEligible}%`,
    optOutWithoutSameDayValue: `${optInOptOutRaw.optOutWithoutSameDay.turnoutOfEligible}%`,
  },
];

export const optInStateName = optInOptOutRaw.optInState.state as string;
export const optOutWithSameDayStateName = optInOptOutRaw.optOutWithSameDay
  .state as string;
export const optOutWithoutSameDayStateName = optInOptOutRaw.optOutWithoutSameDay
  .state as string;
frontend/src/lib/utils.ts
-----
import { clsx, type ClassValue } from "clsx";
import { twMerge } from "tailwind-merge";

export function cn(...inputs: ClassValue[]) {
  return twMerge(clsx(inputs));
}

/**
 * Converts a state name to URL-friendly format
 * Examples: "New York" -> "new-york", "California" -> "california"
 */
export function formatStateNameForUrl(stateName: string): string {
  return stateName
    .toLowerCase()
    .replace(/\s+/g, "-")
    .replace(/[^a-z0-9-]/g, "");
}
frontend/src/pages/splash-page.tsx
-----
import { useState } from "react";
import { IconChartBar } from "@tabler/icons-react";
import type { FeatureCollection, Geometry } from "geojson";

import BaseMap from "@/components/map/base-map.tsx";
import ChoroplethLayer from "@/components/map/choropleth-layer.tsx";
import OutlineLayer from "@/components/map/outline-layer.tsx";
import AnalysisDrawer from "@/components/analysis-drawer.tsx";
import { ChoroplethLegend } from "@/components/choropleth-legend.tsx";
import { Button } from "@/components/ui/button.tsx";
import {
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue,
} from "@/components/ui/select.tsx";
import statesJSON from "../../data/us-states.json";
import type { StateProps } from "@/types/map.ts";
import {
  SPLASH_CHOROPLETH_OPTIONS,
  SPLASH_CHOROPLETH_LABELS,
  type SplashChoroplethOption,
} from "@/constants/choropleth.ts";

const statesData = statesJSON as FeatureCollection<Geometry, StateProps>;

export default function SplashPage() {
  const [open, setOpen] = useState(false);
  const [choroplethOption, setChoroplethOption] =
    useState<SplashChoroplethOption>(SPLASH_CHOROPLETH_OPTIONS.OFF);

  const handleChoroplethChange = (value: string) => {
    setChoroplethOption(value as SplashChoroplethOption);
  };

  return (
    <div className="relative min-h-screen">
      {/* White background overlay */}
      <div className="relative z-10 bg-white/70 backdrop-blur-sm">
        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
          <div className="flex items-center justify-between h-16">
            <div className="flex items-center gap-20">
              <Button variant="outline" onClick={() => setOpen(true)}>
                <IconChartBar /> More Analysis
              </Button>

              <div className="flex items-center space-x-2">
                <label className="text-sm font-medium text-gray-700">
                  Choropleth:
                </label>
                <Select
                  value={choroplethOption}
                  onValueChange={handleChoroplethChange}
                >
                  <SelectTrigger className="w-48 bg-white">
                    <SelectValue />
                  </SelectTrigger>
                  <SelectContent>
                    {Object.values(SPLASH_CHOROPLETH_OPTIONS).map((option) => (
                      <SelectItem key={option} value={option}>
                        {SPLASH_CHOROPLETH_LABELS[option]}
                      </SelectItem>
                    ))}
                  </SelectContent>
                </Select>
              </div>
            </div>
          </div>
        </div>
      </div>

      {/* Analysis drawer */}
      <AnalysisDrawer open={open} onOpenChange={setOpen} />

      {/* Map in background */}
      <div className="absolute inset-0 z-0">
        <BaseMap style={{ width: "100%", height: "100vh", zIndex: 0 }}>
          <ChoroplethLayer
            data={statesData}
            choroplethOption={choroplethOption}
          />
          <OutlineLayer data={statesData} />
        </BaseMap>

        {/* Choropleth Legend */}
        {choroplethOption && choroplethOption !== "off" && (
          <div className="absolute bottom-32 left-4 z-10 max-w-xs">
            <ChoroplethLegend choroplethOption={choroplethOption} />
          </div>
        )}
      </div>
    </div>
  );
}
frontend/src/pages/state-analysis.tsx
-----
import { useState, useEffect } from "react"; // ‚¨Ö make sure useEffect is imported
import { stateNameToAbbr } from "@/constants/stateFips";
import { useNavigate } from "@tanstack/react-router";
import statesJSON from "../../data/us-states.json";
import countiesJSON from "../../data/counties.geojson.json";
import censusBlockDataJSON from "../../data/censusBlockData.json";
import type { CountyProps, StateProps } from "@/types/map.ts";
import {
  DETAILED_STATES,
  hasDetailedVoterData,
  hasDropBoxVoting,
} from "@/constants/states.ts";
import { getStateFipsCode } from "@/constants/stateFips.ts";
import { Button } from "@/components/ui/button.tsx";
import {
  STATE_CHOROPLETH_OPTIONS,
  type StateChoroplethOption,
} from "@/constants/choropleth.ts";
import StateMap from "@/components/map/state-map.tsx";
import type { FeatureCollection, Geometry } from "geojson";
import type { CensusBlockData } from "@/components/map/bubble-chart-layer.tsx";

//table imports
import { VoterRegistrationTable } from "../components/table/voter-registration-table";
import eavsRegionVoterDataJson from "../../data/eavsRegionVoterData.json" with { type: "json" };
import { ProvisionBallotsTable } from "../components/table/provisional-ballot-table";
import provisionalBallotsDataJson from "../../data/provisionalBallotsData.json" with { type: "json" };
import { ActiveVotersTable } from "../components/table/active-voters-table";
import activeVotersDataJson from "../../data/activeVotersData.json" with { type: "json" };
import activeVotersDataCaliforniaJson from "../../data/activeVotersData-california.json" with { type: "json" };
import activeVotersDataFloridaJson from "../../data/activeVotersData-florida.json" with { type: "json" };
import { PollbookDeletionsTable } from "../components/table/pollbook-deletions-table";
import pollbookDeletionsDataJson from "../../data/pollbookDeletionsData.json" with { type: "json" };
import { MailBallotsRejectedTable } from "../components/table/mail-ballots-rejected-table";
import mailBallotsRejectedDataJson from "../../data/mailBallotsRejectedData.json" with { type: "json" };
import { StateEquipmentSummaryCards } from "../components/equipment/state-equipment-summary-cards";
import stateEquipmentSummaryJson from "../../data/stateEquipmentSummary.json" with { type: "json" };

//chart imports
import { VoterRegistrationLineChart } from "../components/chart/voter-registration-line-chart";
import voterRegistrationDataJson from "../../data/voterRegistrationChanges.json" with { type: "json" };
import { ProvisionalBallotsBarChart } from "../components/chart/provisional-ballots-bar-chart";
import { ActiveVotersBarChart } from "../components/chart/active-voters-bar-chart";
import { PollbookDeletionsBarChart } from "../components/chart/pollbook-deletions-bar-chart";
import { MailBallotsRejectedBarChart } from "../components/chart/mail-ballots-rejected-bar-chart";
import { DropBoxVotingBubbleChart } from "../components/chart/drop-box-voting-bubble-chart";
import dropBoxVotingDataJson from "../../data/dropBoxVotingData.json" with { type: "json" };
import { EquipmentQualityBubbleChart } from "../components/chart/equipment-quality-bubble-chart";
import equipmentQualityDataJson from "../../data/equipmentQualityVsRejectedBallots.json" with { type: "json" };
import votingEquipmentTypeCaliforniaJson from "../../data/votingEquipmentType-california.json" with { type: "json" };
import votingEquipmentTypeFloridaJson from "../../data/votingEquipmentType-florida.json" with { type: "json" };
import votingEquipmentTypeColoradoJson from "../../data/votingEquipmentType-colorado.json" with { type: "json" };
import type { VotingEquipmentType } from "@/lib/colors";

const statesData = statesJSON as FeatureCollection<Geometry, StateProps>;
const countiesData = countiesJSON as FeatureCollection<Geometry, CountyProps>;
const censusBlockData = censusBlockDataJSON as CensusBlockData[];

// Voter registration data - already sorted by 2024 registered voters in ascending order
const voterRegistrationData = voterRegistrationDataJson as {
  jurisdiction: string;
  registeredVoters2016: number;
  registeredVoters2020: number;
  registeredVoters2024: number;
}[];

// EAVS region voter data for Florida counties
const eavsRegionVoterData = eavsRegionVoterDataJson as {
  eavsRegion: string;
  totalRegisteredVoters: number;
  democraticVoters: number;
  republicanVoters: number;
  unaffiliatedVoters: number;
  otherPartyVoters: number;
  registrationRate: number;
  activeVoters: number;
  inactiveVoters: number;
}[];

//Provisional Ballot Data
const provisionalBallotsData = provisionalBallotsDataJson as {
  E2a: number; // Total provisional ballots issued
  E2b: number; // Counted (fully/partially)
  E2c: number; // Rejected
  E2d: number; // Pending
  E2e: number; // Rejection: not registered
  E2f: number; // Rejection: wrong jurisdiction
  E2g: number; // Rejection: missing signature / ID
  E2h: number; // Rejection: other reasons
  E2i: string; // Notes / remarks
}[];

// Mail Ballots Rejected Data
const mailBallotsRejectedData = mailBallotsRejectedDataJson as {
  eavsRegion: string;
  C9b: number;
  C9c: number;
  C9d: number;
  C9e: number;
  C9f: number;
  C9g: number;
  C9h: number;
  C9i: number;
  C9j: number;
  C9k: number;
  C9l: number;
  C9m: number;
  C9n: number;
  C9o: number;
  C9p: number;
  C9q: number;
  notes: string;
}[];

// Drop box voting data type
type DropBoxVotingData = {
  eavsRegion: string;
  totalDropBoxVotes: number;
  republicanVotes: number;
  democraticVotes: number;
  otherVotes: number;
  totalVotes: number;
  republicanPercentage: number;
  dropBoxPercentage: number;
  dominantParty: "republican" | "democratic";
};

const AnalysisType = {
  PROVISIONAL_BALLOT: "prov-ballot-bchart",
  ACTIVE_VOTERS_2024: "active-voters-2024",
  POLLBOOK_DELETIONS_2024: "pb-deletions-2024",
  MAIL_BALLOTS_REJECTED: "mail-balots-rejected",
  VOTER_REGISTRATION: "voter-registration",
  VOTER_REGISTRATION_CHANGES: "voter-registration-changes",
  STATE_EQUIPMENT_SUMMARY: "state-equip-summary",
  DROP_BOX_VOTING: "drop-box-voting",
  EQUIPMENT_QUALITY_VS_REJECTED_BALLOTS:
    "equipment-quality-vs-rejected-ballots",
} as const;

type AnalysisTypeValue = (typeof AnalysisType)[keyof typeof AnalysisType];

const analysisTypeLabels: Record<AnalysisTypeValue, string> = {
  [AnalysisType.PROVISIONAL_BALLOT]: "Provisional Ballots",
  [AnalysisType.ACTIVE_VOTERS_2024]: "2024 EAVS Active Voters",
  [AnalysisType.POLLBOOK_DELETIONS_2024]: "2024 EAVS Pollbook Deletions",
  [AnalysisType.MAIL_BALLOTS_REJECTED]: "Mail Ballots Rejected",
  [AnalysisType.VOTER_REGISTRATION]: "Voter Registration",
  [AnalysisType.VOTER_REGISTRATION_CHANGES]: "Voter Registration Changes",
  [AnalysisType.STATE_EQUIPMENT_SUMMARY]: "State Equipment Summary",
  [AnalysisType.DROP_BOX_VOTING]: "Drop Box Voting",
  [AnalysisType.EQUIPMENT_QUALITY_VS_REJECTED_BALLOTS]:
    "Equipment vs Rejected Ballots",
};

// Map analysis types to choropleth options
const analysisToChoroplethMap: Record<
  AnalysisTypeValue,
  StateChoroplethOption
> = {
  [AnalysisType.PROVISIONAL_BALLOT]:
    STATE_CHOROPLETH_OPTIONS.PROVISIONAL_BALLOTS,
  [AnalysisType.ACTIVE_VOTERS_2024]: STATE_CHOROPLETH_OPTIONS.ACTIVE_VOTERS,
  [AnalysisType.POLLBOOK_DELETIONS_2024]:
    STATE_CHOROPLETH_OPTIONS.POLLBOOK_DELETIONS,
  [AnalysisType.MAIL_BALLOTS_REJECTED]:
    STATE_CHOROPLETH_OPTIONS.MAIL_BALLOTS_REJECTED,
  [AnalysisType.VOTER_REGISTRATION]:
    STATE_CHOROPLETH_OPTIONS.VOTER_REGISTRATION,
  [AnalysisType.VOTER_REGISTRATION_CHANGES]:
    STATE_CHOROPLETH_OPTIONS.VOTER_REGISTRATION,
  [AnalysisType.STATE_EQUIPMENT_SUMMARY]:
    STATE_CHOROPLETH_OPTIONS.VOTING_EQUIPMENT_TYPE,
  [AnalysisType.DROP_BOX_VOTING]: STATE_CHOROPLETH_OPTIONS.OFF,
  [AnalysisType.EQUIPMENT_QUALITY_VS_REJECTED_BALLOTS]:
    STATE_CHOROPLETH_OPTIONS.OFF,
};

interface StateAnalysisProps {
  stateName: string;
  mockData?: any[]; // added this line
}

export default function StateAnalysis({ stateName, mockData }: StateAnalysisProps) {
  const navigate = useNavigate();


  const [selectedDataset, setSelectedDataset] = useState<AnalysisTypeValue>(
    AnalysisType.PROVISIONAL_BALLOT,
  );

  // Check if current state is a detailed state
  const isDetailedState = (): boolean => {
    const urlStateName = stateName.toLowerCase().replace(/\s+/g, "-");
    return Object.keys(DETAILED_STATES).includes(urlStateName);
  };

  // Set choropleth option based on selected dataset, but only for detailed states
  const choroplethOption = isDetailedState()
    ? analysisToChoroplethMap[selectedDataset]
    : STATE_CHOROPLETH_OPTIONS.OFF;

  const handleBackToMainMap = () => {
    navigate({ to: "/" });
  };

  // Get available analysis options based on state capabilities
  const getAvailableAnalysisOptions = (): AnalysisTypeValue[] => {
    const urlStateName = stateName.toLowerCase().replace(/\s+/g, "-");
    return Object.values(AnalysisType).filter((option) => {
      // Exclude voter registration if this state doesn't have detailed voter data
      if (option === AnalysisType.VOTER_REGISTRATION) {
        return hasDetailedVoterData(urlStateName);
      }
      // Exclude drop box voting if this state doesn't support it
      if (option === AnalysisType.DROP_BOX_VOTING) {
        return hasDropBoxVoting(urlStateName);
      }
      return true;
    });

    
  };

  const formatStateName = (stateName: string): string => {
    if (
      stateName === stateName.toLowerCase() ||
      stateName === stateName.toUpperCase()
    ) {
      return stateName
        .split(/[\s_-]+/)
        .map(
          (word) => word.charAt(0).toUpperCase() + word.slice(1).toLowerCase(),
        )
        .join(" ");
    }

    return stateName
      .replace(/([a-z])([A-Z])/g, "$1 $2")
      .replace(/([A-Z])([A-Z][a-z])/g, "$1 $2")
      .split(/[\s_-]+/)
      .map((word) => word.charAt(0).toUpperCase() + word.slice(1).toLowerCase())
      .join(" ")
      .trim();
  };

  // Filter states data to only include the current state
  const getCurrentStateData = (): FeatureCollection<Geometry, StateProps> => {
    const formattedStateName = formatStateName(stateName);

    const filteredFeatures = statesData.features.filter(
      (feature) => feature.properties?.NAME === formattedStateName,
    );

    return {
      ...statesData,
      features: filteredFeatures,
    };
  };

  // Filter counties data for the current state (only for detailed states)
  const getCurrentCountiesData = (): FeatureCollection<
    Geometry,
    CountyProps
  > | null => {
    if (!isDetailedState()) {
      return null;
    }

    const formattedStateName = formatStateName(stateName);
    const stateFips = getStateFipsCode(formattedStateName);

    if (!stateFips) {
      return null;
    }

    const filteredFeatures = countiesData.features.filter(
      (feature) => feature.properties?.STATEFP === stateFips,
    );

    return {
      ...countiesData,
      features: filteredFeatures,
    };
  };

  const currentStateData = getCurrentStateData();
  const currentCountiesData = getCurrentCountiesData();
  const detailedState = isDetailedState();

  const urlStateName = stateName.toLowerCase().replace(/\s+/g, "-");
  const showBubbleChart =
    selectedDataset === AnalysisType.VOTER_REGISTRATION &&
    hasDetailedVoterData(urlStateName);

  // Get drop box voting data for current state
  const getDropBoxVotingData = (): DropBoxVotingData[] => {
    const stateKey = urlStateName as keyof typeof dropBoxVotingDataJson;
    return (dropBoxVotingDataJson[stateKey] || []) as DropBoxVotingData[];
  };

  // Get equipment quality data for current state
  const getEquipmentQualityData = () => {
    // The JSON has the structure: { equipmentQualityData: [...], regressionCoefficients: {...} }
    // Provided JSON is for Arizona (based on counties)
    // TODO: Adjust to state specific data
    return {
      data: (equipmentQualityDataJson.equipmentQualityData || []) as {
        county: string;
        equipmentQuality: number;
        rejectedBallotPercentage: number;
        totalBallots: number;
        rejectedBallots: number;
        dominantParty: "republican" | "democratic";
        mailInRejected: number;
        provisionalRejected: number;
        uocavaRejected: number;
      }[],
      regressionCoefficients:
        equipmentQualityDataJson.regressionCoefficients as {
          republican: { a: number; b: number; c: number };
          democratic: { a: number; b: number; c: number };
        },
    };
  };

  // Get active voters data based on the state
  const getActiveVotersData = () => {
    const normalizedStateName = urlStateName.toLowerCase();

    if (normalizedStateName === "california") {
      return activeVotersDataCaliforniaJson;
    } else if (normalizedStateName === "florida") {
      return activeVotersDataFloridaJson;
    }

    // Default data for other states
    return activeVotersDataJson;
  };

  // Get voting equipment type data for current state
  const getVotingEquipmentTypeData = () => {
    const normalizedStateName = urlStateName.toLowerCase();

    if (normalizedStateName === "california") {
      return votingEquipmentTypeCaliforniaJson;
    } else if (normalizedStateName === "florida") {
      return votingEquipmentTypeFloridaJson;
    } else if (normalizedStateName === "colorado") {
      return votingEquipmentTypeColoradoJson;
    }

    // Default to empty array for other states
    return [];
  };

  // Enrich county data with voting equipment type information
  const getEnrichedCountiesData = (): FeatureCollection<
    Geometry,
    CountyProps
  > | null => {
    if (!currentCountiesData) {
      return currentCountiesData;
    }

    // Only enrich when we have equipment data and the right dataset is selected
    if (selectedDataset !== AnalysisType.STATE_EQUIPMENT_SUMMARY) {
      return currentCountiesData;
    }

    const equipmentData = getVotingEquipmentTypeData();

    if (equipmentData.length === 0) {
      return currentCountiesData;
    }

    // Create a map of region name to equipment type (with normalized keys)
    const equipmentMap = new Map<string, VotingEquipmentType>();

    equipmentData.forEach(
      (item: {
        eavsRegion: string;
        equipmentTypes: string[];
        primaryEquipment: string;
      }) => {
        const equipmentType =
          item.equipmentTypes.length > 1 ? "mixed" : item.primaryEquipment;

        // Store with original key (e.g., "Los Angeles County")
        equipmentMap.set(item.eavsRegion, equipmentType as VotingEquipmentType);

        // Also store normalized version (e.g., "losangelescounty")
        const normalized = item.eavsRegion.toLowerCase().replace(/\s+/g, "");
        equipmentMap.set(normalized, equipmentType as VotingEquipmentType);
      },
    );

    // Debug: Log available equipment regions
    console.log("Equipment data regions:", Array.from(equipmentMap.keys()));

    // Enrich the county features with equipment type
    const enrichedFeatures = currentCountiesData.features.map((feature) => {
      const countyName = feature.properties?.NAME;

      let equipmentType: VotingEquipmentType = "scanner"; // Default

      if (countyName) {
        // Debug: Log county name
        console.log("Processing county:", countyName);

        // Try 1: Exact match with " County" suffix (e.g., "Los Angeles" -> "Los Angeles County")
        let match = equipmentMap.get(`${countyName} County`);

        // Try 2: Exact match without modification
        if (!match) {
          match = equipmentMap.get(countyName);
        }

        // Try 3: Normalized matching (e.g., "Los Angeles" -> "losangelescounty")
        if (!match) {
          const normalizedCounty = countyName.toLowerCase().replace(/\s+/g, "");
          match = equipmentMap.get(normalizedCounty + "county");
        }

        // Try 4: If county name already has "County", try without it
        if (!match && countyName.toLowerCase().includes("county")) {
          const withoutCounty = countyName.replace(/\s*County\s*/i, "").trim();
          match = equipmentMap.get(`${withoutCounty} County`);
        }

        if (match) {
          equipmentType = match;
          console.log(`‚úì Matched ${countyName} to ${equipmentType}`);
        } else {
          console.log(`‚úó No match for ${countyName}, using default: scanner`);
        }
      }

      return {
        ...feature,
        properties: {
          ...feature.properties,
          VOTING_EQUIPMENT_TYPE: equipmentType,
        },
      };
    });

    return {
      ...currentCountiesData,
      features: enrichedFeatures,
    };
  };

  const enrichedCountiesData = getEnrichedCountiesData();

  // Get equipment data for legend
  const votingEquipmentData =
    selectedDataset === AnalysisType.STATE_EQUIPMENT_SUMMARY
      ? getVotingEquipmentTypeData()
      : [];


      const [provChartData, setProvChartData] = useState<any[]>([]);
      const [provLoading, setProvLoading] = useState(false);
      const [provError, setProvError] = useState<string | null>(null);
      
      useEffect(() => {
        async function fetchProvChartData() {
          try {
            setProvLoading(true);
            setProvError(null);
      
            const formattedState = formatStateName(stateName);
            const fipsPrefix = getStateFipsCode(formattedState);
            const stateAbbr =
              stateNameToAbbr[formattedState] ||
              formattedState.slice(0, 2).toUpperCase(); // fallback
      
            // ‚úÖ Prefer FIPS for backend aggregation endpoint
            if (!fipsPrefix) throw new Error("No FIPS prefix found for " + formattedState);
      
            console.log(`Fetching provisional ballot data for ${formattedState} (${stateAbbr}) with FIPS ${fipsPrefix}`);
      
            const res = await fetch(
              `http://localhost:8080/api/eavs/provisional/aggregate/${fipsPrefix}`
            );
      
            if (!res.ok) throw new Error(`HTTP ${res.status}`);
      
            const json = await res.json();
      
            const formatted = [
              {
                region: json.jurisdictionName,
                E2a: json.E2a,
                E2b: json.E2b,
                E2c: json.E2c,
                E2d: json.E2d,
                E2e: json.E2e,
                E2f: json.E2f,
                E2g: json.E2g,
                E2h: json.E2h,
                E2i: "",
              },
            ];
      
            setProvChartData(formatted);
          } catch (err: any) {
            console.error("Error loading provisional chart data:", err);
            setProvError(err.message);
            setProvChartData([]);
          } finally {
            setProvLoading(false);
          }
        }
      
        fetchProvChartData();
      }, [stateName]);
      
      

  return (
    <div className="h-screen flex flex-col">
      {/* Header */}
      <div className="bg-white border-b px-6 py-2.5 flex items-center justify-between flex-shrink-0 z-50">
        <div className="flex items-center gap-4">
          <Button variant="outline" size="sm" onClick={handleBackToMainMap}>
            ‚Üê Back
          </Button>
          <h1 className="text-lg font-bold text-gray-900">
            {formatStateName(stateName)}
          </h1>
        </div>
      </div>

      {/* Main content */}
      <div className="flex-1 flex overflow-hidden min-h-0">
        {/* Left - Dataset Selector */}
        <div className="w-64 bg-gray-50 border-r p-4 overflow-y-auto flex-shrink-0">
          <p className="text-sm font-semibold text-gray-700 mb-3 uppercase tracking-wide">
            Select Dataset
          </p>
          <div className="space-y-1.5">
            {getAvailableAnalysisOptions().map((analysisType) => (
              <Button
                key={analysisType}
                variant={
                  selectedDataset === analysisType ? "default" : "outline"
                }
                className="w-full justify-start text-sm h-10 font-normal"
                onClick={() => setSelectedDataset(analysisType)}
              >
                {analysisTypeLabels[analysisType]}
              </Button>
            ))}
          </div>
        </div>

        {/* Middle - Map */}
        <div className="w-[35%] relative flex-shrink-0">
          <StateMap
            currentStateData={currentStateData}
            currentCountiesData={enrichedCountiesData}
            isDetailedState={detailedState}
            choroplethOption={choroplethOption}
            censusBlockData={censusBlockData}
            showBubbleChart={showBubbleChart}
            votingEquipmentData={votingEquipmentData}
          />
        </div>

        {/* Right - Analysis Content */}
        <div className="flex-1 bg-white border-l overflow-y-auto min-w-0">
          <div className="p-3">
            <h2 className="text-sm font-semibold text-gray-900 mb-2">
              {analysisTypeLabels[selectedDataset]}
            </h2>
            <div className="bg-gray-50 rounded-lg p-3">
              {selectedDataset === AnalysisType.VOTER_REGISTRATION_CHANGES ? (
                <div className="h-[400px]">
                  <VoterRegistrationLineChart data={voterRegistrationData} />
                </div>
              ) : selectedDataset === AnalysisType.VOTER_REGISTRATION ? (
                <div className="overflow-y-auto">
                  <VoterRegistrationTable data={eavsRegionVoterData} />
                </div>
              ) : selectedDataset === AnalysisType.STATE_EQUIPMENT_SUMMARY ? (
                <div className="h-full">
                  <StateEquipmentSummaryCards
                    data={stateEquipmentSummaryJson}
                  />
                </div>
              ) : selectedDataset === AnalysisType.PROVISIONAL_BALLOT ? (
                <div className="text-xs text-muted-foreground text-center py-8">
                  {/* ‚úÖ dynamically load backend provisional ballot data */}
                  {provLoading ? (
                    <p>Loading provisional ballot data...</p>
                  ) : provError ? (
                    <>
                      <p>Error loading {stateName} data: {provError}</p>
                      <ProvisionBallotsTable
                        fipsPrefix={getStateFipsCode(formatStateName(stateName)) ?? "00"}
                      />
                      <ProvisionalBallotsBarChart
                        stateName={formatStateName(stateName)}
                        barData={provisionalBallotsData}
                      />
                    </>
                  ) : (
                    <>
                      <ProvisionBallotsTable
                        fipsPrefix={getStateFipsCode(formatStateName(stateName)) ?? "00"}
                      />
                      <ProvisionalBallotsBarChart
                        stateName={formatStateName(stateName)}
                        barData={provChartData}
                      />
                    </>
                  )}
                </div>
              ) : selectedDataset === AnalysisType.ACTIVE_VOTERS_2024 ? (
                <div className="text-xs text-muted-foreground text-center py-8">
                  <ActiveVotersTable data={getActiveVotersData()} />
                  <ActiveVotersBarChart
                    stateName={formatStateName(stateName)}
                    barData={getActiveVotersData()}
                  />
                </div>
              ) : selectedDataset === AnalysisType.DROP_BOX_VOTING ? (
                <div className="h-[600px]">
                  <DropBoxVotingBubbleChart
                    stateName={formatStateName(stateName)}
                    data={getDropBoxVotingData()}
                  />
                </div>
              ) : selectedDataset ===
                AnalysisType.EQUIPMENT_QUALITY_VS_REJECTED_BALLOTS ? (
                <div className="h-[600px]">
                  <EquipmentQualityBubbleChart
                    stateName={formatStateName(stateName)}
                    data={getEquipmentQualityData().data}
                    regressionCoefficients={
                      getEquipmentQualityData().regressionCoefficients
                    }
                  />
                </div>
              ) : selectedDataset === AnalysisType.POLLBOOK_DELETIONS_2024 ? (
                <div className="text-xs text-muted-foreground text-center py-8">
                  <PollbookDeletionsTable data={pollbookDeletionsDataJson} />
                  <PollbookDeletionsBarChart
                    stateName={formatStateName(stateName)}
                    barData={pollbookDeletionsDataJson}
                  />
                </div>
              ) : selectedDataset === AnalysisType.MAIL_BALLOTS_REJECTED ? (
                <div className="text-xs text-muted-foreground text-center py-8">
                  <MailBallotsRejectedTable data={mailBallotsRejectedData} />
                  <MailBallotsRejectedBarChart
                    stateName={formatStateName(stateName)}
                    barData={mailBallotsRejectedData}
                  />
                </div>
              ) : (
                <p className="text-xs text-muted-foreground text-center py-8">
                  {analysisTypeLabels[selectedDataset]} visualization will be
                  displayed here.
                </p>
              )}
            </div>
          </div>
        </div>
      </div>
    </div>
  );
}
frontend/src/routes/index.tsx
-----
import { createFileRoute } from "@tanstack/react-router";
import SplashPage from "@/pages/splash-page.tsx";

export const Route = createFileRoute("/")({
  component: RouteComponent,
});

function RouteComponent() {
  return (
    <div>
      <SplashPage />
    </div>
  );
}
frontend/src/routes/__root.tsx
-----
import { Outlet, createRootRoute } from "@tanstack/react-router";
import Header from "@/components/header";

export const Route = createRootRoute({
  component: RootComponent,
  notFoundComponent: () => <div>404 Not Found</div>,
});

function RootComponent() {
  return (
    <div className="h-screen overflow-hidden flex flex-col">
      <Header />
      <div className="flex-1 overflow-hidden">
        <Outlet />
      </div>
    </div>
  );
}
frontend/src/routes/state/$stateName.tsx
-----
import { createFileRoute } from "@tanstack/react-router";
import StateAnalysis from "@/pages/state-analysis.tsx";
import mockData from "../../../data/mockData.json";

// Table imports
import type { Voter } from "../../components/table/columns";

// Type for raw mock data entries before normalization
type RawVoterEntry = {
  id?: string | number;
  name?: string;
  email?: string;
  registered?: boolean | string;
  mailInVote?: boolean | string;
  zip?: string;
};

export const Route = createFileRoute("/state/$stateName")({
  params: {
    parse: (params) => ({
      stateName: params.stateName,
    }),
  },
  component: State,
});

// Function to get mock data
function getData(stateName: string): Voter[] {
  // Convert raw JSON entries into typed Voter[] with safe defaults.
  const raw = (mockData as Record<string, RawVoterEntry[]>)[stateName] || [];

  return raw.map((entry): Voter => {
    const id = entry?.id ? String(entry.id) : "";
    const name = entry?.name ? String(entry.name) : "";
    const email = entry?.email ? String(entry.email) : "";

    // normalize "registered"
    let registered: Voter["registered"] = "unknown";
    if (entry?.registered === true || entry?.registered === "true") {
      registered = "true";
    } else if (entry?.registered === false || entry?.registered === "false") {
      registered = "false";
    }

    // normalize mailInVote to a boolean
    const mailInVote =
      entry?.mailInVote === true || entry?.mailInVote === "true";

    // normalize zip code (3 letters, fallback "UNK")
    const zip =
      typeof entry?.zip === "string" && entry.zip.length > 0
        ? entry.zip
        : "UNK";

    return { id, name, email, registered, mailInVote, zip };
  });
}

function State() {
  const { stateName } = Route.useParams();
  const data = getData(stateName);

  return <StateAnalysis stateName={stateName} mockData={data} />;
}
